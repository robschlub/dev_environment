!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("diagramLib",[],e):"object"==typeof exports?exports.diagramLib=e():t.diagramLib=e()}(window,function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"round",function(){return l}),n.d(i,"roundNum",function(){return s}),n.d(i,"decelerate",function(){return c}),n.d(i,"easeinout",function(){return d}),n.d(i,"easeout",function(){return v}),n.d(i,"easein",function(){return m}),n.d(i,"sinusoid",function(){return p}),n.d(i,"linear",function(){return f}),n.d(i,"clipMag",function(){return h}),n.d(i,"clipValue",function(){return u}),n.d(i,"range",function(){return g}),n.d(i,"randInt",function(){return y}),n.d(i,"rand",function(){return w}),n.d(i,"randElement",function(){return b}),n.d(i,"removeRandElement",function(){return x}),n.d(i,"randElements",function(){return _}),n.d(i,"rand2D",function(){return k});var o={};n.r(o),n.d(o,"point",function(){return G}),n.d(o,"Point",function(){return N}),n.d(o,"line",function(){return K}),n.d(o,"Line",function(){return Z}),n.d(o,"distance",function(){return W}),n.d(o,"minAngleDiff",function(){return U}),n.d(o,"deg",function(){return V}),n.d(o,"normAngle",function(){return X}),n.d(o,"Transform",function(){return rt}),n.d(o,"TransformLimit",function(){return ot}),n.d(o,"Rect",function(){return H}),n.d(o,"Translation",function(){return J}),n.d(o,"Scale",function(){return tt}),n.d(o,"Rotation",function(){return $}),n.d(o,"spaceToSpaceTransform",function(){return at}),n.d(o,"getBoundingRect",function(){return ut}),n.d(o,"linearPath",function(){return et}),n.d(o,"curvedPath",function(){return nt}),n.d(o,"quadraticBezier",function(){return q}),n.d(o,"translationPath",function(){return it}),n.d(o,"polarToRect",function(){return lt}),n.d(o,"rectToPolar",function(){return ht}),n.d(o,"getDeltaAngle",function(){return Q}),n.d(o,"normAngleTo90",function(){return Y}),n.d(o,"threePointAngle",function(){return ct}),n.d(o,"randomPoint",function(){return ft}),n.d(o,"getMaxTimeFromVelocity",function(){return dt}),n.d(o,"getMoveTime",function(){return vt});var r={};n.r(r),n.d(r,"DiagramElementPrimative",function(){return ce}),n.d(r,"DiagramElementCollection",function(){return fe}),n.d(r,"DiagramElement",function(){return ue});var a={};n.r(a),n.d(a,"default",function(){return $o});var s=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5,n=Math.pow(10,e),i=Math.round(t*n)/n;return Object.is(i,-0)&&(i=0),i};function l(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:5,n=0;return Array.isArray(t)&&(n=t.map(function(t){return l(t,e)})),"number"==typeof t&&(n=s(t,e)),n}function h(t,e,n){var i=t,o=e,r=n;return null===o&&(o=0),o<0&&(o=-o),null===r||(r<0&&(r=-r),-o<=t&&t<=o&&(i=0),r<t&&(i=r),t<-r&&(i=-r)),i}function u(t,e,n){var i=t;return null!==e&&t<e&&(i=e),null!==n&&n<t&&(i=n),i}var c=function(t,e,n,i,o){var r=0;null!==o&&(r=o);var a=0;if(null!==n&&(a=n),0===h(e,r,e))return{p:t,v:0};var s=a;a<0&&(s=-s);var l=e/Math.abs(e),u=e-l*s*i,c=i;if(0===(u=u/Math.abs(u)!==l?0:h(u,r,u))){var f=r;f/Math.abs(f)!==l&&(f=-f),c=Math.abs((f-e)/s)}return{p:t+e*c-.5*l*s*c*c,v:u}},f=function(t){return 1<arguments.length&&void 0!==arguments[1]&&arguments[1],t},d=function(t){if(1<arguments.length&&void 0!==arguments[1]&&arguments[1]){var e=t;return(2*e-Math.sqrt(-4*e*e+4*e))/(4*e-2)}var n=t;return Math.pow(n,2)/(Math.pow(n,2)+Math.pow(1-n,2))};function v(t){if(1<arguments.length&&void 0!==arguments[1]&&arguments[1]){var e=t;return(2*e-Math.sqrt(-4*e*e+4*e))/(4*e-2)}var n=.5+t/2;return 2*(Math.pow(n,2)/(Math.pow(n,2)+Math.pow(1-n,2))-.5)}function m(t){if(1<arguments.length&&void 0!==arguments[1]&&arguments[1]){var e=t;return(2*e-Math.sqrt(-4*e*e+4*e))/(4*e-2)}var n=t/2;return Math.pow(n,2)/(Math.pow(n,2)+Math.pow(1-n,2))*2}function p(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;return n+i*Math.sin(t*e*2*Math.PI+o)}function g(t,e){for(var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=[],o=t;o<=e+.5*n;o+=n)i.push(o);return i}function y(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(null==e)return Math.floor(Math.random()*Math.floor(t));var n=t;return Math.floor(Math.random()*Math.floor(e-n)+Math.floor(n))}function w(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;if(null==e)return Math.random()*t;var n=t;return Math.random()*(e-n)+n}function b(t){return t[y(t.length)]}function x(t){var e=w(t.length);return t.splice(e,1)[0]}function _(t,e){for(var n=g(0,e.length-1,1),i=[],o=0;o<t;o+=1){var r=x(n);i.push(e[r])}return i}function k(t,e,n,i){return{x:w(t,n),y:w(e,i)}}function T(t,e){return[t[0]*e[0]+t[1]*e[3]+t[2]*e[6],t[0]*e[1]+t[1]*e[4]+t[2]*e[7],t[0]*e[2]+t[1]*e[5]+t[2]*e[8],t[3]*e[0]+t[4]*e[3]+t[5]*e[6],t[3]*e[1]+t[4]*e[4]+t[5]*e[7],t[3]*e[2]+t[4]*e[5]+t[5]*e[8],t[6]*e[0]+t[7]*e[3]+t[8]*e[6],t[6]*e[1]+t[7]*e[4]+t[8]*e[7],t[6]*e[2]+t[7]*e[5]+t[8]*e[8]]}function P(t){return[t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]]}function S(t,e){return[1,0,t,0,1,e,0,0,1]}function O(t,e,n){return T(t,S(e,n))}function M(t){var e=Math.cos(t),n=Math.sin(t);return[e,-n,0,n,e,0,0,0,1]}function E(t,e){return T(t,M(e))}function L(t,e){return[t,0,0,0,e,0,0,0,1]}function A(t,e,n){return T(t,L(e,n))}function C(t){return(C="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function j(t,e){return!e||"object"!==C(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function B(t){return(B=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function R(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}function D(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function I(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function F(t,e,n){return e&&I(t.prototype,e),n&&I(t,n),t}function q(t,e,n,i){return(1-i)*((1-i)*t+i*e)+i*((1-i)*e+i*n)}var H=function(){function t(e,n,i,o){D(this,t),this.left=e,this.width=i,this.height=o,this.bottom=n,this.top=n+o,this.right=e+i}return F(t,[{key:"_dup",value:function(){return new t(this.left,this.bottom,this.width,this.height)}}]),t}(),N=function(){function t(e,n){D(this,t),this.x=e,this.y=n}return F(t,null,[{key:"zero",value:function(){return new t(0,0)}},{key:"Unity",value:function(){return new t(1,1)}}]),F(t,[{key:"_dup",value:function(){return new t(this.x,this.y)}},{key:"scale",value:function(e){return new t(this.x*e,this.y*e)}},{key:"sub",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e instanceof t?new t(this.x-e.x,this.y-e.y):new t(this.x-e,this.y-n)}},{key:"add",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;return e instanceof t?new t(this.x+e.x,this.y+e.y):new t(this.x+e,this.y+n)}},{key:"distance",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"round",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:8;return new t(s(this.x,e),s(this.y,e))}},{key:"clip",value:function(e,n){var i,o,r,a;return o=e instanceof t?(i=e.x,e.y):i=e,a=n instanceof t?(r=n.x,n.y):r=n,new t(u(this.x,i,r),u(this.y,o,a))}},{key:"transformBy",value:function(e){var n,i,o,r=(n=e,i=this.x,o=this.y,[n[0]*i+n[1]*o+n[2],n[3]*i+n[4]*o+n[5]]);return new t(r[0],r[1])}},{key:"quadraticBezier",value:function(e,n,i){return new t(q(this.x,e.x,n.x,i),q(this.y,e.y,n.y,i))}},{key:"rotate",value:function(e,n){var i=Math.cos(e),o=Math.sin(e),r=[i,-o,o,i],a=n||new t(0,0),s=this.sub(a);return new t(r[0]*s.x+r[1]*s.y+a.x,r[2]*s.x+r[3]*s.y+a.y)}},{key:"isEqualTo",value:function(t,e){var n=this,i=t;return"number"==typeof e&&(n=this.round(e),i=i.round(e)),n.x===i.x&&n.y===i.y}},{key:"isNotEqualTo",value:function(t,e){return!this.isEqualTo(t,e)}},{key:"isOnLine",value:function(t,e){return t.hasPointOn(this,e)}},{key:"getShaddowOnLine",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,n=new Z(this,1,t.angle()+Math.PI/2).intersectsWith(t).intersect;return null!=n&&n.isOnLine(t,e)?n:null}},{key:"shaddowIsOnLine",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8;return null!=this.getShaddowOnLine(t,e)}},{key:"isOnUnboundLine",value:function(t,e){return t.hasPointAlong(this,e)}},{key:"isInPolygon",value:function(e){var n=0,i=e.length-1,o=e.slice(),r=this,a=!1;o[0].isNotEqualTo(o[i])&&(o.push(o[0]),a=!0,i+=1);for(var s=0;s<i;s+=1)o[s].y<=r.y?o[s+1].y>r.y&&0<t.isLeft(o[s],o[s+1],r)&&(n+=1):o[s+1].y<=r.y&&t.isLeft(o[s],o[s+1],r)<0&&(n-=1);return a&&o.pop(),0!==n}},{key:"isOnPolygon",value:function(t){var e=!1,n=t.length-1,i=t.slice();i[0].isNotEqualTo(i[n])&&(i.push(i[0]),e=!0,n+=1);for(var o=0;o<n;o+=1){var r=K(i[o],i[o+1]);if(this.isOnLine(r))return e&&i.pop(),!0}return this.isInPolygon(t)?(e&&i.pop(),!0):(e&&i.pop(),!1)}},{key:"toPolar",value:function(){return{mag:Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2)),angle:Math.atan2(this.y,this.x)}}}],[{key:"isLeft",value:function(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}}]),t}();function G(t,e){return new N(t,e)}function z(t,e,n,i){if(null==i){if(t.x>=Math.min(e.x,n.x)&&t.x<=Math.max(e.x,n.x)&&t.y>=Math.min(e.y,n.y)&&t.y<=Math.max(e.y,n.y))return!0}else if(s(t.x,i)>=s(Math.min(e.x,n.x),i)&&s(t.x,i)<=s(Math.max(e.x,n.x),i)&&s(t.y,i)>=s(Math.min(e.y,n.y),i)&&s(t.y,i)<=s(Math.max(e.y,n.y),i))return!0;return!1}function W(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function V(t){return 180*t/Math.PI}function U(t,e){return t===e?0:Math.atan2(Math.sin(t-e),Math.cos(t-e))}function X(t){for(var e=t;e>=2*Math.PI;)e-=2*Math.PI;for(;e<0;)e+=2*Math.PI;return e}function Y(t){var e=X(t);return e>Math.PI/2&&e<Math.PI&&(e+=Math.PI),e===Math.PI&&(e=0),e>Math.PI&&e<3*Math.PI/2&&(e-=Math.PI),e}function Q(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=X(t),o=X(e);return i===o?0:(2===n&&(o<i?-1:1),0===n?U(o,i):1===n&&o<i?2*Math.PI-i+o:-1===n&&i<o?-i-(2*Math.PI-o):o-i)}var Z=function(){function t(e,n){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;D(this,t),this.p1=e._dup(),this.ang=n instanceof N?(this.p2=n._dup(),Math.atan2(this.p2.y-this.p1.y,this.p2.x-this.p1.x)):(this.p2=this.p1.add(n*Math.cos(i),n*Math.sin(i)),i),this.A=this.p2.y-this.p1.y,this.B=this.p1.x-this.p2.x,this.C=this.A*this.p1.x+this.B*this.p1.y,this.distance=W(this.p1,this.p2)}return F(t,[{key:"getPoint",value:function(){return 2===(0<arguments.length&&void 0!==arguments[0]?arguments[0]:1)?this.p2:this.p1}},{key:"getYFromX",value:function(t){return 0!==this.B?(this.C-this.A*t)/this.B:null}},{key:"getXFromY",value:function(t){return 0!==this.A?(this.C-this.B*t)/this.A:null}},{key:"angle",value:function(){return this.ang}},{key:"round",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:8,n=new t(this.p1,this.p2);return n.A=s(n.A,e),n.B=s(n.B,e),n.C=s(n.C,e),n.ang=s(n.ang,e),n.distance=s(n.distance,e),n}},{key:"length",value:function(){return this.distance}},{key:"midpoint",value:function(){var t=this.length(),e=this.p2.sub(this.p1),n=Math.atan2(e.y,e.x);return G(this.p1.x+t/2*Math.cos(n),this.p1.y+t/2*Math.sin(n))}},{key:"hasPointAlong",value:function(t,e){if(null==e){if(this.C===this.A*t.x+this.B*t.y)return!0}else if(s(this.C,e)===s(this.A*t.x+this.B*t.y,e))return!0;return!1}},{key:"distanceToPoint",value:function(t,e){return s(Math.abs(this.A*t.x+this.B*t.y-this.C)/Math.sqrt(Math.pow(this.A,2)+Math.pow(this.B,2)),e)}},{key:"hasPointOn",value:function(t,e){return!(!this.hasPointAlong(t,e)||!z(t,this.p1,this.p2,e))}},{key:"isEqualTo",value:function(t,e){var n=this,i=t;return"number"==typeof e&&(n=n.round(e),i=i.round(e),n.p1=n.p1.round(e),n.p2=n.p2.round(e),i.p1=i.p1.round(e),i.p2=i.p2.round(e)),!(n.A!==i.A||n.B!==i.B||n.C!==i.C||n.p1.isNotEqualTo(i.p1)&&n.p1.isNotEqualTo(i.p2)||n.p2.isNotEqualTo(i.p1)&&n.p2.isNotEqualTo(i.p2))}},{key:"isOnSameLineAs",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,n=this.round(e),i=t.round(e);if(0===n.A&&0===n.B||0===i.A&&0===i.B)return!1;if(0!==n.A){var o=i.A/n.A;return n.B*o===i.B&&n.C*o===i.C}if(0!==i.A){var r=n.A/i.A;return i.B*r===n.B&&i.C*r===n.C}if(0!==n.B){var a=i.B/n.B;return n.A*a===i.A&&n.C*a===i.C}if(0===i.B)return!0;var s=n.B/i.B;return i.A*s===n.A&&i.C*s===n.C}},{key:"intersectsWith",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8,i=e,o=this,r=o.A*i.B-i.A*o.B;if(0!==s(r,n)){var a=G(0,0);return a.x=(i.B*o.C-o.B*i.C)/r,a.y=(o.A*i.C-i.A*o.C)/r,z(a,o.p1,o.p2,n)&&z(a,i.p1,i.p2,n)?{onLine:!0,inLine:!0,intersect:a}:{onLine:!0,inLine:!1,intersect:a}}if(0===r&&o.isOnSameLineAs(i,n)){if(o.p1.isOnLine(i,n)||o.p2.isOnLine(i,n)||i.p1.isOnLine(o,n)||i.p2.isOnLine(o,n))return o.p1.isOnLine(i,n)&&o.p2.isOnLine(i,n)&&(!i.p1.isOnLine(o,n)||!i.p2.isOnLine(o,n))||i.p1.isOnLine(o,n)&&i.p2.isOnLine(o,n)&&(!o.p1.isOnLine(i,n)||!o.p2.isOnLine(i,n))?{onLine:!0,inLine:!0,intersect:new t(o.midpoint(),i.midpoint()).midpoint()}:(o.p1.isOnLine(i,n)&&!o.p2.isOnLine(i,n)&&i.p1.isOnLine(o,n)&&!i.p2.isOnLine(o,n)&&(l=new t(o.p1,i.p1)),o.p1.isOnLine(i,n)&&!o.p2.isOnLine(i,n)&&!i.p1.isOnLine(o,n)&&i.p2.isOnLine(o,n)&&(l=new t(o.p1,i.p2)),!o.p1.isOnLine(i,n)&&o.p2.isOnLine(i,n)&&i.p1.isOnLine(o,n)&&!i.p2.isOnLine(o,n)&&(l=new t(o.p2,i.p1)),!o.p1.isOnLine(i,n)&&o.p2.isOnLine(i,n)&&!i.p1.isOnLine(o,n)&&i.p2.isOnLine(o,n)&&(l=new t(o.p2,i.p2)),l instanceof t&&(h=l.midpoint()),{onLine:!0,inLine:!0,intersect:h});var l,h,u=new t(o.p1,i.p1),c=new t(o.p1,i.p2),f=new t(o.p2,i.p1),d=new t(o.p2,i.p2),v=u.midpoint(),m=u.length();return c.length()<m&&(v=c.midpoint(),m=c.length()),f.length()<m&&(v=f.midpoint(),m=f.length()),d.length()<m&&(v=d.midpoint(),m=d.length()),{onLine:!0,inLine:!1,intersect:v}}return{onLine:!1,inLine:!1,intersect:void 0}}}]),t}();function K(t,e){return new Z(t,e)}var $=function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";D(this,t),this.r=e,this.name=n}return F(t,[{key:"matrix",value:function(){return M(this.r)}},{key:"sub",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new t(0,this.name);return new t(this.r-e.r,this.name)}},{key:"round",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:8;return new t(s(this.r,e),this.name)}},{key:"add",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new t(0,this.name);return new t(this.r+e.r,this.name)}},{key:"mul",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new t(1,this.name);return new t(this.r*e.r,this.name)}},{key:"_dup",value:function(){return new t(this.r,this.name)}}]),t}(),J=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";return D(this,e),(n=j(this,t instanceof N?B(e).call(this,t.x,t.y):B(e).call(this,t,i))).name=o,j(n)}return R(e,N),F(e,[{key:"matrix",value:function(){return S(this.x,this.y)}},{key:"sub",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new e(0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=new N(0,0);return i="number"==typeof t?new e(t,n):t,new e(this.x-i.x,this.y-i.y,this.name)}},{key:"add",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new e(0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=new N(0,0);return i="number"==typeof t?new e(t,n):t,new e(this.x+i.x,this.y+i.y,this.name)}},{key:"mul",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new e(1,1);return new e(this.x*t.x,this.y*t.y,this.name)}},{key:"round",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:8;return new e(s(this.x,t),s(this.y,t),this.name)}},{key:"_dup",value:function(){return new e(this.x,this.y,this.name)}}]),e}(),tt=function(t){function e(t,n){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";return D(this,e),(i=j(this,t instanceof N?B(e).call(this,t.x,t.y):B(e).call(this,t,n))).name=o,j(i)}return R(e,N),F(e,[{key:"matrix",value:function(){return L(this.x,this.y)}},{key:"sub",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new e(0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=new N(0,0);return i="number"==typeof t?new e(t,n):t,new e(this.x-i.x,this.y-i.y,this.name)}},{key:"round",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:8;return new e(s(this.x,t),s(this.y,t),this.name)}},{key:"add",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new e(0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=new N(0,0);return i="number"==typeof t?new e(t,n):t,new e(this.x+i.x,this.y+i.y,this.name)}},{key:"mul",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new e(1,1);return t instanceof e||t instanceof N?new e(this.x*t.x,this.y*t.y):new e(this.x*t,this.y*t,this.name)}},{key:"_dup",value:function(){return new e(this.x,this.y,this.name)}}]),e}();function et(t,e,n){return t.add(e.x*n,e.y*n)}function nt(t,e,n,i){var o=i,r=Math.atan2(e.y,e.x),a=t.add(new N(e.x*o.offset,e.y*o.offset)),s=e.toPolar().mag*o.magnitude,l=i.controlPoint;if(null==l){var h=i.direction,u=Math.cos(r+o.rot*Math.PI/2),c=Math.sin(r+o.rot*Math.PI/2);"up"===h?c<0&&(c=Math.sin(r+o.rot*Math.PI/2+Math.PI)):"down"===h?0<c&&(c=Math.sin(r+o.rot*Math.PI/2+Math.PI)):"left"===h?0<u&&(u=Math.cos(r+o.rot*Math.PI/2+Math.PI)):"right"===h&&u<0&&(u=Math.cos(r+o.rot*Math.PI/2+Math.PI)),l=new N(a.x+s*u,a.y+s*c)}var f=t,d=l,v=t.add(e),m=n,p=q(f.x,d.x,v.x,m),g=q(f.y,d.y,v.y,m);return new N(p,g)}function it(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"linear",e=1<arguments.length?arguments[1]:void 0,n=2<arguments.length?arguments[2]:void 0,i=3<arguments.length?arguments[3]:void 0,o=4<arguments.length?arguments[4]:void 0;return"linear"===t?et(e,n,i):"curved"===t?nt(e,n,i,o):new N(0,0)}var ot=function(){function t(e,n,i){D(this,t),this.scale=e,this.rotation=n,this.translation=i}return F(t,[{key:"_dup",value:function(){return new t(this.scale,this.rotation,this.translation)}}]),t}(),rt=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";D(this,t),this.name="string"==typeof e?(this.order=[],e):(this.order=e.map(function(t){return t._dup()}),n),this.index=this.order.length,this.calcMatrix()}return F(t,[{key:"translate",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=new J(e,n,this.name),o=this.order.slice();return this.index!==this.order.length?(this.order[this.index]=i,this.index+=1,this.calcMatrix(),this):(o.push(i),new t(o,this.name))}},{key:"rotate",value:function(e){var n=new $(e,this.name);n.name=this.name;var i=this.order.slice();return this.index!==this.order.length?(this.order[this.index]=n,this.index+=1,this.calcMatrix(),this):(i.push(n),new t(i,this.name))}},{key:"scale",value:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=new tt(e,n,this.name),o=this.order.slice();return this.index!==this.order.length?(this.order[this.index]=i,this.index+=1,this.calcMatrix(),this):(o.push(i),new t(o,this.name))}},{key:"calcMatrix",value:function(){for(var t=[1,0,0,0,1,0,0,0,1],e=this.order.length-1;0<=e;e-=1)t=T(t,this.order[e].matrix());this.mat=t}},{key:"update",value:function(t){return t<this.order.length&&(this.index=t),this}},{key:"t",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=0,n=0;n<this.order.length;n+=1){var i=this.order[n];if(i instanceof J){if(e===t)return new N(i.x,i.y);e+=1}}return null}},{key:"updateTranslation",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t instanceof N&&(i=e);for(var o=0;o<this.order.length;o+=1)if(this.order[o]instanceof J){if(n===i)return this.order[o]=new J(t,e,this.name),void this.calcMatrix();n+=1}}},{key:"s",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=0,n=0;n<this.order.length;n+=1){var i=this.order[n];if(i instanceof tt){if(e===t)return new N(i.x,i.y);e+=1}}return null}},{key:"toDelta",value:function(t,e,n,i){for(var o=this._dup(),r=0;r<this.order.length;r+=1){var a=this.order[r],s=t.order[r];a instanceof tt&&s instanceof tt&&(o.order[r]=a.add(s.mul(e))),a instanceof $&&s instanceof $&&(o.order[r]=new $(a.r+s.r*e)),a instanceof J&&s instanceof J&&(o.order[r]=new J(it(n,a,s,e,i)))}return o}},{key:"updateScale",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;t instanceof N&&(i=e);for(var o=0;o<this.order.length;o+=1)if(this.order[o]instanceof tt){if(n===i)return this.order[o]=new tt(t,e,this.name),void this.calcMatrix();n+=1}}},{key:"r",value:function(){for(var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=0,n=0;n<this.order.length;n+=1){var i=this.order[n];if(i instanceof $){if(e===t)return i.r;e+=1}}return null}},{key:"updateRotation",value:function(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=0,i=0;i<this.order.length;i+=1)if(this.order[i]instanceof $){if(n===e)return this.order[i]=new $(t,this.name),void this.calcMatrix();n+=1}}},{key:"m",value:function(){return this.mat}},{key:"matrix",value:function(){return this.mat}},{key:"isSimilarTo",value:function(t){if(t.order.length!==this.order.length)return!1;for(var e=0;e<this.order.length;e+=1)if(this.order[e].constructor.name!==t.order[e].constructor.name)return!1;return!0}},{key:"isEqualTo",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:8;if(!this.isSimilarTo(t))return!1;for(var n=0;n<this.order.length;n+=1){var i=t.order[n],o=this.order[n];if(o.constructor.name!==i.constructor.name)return!1;if((o instanceof J&&i instanceof J||o instanceof tt&&i instanceof tt)&&i.isNotEqualTo(o,e))return!1;if(o instanceof $&&i.r!==o.r)return!1}return!0}},{key:"sub",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new t;if(!this.isSimilarTo(e))return new t(this.order,this.name);for(var n=[],i=0;i<this.order.length;i+=1)n.push(this.order[i].sub(e.order[i]));return new t(n,this.name)}},{key:"add",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new t;if(!this.isSimilarTo(e))return new t(this.order,this.name);for(var n=[],i=0;i<this.order.length;i+=1)n.push(this.order[i].add(e.order[i]));return new t(n,this.name)}},{key:"mul",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new t;if(!this.isSimilarTo(e))return new t(this.order,this.name);for(var n=[],i=0;i<this.order.length;i+=1)n.push(this.order[i].mul(e.order[i]));return new t(n,this.name)}},{key:"transform",value:function(e){var n=new t([],this.name);return n.order=e.order.concat(this.order),n.mat=T(this.matrix(),e.matrix()),n}},{key:"transformBy",value:function(e){var n=new t([],this.name);return n.order=this.order.concat(e.order),n.mat=T(e.matrix(),this.matrix()),n}},{key:"round",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:8,n=[],i=0;i<this.order.length;i+=1)n.push(this.order[i].round(e));return new t(n,this.name)}},{key:"clip",value:function(e,n,i){if(!this.isSimilarTo(e)||!this.isSimilarTo(n))return this._dup();for(var o=[],r=0;r<this.order.length;r+=1){var a=this.order[r],s=e.order[r],l=n.order[r];if(a instanceof J&&s instanceof J&&l instanceof J){var h=u(a.x,s.x,l.x),c=u(a.y,s.y,l.y);o.push(new J(h,c,this.name))}else if(a instanceof $&&s instanceof $&&l instanceof $)o.push(new $(u(a.r,s.r,l.r),this.name));else if(a instanceof tt&&s instanceof tt&&l instanceof tt){var f=u(a.x,s.x,l.x),d=u(a.y,s.y,l.y);o.push(new tt(f,d,this.name))}}var v=new t(o,this.name);if(null!=i){var m=v.t();if(null!=m){var p=new Z(m,1,i.angle()+Math.PI/2).intersectsWith(i).intersect;p&&(p.isOnLine(i,4)?v.updateTranslation(p):W(p,i.p1)<W(p,i.p2)?v.updateTranslation(i.p1):v.updateTranslation(i.p2))}}return v}},{key:"clipMag",value:function(e,n){for(var i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],o=[],r=e,a=n,s=0;s<this.order.length;s+=1){var l=this.order[s];if(l instanceof J)if(i){var u=l.toPolar(),c=u.mag,f=u.angle,d=h(c,r.translation,a.translation);o.push(new J(d*Math.cos(f),d*Math.sin(f),this.name))}else{var v=h(l.x,r.translation,a.translation),m=h(l.y,r.translation,a.translation);o.push(new J(v,m,this.name))}else if(l instanceof $){var p=h(l.r,r.rotation,a.rotation);o.push(new $(p,this.name))}else if(l instanceof tt)if(i){var g=l.toPolar(),y=g.mag,w=g.angle,b=h(y,r.scale,a.scale);o.push(new tt(b*Math.cos(w),b*Math.sin(w),this.name))}else{var x=h(l.x,r.scale,a.scale),_=h(l.y,r.scale,a.scale);o.push(new tt(x,_,this.name))}}return new t(o,this.name)}},{key:"constant",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=[],i=0;i<this.order.length;i+=1){var o=this.order[i];o instanceof J?n.push(new J(e,e,this.name)):o instanceof $?n.push(new $(e,this.name)):o instanceof tt&&n.push(new tt(e,e,this.name))}return new t(n,this.name)}},{key:"zero",value:function(){return this.constant(0)}},{key:"isZero",value:function(){for(var t=0;t<this.order.length;t+=1){var e=this.order[t];if(e instanceof J||e instanceof tt){if(0!==e.x||0!==e.y)return!1}else if(e instanceof $&&0!==e.r)return!1}return!0}},{key:"_dup",value:function(){var e=new t(this.order,this.name);return e.index=this.index,e}},{key:"decelerate",value:function(e,n,i,o){for(var r=new t,a=new t,s=o,l=n,h=0;h<this.order.length;h+=1){var u=this.order[h],f=e.order[h];if(u instanceof J&&f instanceof J){var d=f.toPolar(),v=d.mag,m=d.angle,p=c(0,v,l.translation,i,s.translation);r=r.translate(p.v*Math.cos(m),p.v*Math.sin(m)),a=a.translate(u.x+p.p*Math.cos(m),u.y+p.p*Math.sin(m))}else if(u instanceof $&&f instanceof $){var g=c(u.r,f.r,l.rotation,i,s.rotation);r=r.rotate(g.v),a=a.rotate(g.p)}else{if(!(u instanceof tt&&f instanceof tt))return{v:new t,t:new t};var y=f.toPolar(),w=y.mag,b=y.angle,x=c(0,w,l.scale,i,s.scale);r=r.scale(x.v*Math.cos(b),x.v*Math.sin(b)),a=a.scale(u.x+x.p*Math.cos(b),u.y+x.p*Math.sin(b))}}return{v:r,t:a}}},{key:"velocity",value:function(e,n,i,o){var r=[];if(!this.isSimilarTo(e))return this.zero();for(var a=this.sub(e),s=0;s<a.order.length;s+=1){var l=a.order[s];l instanceof J?r.push(new J(l.x/n,l.y/n)):l instanceof $?r.push(new $(l.r/n)):l instanceof tt&&r.push(new tt(l.x/n,l.y/n))}return new t(r).clipMag(i,o)}}]),t}();function at(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=e.x.width/t.x.width,o=e.y.height/t.y.height;return new rt(n).scale(i,o).translate(e.x.bottomLeft-t.x.bottomLeft*i,e.y.bottomLeft-t.y.bottomLeft*o)}function st(t,e,n,i){var o=new N(0,0),r=new N(0,0);return r.y=i?(o.x=t.x,o.y=t.y,r.x=t.x,t.y):(o.x=t.x<e.x?t.x:e.x,o.y=t.y<e.y?t.y:e.y,r.x=t.x>n.x?t.x:n.x,t.y>n.y?t.y:n.y),{min:o,max:r}}function lt(t,e){return new N(t*Math.cos(e),t*Math.sin(e))}function ht(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=(e="number"==typeof t?new N(t,n):t).distance(),o=Math.atan2(e.y,e.x);return o<0&&(o+=2*Math.PI),{mag:i,angle:o}}function ut(t){var e=!0,n={min:new N(0,0),max:new N(0,0)};return t.forEach(function(t){Array.isArray(t)?t.forEach(function(t){n=st(t,n.min,n.max,e),e=!1}):n=st(t,n.min,n.max,e),e=!1}),new H(n.min.x,n.min.y,n.max.x-n.min.x,n.max.y-n.min.y)}function ct(t,e,n){var i=W(e,t),o=W(e,n),r=W(t,n);return Math.acos((Math.pow(i,2)+Math.pow(o,2)-Math.pow(r,2))/(2*i*o))}function ft(t){var e=k(t.left,t.bottom,t.right,t.top);return new N(e.x,e.y)}function dt(t,e,n,i){var o=e.sub(t),r=0;return o.order.forEach(function(o,a){if(o instanceof J||o instanceof tt){var s=n.order[a];if((s instanceof J||s instanceof tt)&&0!==s.x&&0!==s.y){var l=Math.abs(o.x)/s.x,h=Math.abs(o.y)/s.y;r=(r=r<l?l:r)<h?h:r}}var u=t.order[a],c=e.order[a];if(o instanceof $&&u instanceof $&&c instanceof $){var f=Q(u.r,c.r,i);o.r=f;var d=n.order[a];if(d instanceof $&&0!==d){var v=Math.abs(o.r/d.r);r=r<v?v:r}}}),r}function vt(t,e){var n,i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new N(.25,.25),a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:2*Math.PI/6,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new N(1,1);if(n=t instanceof rt?[t]:t,(i=e instanceof rt?[e]:e).length!==n.length)return 0;var l=0;return n.forEach(function(t,e){for(var n=i[e],h=t._dup(),u=0;u<h.order.length;u+=1){var c=h.order[u];c instanceof J?(c.x=r.x,c.y=r.y):c instanceof $?c.r=a:(c.x=s.x,c.y=s.y)}var f=dt(t,n,h,o);l<f&&(l=f)}),l}function mt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function pt(t,e,n){var i=t.createShader(e);return t.shaderSource(i,n),t.compileShader(i),t.getShaderParameter(i,t.COMPILE_STATUS)?i:(t.deleteShader(i),null)}var gt=function(){function t(e,n,i,o,r){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var a,s,l,h,u,c,f,d,v,m=e.getContext("webgl",{antialias:!0});m instanceof WebGLRenderingContext&&(this.gl=m,this.program=(s=n,l=i,d=pt(a=this.gl,a.VERTEX_SHADER,s),v=pt(a,a.FRAGMENT_SHADER,l),d&&v?(u=d,c=v,f=(h=a).createProgram(),h.attachShader(f,u),h.attachShader(f,c),h.linkProgram(f),h.getProgramParameter(f,h.LINK_STATUS)?f:(h.deleteProgram(f),null)):null),this.locations=function(t,e,n){var i,o,r={};for(i=0;i<n.length;i+=1)"a"===(o=n[i])[0]&&(r[o]=t.getAttribLocation(e,o)),"u"===o[0]&&(r[o]=t.getUniformLocation(e,o));return r}(this.gl,this.program,o),this.resize(),this.gl.clearColor(0,0,0,0),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.disable(this.gl.DEPTH_TEST),m.blendFunc(m.SRC_ALPHA,m.ONE_MINUS_SRC_ALPHA),m.enable(m.BLEND),this.gl.useProgram(this.program))}var e,n;return e=t,(n=[{key:"resize",value:function(){var t=window.devicePixelRatio,e=Math.floor(this.gl.canvas.clientWidth*t),n=Math.floor(this.gl.canvas.clientHeight*t);this.gl.canvas.width===e&&this.gl.canvas.height===n||(this.gl.canvas.width=e,this.gl.canvas.height=n),this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight)}}])&&mt(e.prototype,n),t}(),yt={simple:{source:"attribute vec2 a_position;uniform mat3 u_matrix;uniform float u_z;void main() {gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, u_z, 1);}",varNames:["a_position","u_matrix","u_z"]},withTexture:{source:"attribute vec2 a_position;attribute vec2 a_texcoord;uniform mat3 u_matrix;uniform float u_z;varying vec2 v_texcoord;void main() {gl_Position = vec4((u_matrix * vec3(a_position, 1)).xy, u_z, 1);v_texcoord = a_texcoord;}",varNames:["a_position","a_texcoord","u_matrix","u_z"]}},wt={simple:{source:"precision mediump float;uniform vec4 u_color;void main() {gl_FragColor = u_color;}",varNames:["u_color"]},withTexture:{source:"precision mediump float;uniform vec4 u_color;uniform int u_use_texture;uniform sampler2D u_texture;varying vec2 v_texcoord;void main() {if ( u_use_texture == 1) {gl_FragColor = texture2D(u_texture, v_texcoord);} else {gl_FragColor = u_color;}}",varNames:["u_color","u_use_texture","u_texture"]}},bt=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"simple",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"simple";return Object.hasOwnProperty.call(yt,t)&&Object.hasOwnProperty.call(wt,e)?{vertexSource:yt[t].source,fragmentSource:wt[e].source,varNames:yt[t].varNames.concat(wt[e].varNames)}:{vertexSource:"",fragmentSource:"",varNames:[]}};function xt(t){return(xt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _t(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];Object.keys(t).forEach(function(i){-1===n.indexOf(i)&&(e[i]=function t(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e||"function"==typeof e)return e;if("function"==typeof e._dup)return e._dup();if(Array.isArray(e)){var n=[];return e.forEach(function(e){return n.push(t(e))}),n}if("object"!==xt(e))return e;var i={};return Object.keys(e).forEach(function(n){var o=t(e[n]);i[n]=o}),i}(t[i]))})}function kt(){var t=function(t){return"".concat(t).concat(Math.floor(1e6*Math.random()))},e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";0===e.length&&(e="id_random_");for(var n=!0,i=t(e);n;)i=t(e),null==document.getElementById(i)&&(n=!1);return i}function Tt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Pt=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.location=new N(0,0),this.border=[[]],this.holeBorder=[[]]}var e,n;return e=t,(n=[{key:"_dup",value:function(){return this}},{key:"setText",value:function(t){}},{key:"getGLBoundaries",value:function(t){var e=[];return this.border.forEach(function(n){var i=[];n.forEach(function(e){i.push(e.transformBy(t))}),e.push(i)}),e}},{key:"getGLBoundaryHoles",value:function(t){var e=[];return this.holeBorder.forEach(function(n){var i=[];n.forEach(function(e){i.push(e.transformBy(t))}),e.push(i)}),e}},{key:"drawWithTransformMatrix",value:function(t,e,n){}},{key:"getGLBoundingRect",value:function(t){return ut(this.getGLBoundaries(t))}},{key:"getVertexSpaceBoundingRect",value:function(){return ut(this.border)}},{key:"getLocation",value:function(){return this.location}},{key:"getGLLocation",value:function(t){return this.getLocation().transformBy(t)}},{key:"getRelativeGLBoundingRect",value:function(t){var e=this.getGLLocation(t),n=this.getGLBoundingRect(t);return new H(n.left-e.x,n.bottom-e.y,n.width,n.height)}},{key:"getRelativeVertexSpaceBoundingRect",value:function(){var t=this.getVertexSpaceBoundingRect();return new H(t.left-this.location.x,t.bottom-this.location.y,t.width,t.height)}},{key:"change",value:function(){}}])&&Tt(e.prototype,n),t}();function St(t){return(St="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ot(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Mt(t){return(Mt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Et(t,e){return(Et=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Lt=function(t){function e(t,n,i){var o,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"middle",a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"center";!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),o=function(t,e){return!e||"object"!==St(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Mt(e).call(this));var s=document.getElementById(n);return s&&(o.element=s),o.location=i,o.alignV=r,o.alignH=a,o.parentDiv=t,o.show=!0,o.setBorder(),o}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Et(t,e)}(e,Pt),n=e,(i=[{key:"_dup",value:function(){var t=new e(this.parentDiv,this.id,this.location._dup(),this.alignV,this.alignH);return t.show=this.show,t.border=this.border.map(function(t){return t.map(function(t){return t._dup()})}),t}},{key:"setBorder",value:function(){var t=this.parentDiv.getBoundingClientRect(),e=this.element.getBoundingClientRect(),n=e.left-t.left,i=n+e.width,o=e.top-t.top,r=o+e.height,a=[];a.push(new N(n,o)),a.push(new N(i,o)),a.push(new N(i,r)),a.push(new N(n,r)),this.border=[],this.border.push(a)}},{key:"getGLBoundaries",value:function(){var t=this.parentDiv.getBoundingClientRect(),e=at({x:{bottomLeft:0,width:t.width},y:{bottomLeft:t.height,height:-t.height}},{x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}}),n=this.element.getBoundingClientRect(),i=n.left-t.left,o=i+n.width,r=n.top-t.top,a=r+n.height,s=[];return s.push(new N(i,r)),s.push(new N(o,r)),s.push(new N(o,a)),s.push(new N(i,a)),[s.map(function(t){return t.transformBy(e.matrix())})]}},{key:"glToPixelSpace",value:function(t){var e=(t.x- -1)/2*this.parentDiv.offsetWidth,n=(1-t.y)/2*this.parentDiv.offsetHeight;return new N(e,n)}},{key:"change",value:function(t,e){var n=t;"string"==typeof t&&((n=document.createElement("div")).innerHTML=t),n instanceof HTMLElement&&(this.element.innerHTML="",this.element.appendChild(n),this.transformHtml(e))}},{key:"transformHtml",value:function(t){if(this.show){var e=this.location.transformBy(t),n=this.glToPixelSpace(e),i=this.element.offsetWidth,o=this.element.offsetHeight,r=0,a=0;"center"===this.alignH?r=-i/2:"right"===this.alignH&&(r=-i),"middle"===this.alignV?a=-o/2:"bottom"===this.alignV&&(a=-o);var s=n.x+r,l=n.y+a;this.element.style.position="absolute",this.element.style.left="".concat(s,"px"),this.element.style.top="".concat(l,"px")}else this.element.style.position="absolute",this.element.style.left="-10000px",this.element.style.top="-10000px"}},{key:"drawWithTransformMatrix",value:function(t){this.transformHtml(t)}}])&&Ot(n.prototype,i),e}();function At(t){return(At="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ct(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function jt(t){return(jt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Bt(t,e){return(Bt=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Rt=function(t){function e(t){var n;return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(n=function(t,e){return!e||"object"!==At(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,jt(e).call(this))).numPoints=0,n.gl=t.gl,n.webgl=t,n.glPrimative=t.gl.TRIANGLES,n.points=[],n.z=0,n.textureLocation="",n.texturePoints=[],n}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Bt(t,e)}(e,Pt),n=e,(i=[{key:"setupBuffer",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;if(this.numPoints=0===e?this.points.length/2:e,0===this.texturePoints.length&&this.textureLocation&&this.createTextureMap(),this.textureLocation){this.textureBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.texturePoints),this.gl.STATIC_DRAW);var n=this.gl.createTexture();this.gl.bindTexture(this.gl.TEXTURE_2D,n),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,1,1,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]));var i=new Image;i.src=this.textureLocation,i.addEventListener("load",function(){function e(t){return 0==(t&t-1)}t.gl.bindTexture(t.gl.TEXTURE_2D,n),t.gl.pixelStorei(t.gl.UNPACK_FLIP_Y_WEBGL,1),t.gl.texImage2D(t.gl.TEXTURE_2D,0,t.gl.RGBA,t.gl.RGBA,t.gl.UNSIGNED_BYTE,i),e(i.width)&&e(i.height)?t.gl.generateMipmap(t.gl.TEXTURE_2D):(t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_WRAP_S,t.gl.CLAMP_TO_EDGE),t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_WRAP_T,t.gl.CLAMP_TO_EDGE),t.gl.texParameteri(t.gl.TEXTURE_2D,t.gl.TEXTURE_MIN_FILTER,t.gl.LINEAR))})}this.buffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.points),this.gl.STATIC_DRAW)}},{key:"resetBuffer",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;this.textureLocation&&(this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.deleteTexture(this.textureBuffer)),this.gl.deleteBuffer(this.buffer),this.setupBuffer(t)}},{key:"change",value:function(t){this.resetBuffer()}},{key:"changeVertices",value:function(t){var e=this;this.points=[],this.border=[];var n=null,i=null,o=null,r=null;t.forEach(function(t){e.points.push(t.x),e.points.push(t.y),(null===n||t.x<n)&&(n=t.x),(null===i||t.y<i)&&(i=t.y),(null===r||t.y>r)&&(r=t.y),(null===o||t.x>o)&&(o=t.x)}),null!=n&&null!=i&&null!=o&&null!=r&&(this.border[0]=[new N(n,i),new N(n,r),new N(o,r),new N(o,i)]),this.resetBuffer()}},{key:"getPointCountForAngle",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2*Math.PI;return this.numPoints*t/(2*Math.PI)}},{key:"getPointCountForLength",value:function(t){return this.numPoints}},{key:"createTextureMap",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:-1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:1,a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,s=e-t,l=i-n,h=r-o,u=(7<arguments.length&&void 0!==arguments[7]?arguments[7]:1)-a;this.texturePoints=[];for(var c=0;c<this.points.length;c+=2){var f=(this.points[c]-t)/s,d=(this.points[c+1]-n)/l;this.texturePoints.push(f*h+o),this.texturePoints.push(d*u+a)}}},{key:"draw",value:function(t,e,n,i,o){var r=[1,0,0,0,1,0,0,0,1];r=A(r=E(r=O(r,t.x,t.y),e),n.x,n.y),this.drawWithTransformMatrix(P(r),o,i)}},{key:"drawWithTransformMatrix",value:function(t,e,n){var i=this.gl.FLOAT;if(this.gl.enableVertexAttribArray(this.webgl.locations.a_position),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.buffer),this.gl.vertexAttribPointer(this.webgl.locations.a_position,2,i,!1,0,0),this.gl.uniformMatrix3fv(this.webgl.locations.u_matrix,!1,P(t)),this.gl.uniform1f(this.webgl.locations.u_z,this.z),this.gl.uniform4f(this.webgl.locations.u_color,e[0],e[1],e[2],e[3]),this.textureLocation){var o=this.gl.FLOAT;this.gl.enableVertexAttribArray(this.webgl.locations.a_texcoord),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureBuffer),this.gl.vertexAttribPointer(this.webgl.locations.a_texcoord,2,o,!1,0,0)}this.textureLocation?this.gl.uniform1i(this.webgl.locations.u_use_texture,1):this.gl.uniform1i(this.webgl.locations.u_use_texture,0),this.gl.drawArrays(this.glPrimative,0,n),this.textureLocation&&this.gl.disableVertexAttribArray(this.webgl.locations.a_texcoord)}},{key:"transform",value:function(t){for(var e=0;e<this.points.length;e+=2){var n=new N(this.points[e],this.points[e+1]);n=n.transformBy(t),this.points[e]=n.x,this.points[e+1]=n.y}for(var i=0;i<this.border.length;i+=1)for(var o=0;o<this.border[i].length;o+=1)this.border[i][o]=this.border[i][o].transformBy(t)}}])&&Ct(n.prototype,i),e}();function Dt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var It=function(){function t(e){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.canvas=e,this.ctx=this.canvas.getContext("2d");var n=this.ctx.webkitBackingStorePixelRatio||this.ctx.mozBackingStorePixelRatio||this.ctx.msBackingStorePixelRatio||this.ctx.oBackingStorePixelRatio||this.ctx.backingStorePixelRatio||1,i=window.devicePixelRatio||1;1===i&&(i=2),this.ratio=i/n,this.resize()}var e,n;return e=t,(n=[{key:"resize",value:function(){this.ctx.setTransform(1,0,0,1,0,0),this.canvas.width=this.canvas.clientWidth*this.ratio,this.canvas.height=this.canvas.clientHeight*this.ratio,this.ctx.scale(this.ratio,this.ratio)}},{key:"_dup",value:function(){return this}}])&&Dt(e.prototype,n),t}();function Ft(t){return(Ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function qt(t){return(qt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ht(t,e){return(Ht=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Nt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Gt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function zt(t,e,n){return e&&Gt(t.prototype,e),n&&Gt(t,n),t}function Wt(t){return"rgba(".concat(Math.floor(255*t[0]),",").concat(Math.floor(255*t[1]),",").concat(Math.floor(255*t[2]),",").concat(t[3],")")}var Vt=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Helvetica Neue",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"200",r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"center",a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"middle",s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null;Nt(this,t),this.family=e,this.style=n,this.size=i,this.weight=o,this.alignH=r,this.alignV=a,this.setColor(s)}return zt(t,[{key:"setColor",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;Array.isArray(t)?this.color=Wt(t):this.color=t}},{key:"set",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;t.font="".concat(this.style," ").concat(this.weight," ").concat(this.size*e,"px ").concat(this.family),t.textAlign=this.alignH,t.textBaseline=this.alignV}},{key:"_dup",value:function(){return new t(this.family,this.style,this.size,this.weight,this.alignH,this.alignV,this.color)}}]),t}(),Ut=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new N(0,0),n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Vt;Nt(this,t),this.location=e._dup(),this.text=n.slice(),this.font=i._dup()}return zt(t,[{key:"_dup",value:function(){return new t(this.location._dup(),this.text,this.font._dup())}}]),t}(),Xt=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];if(Nt(this,e),(n=function(t,e){return!e||"object"!==Ft(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,qt(e).call(this))).drawContext2D=t,n.text=i,n.scalingFactor=1,0<i.length){var o=n.text[0].font.size;if(n.text.forEach(function(t){0<t.font.size&&t.font.size<o&&(o=t.font.size)}),o<20&&(n.scalingFactor=50*o),o<1){var r=2-Math.log10(o);n.scalingFactor=Math.pow(10,r)}}return n.setBorder(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ht(t,e)}(e,Pt),zt(e,[{key:"setText",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;this.text[e].text=t,this.setBorder()}},{key:"_dup",value:function(){var t=new e(this.drawContext2D,this.text);return _t(this,t),t.scalingFactor=this.scalingFactor,t.border=this.border.map(function(t){return t.map(function(t){return t._dup()})}),t}},{key:"setFont",value:function(t){for(var e=0;e<this.text.length;e+=1)this.text[e].font.size=t;this.setBorder()}},{key:"setColor",value:function(t){for(var e=Wt(t),n=0;n<this.text.length;n+=1)this.text[n].font.color=e}},{key:"draw",value:function(t,e,n,i,o){var r=[1,0,0,0,1,0,0,0,1];r=A(r=E(r=O(r,t.x,t.y),e),n.x,n.y),this.drawWithTransformMatrix(P(r),o)}},{key:"drawWithTransformMatrix",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[1,1,1,1],n=this.drawContext2D.ctx,i=this.scalingFactor,o="rgba(\n      ".concat(Math.floor(255*e[0]),",\n      ").concat(Math.floor(255*e[1]),",\n      ").concat(Math.floor(255*e[2]),",\n      ").concat(Math.floor(255*e[3]),")");n.save();var r=this.drawContext2D.canvas.offsetWidth/2/i,a=this.drawContext2D.canvas.offsetHeight/2/i,s=t,l=T([r,0,this.drawContext2D.canvas.offsetWidth/2,0,a,this.drawContext2D.canvas.offsetHeight/2,0,0,1],[s[0],-s[1],s[2]*i,-s[3],s[4],s[5]*-i,0,0,1]);n.transform(l[0],l[3],l[1],l[4],l[2],l[5]),this.text.forEach(function(t){t.font.set(n,i),t.font.color?n.fillStyle=t.font.color:n.fillStyle=o,n.fillText(t.text,t.location.x*i,t.location.y*-i)}),n.restore()}},{key:"getGLBoundaries",value:function(t){var e=this,n=[];return this.text.forEach(function(i){n.push(e.getGLBoundaryOfText(i,t))}),n}},{key:"setBorder",value:function(){var t=this;this.border=[],this.text.forEach(function(e){t.border.push(t.getBoundaryOfText(e))})}},{key:"measureText",value:function(t,e){var n=t.measureText("a").width,i=1.4*n,o=.08*n,r=e.text.match(/[acemnorsuvwxz*gyqp]/g);Array.isArray(r)&&r.length===e.text.length&&(i=.95*n);var a=e.text.match(/[;,$]/g);Array.isArray(a)&&0<a.length&&(o=.2*n);var s=e.text.match(/[gjyqp@Q(){}[\]|]/g);Array.isArray(s)&&0<s.length&&(o=.5*n);var l=i+o,h=t.measureText(e.text).width,u=0,c=0,f=0,d=0;return"left"===e.font.alignH&&(d=h),"center"===e.font.alignH&&(d=f=h/2),"right"===e.font.alignH&&(f=h),"alphabetic"===e.font.alignV&&(u=i,c=o),"top"===e.font.alignV&&(u=0,c=l),"bottom"===e.font.alignV&&(u=l,c=0),"middle"===e.font.alignV&&(c=u=l/2),{actualBoundingBoxLeft:f,actualBoundingBoxRight:d,fontBoundingBoxAscent:u,fontBoundingBoxDescent:c}}},{key:"getBoundaryOfText",value:function(t){var e=[],n=this.scalingFactor;t.font.set(this.drawContext2D.ctx,n);var i=this.measureText(this.drawContext2D.ctx,t),o=t.location;return[new N(-i.actualBoundingBoxLeft/n,i.fontBoundingBoxAscent/n).add(o),new N(i.actualBoundingBoxRight/n,i.fontBoundingBoxAscent/n).add(o),new N(i.actualBoundingBoxRight/n,-i.fontBoundingBoxDescent/n).add(o),new N(-i.actualBoundingBoxLeft/n,-i.fontBoundingBoxDescent/n).add(o)].forEach(function(t){e.push(t)}),e}},{key:"getGLBoundaryOfText",value:function(t,e){var n=[];return this.getBoundaryOfText(t).forEach(function(t){n.push(t.transformBy(e))}),n}}]),e}();function Yt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qt(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Zt(t,e,n){return e&&Qt(t.prototype,e),n&&Qt(t,n),t}var Kt=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new rt,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,a=!(5<arguments.length&&void 0!==arguments[5])||arguments[5],s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:d,l=7<arguments.length&&void 0!==arguments[7]?arguments[7]:"linear",h=8<arguments.length&&void 0!==arguments[8]?arguments[8]:{rot:1,magnitude:.5,offset:.5,controlPoint:null,direction:""};Yt(this,t),this.startTransform=null==e?null:e._dup(),this.targetTransform=n._dup(),this.timeOrVelocity=i,this.rotDirection=o,this.animationStyle=s,this.translationStyle=l,this.translationOptions=h,this.callback=r,this.finishOnCancel=a,this.startTime=-1,this.deltaTransform=new rt}return Zt(t,[{key:"_dup",value:function(){var e=new t(this.startTransform,this.targetTransform,this.timeOrVelocity,this.rotDirection,this.callback,this.finishOnCancel,this.animationStyle,this.translationStyle,Object.assign({},this.translationOptions));return e.startTime=this.startTime,e.deltaTransform=this.deltaTransform._dup(),e}},{key:"start",value:function(t){var e=this;null==this.startTransform&&(this.startTransform=t._dup());var n=this.startTransform;if(null!=n){this.deltaTransform=this.targetTransform.sub(n);var i;i="number"==typeof this.timeOrVelocity?this.timeOrVelocity:dt(n,this.targetTransform,this.timeOrVelocity,this.rotDirection),this.time=0===i?1:i,this.deltaTransform.order.forEach(function(t,i){var o=n.order[i],r=e.targetTransform.order[i];if(t instanceof $&&o instanceof $&&r instanceof $){var a=Q(o.r,r.r,e.rotDirection);t.r=a}}),this.startTime=-1}}},{key:"finish",value:function(t){var e=this,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=function(){t.setTransform(e.targetTransform)};null===i&&(n&&!this.finishOnCancel||o()),!0===i&&o(),null!=this.callback&&this.callback(n)}}]),t}(),$t=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[0,0,0,1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,a=!(5<arguments.length&&void 0!==arguments[5])||arguments[5],s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:f;Yt(this,t),this.targetColor=n.slice(),this.endColor=n.slice(),"out"===o&&(this.targetColor[3]=.01),this.time=i,this.animationStyle=s,this.disolve=o,this.finishOnCancel=a,this.startTime=-1,this.startColor=e,this.deltaColor=[0,0,0,1],this.callback=r}return Zt(t,[{key:"_dup",value:function(){var e=new t(this.startColor,this.targetColor,this.time,this.disolve,this.callback,this.finishOnCancel,this.animationStyle);return e.startTime=this.startTime,e.deltaColor=this.deltaColor.slice(),e}},{key:"start",value:function(t){null==this.startColor&&(this.startColor=t.color.slice());var e=this.startColor;null!=e&&("in"===this.disolve&&(this.startColor[3]=.01,t.setColor(e.slice()),t.showAll()),this.deltaColor=this.targetColor.map(function(t,n){return t-e[n]})),this.startTime=-1}},{key:"finish",value:function(t){var e=this,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,o=function(){t.setColor(e.endColor),"out"===e.disolve&&t.hide()};null===i&&(n&&!this.finishOnCancel||o()),!0===i&&o(),null!=this.callback&&this.callback(n)}}]),t}(),Jt=function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:d;Yt(this,t),this.time=n,this.startPercent=i,this.animationCallback=e,this.startTime=-1,this.animationStyle=a,this.plannedStartTime=a(i,!0)*n,this.callback=o,this.finishOnCancel=r}return Zt(t,[{key:"_dup",value:function(){var e=new t(this.animationCallback,this.time,this.startPercent,this.callback,this.finishOnCancel,this.animationStyle);return e.startTime=this.startTime,e}},{key:"start",value:function(){this.startTime=-1}},{key:"finish",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=function(){t.animationCallback(1)};null===n&&(e&&!this.finishOnCancel||i()),!0===n&&i(),null!=this.callback&&this.callback(e)}}]),t}();function te(t){return(te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ee(t,e){return!e||"object"!==te(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function ne(t,e,n){return(ne="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ie(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function ie(t){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function oe(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}function re(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function ae(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function se(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function le(t,e,n){return e&&se(t.prototype,e),n&&se(t,n),t}function he(t){var e=function(){};return"function"==typeof t&&(e=t),e}var ue=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new rt,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new H(-1,-1,2,2);ae(this,t),this.name="",this.uid=(1e18*Math.random()).toString(36),this.isShown=!0,this.transform=e._dup(),this.isMovable=!1,this.isTouchable=!1,this.isInteractive=!1,this.hasTouchableElements=!1,this.color=[1,1,1,1],this.setTransformCallback=function(){},this.lastDrawTransform=this.transform._dup(),this.onClick=null,this.lastDrawElementTransformPosition={parentCount:0,elementCount:0},this.noRotationFromParent=!1,this.animate={color:{plan:[],toDisolve:"",callback:null},transform:{plan:[],translation:{style:"linear",options:{rot:1,magnitude:.5,offset:.5,controlPoint:null,direction:""}},callback:null},custom:{plan:[],callback:null}},this.diagramLimits=n,this.move={maxTransform:this.transform.constant(1e3),minTransform:this.transform.constant(-1e3),limitToDiagram:!1,maxVelocity:new ot(5,5,5),freely:{zeroVelocityThreshold:new ot(.001,.001,.001),deceleration:new ot(5,5,5)},bounce:!0,canBeMovedAfterLoosingTouch:!1,type:"translation",element:null,limitLine:null},this.pulse={time:1,frequency:.5,A:1,B:.5,C:0,style:p,num:1,transformMethod:function(t){return(new rt).scale(t,t)},callback:function(){}},this.state={isAnimating:!1,isAnimatingColor:!1,isAnimatingCustom:!1,disolving:"",animation:{currentPhaseIndex:0,currentPhase:new Kt},colorAnimation:{currentPhaseIndex:0,currentPhase:new $t},customAnimation:{currentPhaseIndex:0,currentPhase:new Jt(function(){})},isBeingMoved:!1,isMovingFreely:!1,movement:{previousTime:-1,previousTransform:this.transform._dup(),velocity:this.transform.zero()},isPulsing:!1,pulse:{startTime:-1}},this.interactiveLocation=new N(0,0)}return le(t,[{key:"calcNextAnimationTransform",value:function(t){var e=this.state.animation.currentPhase,n=e.startTransform._dup(),i=e.deltaTransform._dup(),o=t/e.time,r=e.animationStyle(o);return n.toDelta(i,r,e.translationStyle,e.translationOptions)}},{key:"calcNextAnimationColor",value:function(t){var e=this.state.colorAnimation.currentPhase,n=e.startColor,i=e.deltaColor,o=t/e.time,r=e.animationStyle(o),a=[0,0,0,1];return null!=n&&(a=n.map(function(t,e){return t+i[e]*r})),a}},{key:"calcNextCustomAnimationPercentComplete",value:function(t){var e=this.state.customAnimation.currentPhase,n=t/e.time;return e.animationStyle(n)}},{key:"setPosition",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=t;"number"==typeof t&&(n=new N(t,e));var i=this.transform._dup();i.updateTranslation(n),this.setTransform(i)}},{key:"setTransform",value:function(t){this.transform=t._dup().clip(this.move.minTransform,this.move.maxTransform,this.move.limitLine),this.setTransformCallback&&this.setTransformCallback(this.transform)}},{key:"setNextTransform",value:function(t){if(this.state.isAnimating){var e=this.state.animation.currentPhase;if(e.startTime<0)return void(e.startTime=t);var n=t-e.startTime;if(n>e.time){if(this.state.animation.currentPhaseIndex<this.animate.transform.plan.length-1){e.finish(this);var i=n-e.time;return this.state.animation.currentPhaseIndex+=1,this.animatePhase(this.state.animation.currentPhaseIndex),this.state.animation.currentPhase.startTime=t-i,void this.setNextTransform(t)}return void this.stopAnimating(!1)}this.setTransform(this.calcNextAnimationTransform(n))}else if(this.state.isMovingFreely){if(this.state.movement.previousTime<0)return void(this.state.movement.previousTime=t);var o=t-this.state.movement.previousTime,r=this.decelerate(o);this.state.movement.velocity=r.velocity,this.state.movement.previousTime=t,this.state.movement.velocity.isZero()&&(this.state.movement.velocity=this.state.movement.velocity.zero(),this.stopMovingFreely(!1)),this.setTransform(r.transform)}}},{key:"setNextCustomAnimation",value:function(t){if(this.state.isAnimatingCustom){var e=this.state.customAnimation.currentPhase;if(e.startTime<0)return void(e.startTime=t-e.plannedStartTime);var n=t-e.startTime;if(n>e.time){if(this.state.customAnimation.currentPhaseIndex<this.animate.custom.plan.length-1){e.finish();var i=n-e.time;return this.state.customAnimation.currentPhaseIndex+=1,this.animateCustomPhase(this.state.customAnimation.currentPhaseIndex),this.state.customAnimation.currentPhase.startTime=t-i,void this.setNextCustomAnimation(t)}return void this.stopAnimatingCustom(!0)}var o=this.calcNextCustomAnimationPercentComplete(n);e.animationCallback(o)}}},{key:"setNextColor",value:function(t){if(this.state.isAnimatingColor){var e=this.state.colorAnimation.currentPhase;if(e.startTime<0)return void(e.startTime=t);var n=t-e.startTime;if(n>e.time){if(this.state.colorAnimation.currentPhaseIndex<this.animate.color.plan.length-1){e.finish(this);var i=n-e.time;return this.state.colorAnimation.currentPhaseIndex+=1,this.animateColorPhase(this.state.colorAnimation.currentPhaseIndex),this.state.colorAnimation.currentPhase.startTime=t-i,void this.setNextColor(t)}return void this.stopAnimatingColor(!1)}this.setColor(this.calcNextAnimationColor(n))}}},{key:"setColor",value:function(t){this.color=t.slice()}},{key:"decelerate",value:function(t){var e=this.transform.decelerate(this.state.movement.velocity,this.move.freely.deceleration,t,this.move.freely.zeroVelocityThreshold);if(0<t){for(var n=0;n<e.t.order.length;n+=1){var i=e.t.order[n],o=this.move.minTransform.order[n],r=this.move.maxTransform.order[n],a=e.v.order[n];if(i instanceof J&&a instanceof J&&r instanceof J&&o instanceof J||i instanceof tt&&a instanceof tt&&r instanceof tt&&o instanceof tt){var s=!0;null!=this.move.limitLine&&(s=i.shaddowIsOnLine(this.move.limitLine,4)),(o.x>=i.x||r.x<=i.x||!s)&&(this.move.bounce?a.x=.5*-a.x:a.x=0),(o.y>=i.y||r.y<=i.y||!s)&&(this.move.bounce?a.y=.5*-a.y:a.y=0),e.v.order[n]=a}i instanceof $&&a instanceof $&&r instanceof $&&o instanceof $&&((o.r>=i.r||r.r<=i.r)&&(this.move.bounce?a.r=.5*-a.r:a.r=0),e.v.order[n]=a)}e.v.calcMatrix()}return{velocity:e.v,transform:e.t}}},{key:"updateLastDrawTransform",value:function(){var t=this,e=this.lastDrawElementTransformPosition.parentCount,n=this.lastDrawTransform.order.length;this.transform.order.forEach(function(i,o){t.lastDrawTransform.order[n-e-o-1]=i._dup()}),this.lastDrawTransform.calcMatrix()}},{key:"getParentLastDrawTransform",value:function(){var t=this.lastDrawElementTransformPosition.parentCount;return new rt(this.lastDrawTransform.order.slice(-t))}},{key:"animatePlan",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.stopAnimating(),this.stopMovingFreely(),this.stopBeingMoved(),this.animate.transform.plan=[];for(var n=0,i=t.length;n<i;n+=1)this.animate.transform.plan.push(t[n]);0<this.animate.transform.plan.length&&(e&&(this.animate.transform.callback=e),this.state.isAnimating=!0,this.state.animation.currentPhaseIndex=0,this.animatePhase(this.state.animation.currentPhaseIndex))}},{key:"animateColorPlan",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.stopAnimatingColor(),this.animate.color.plan=[];for(var n=0,i=t.length;n<i;n+=1)this.animate.color.plan.push(t[n]);0<this.animate.color.plan.length&&(e&&(this.animate.color.callback=e),this.state.isAnimatingColor=!0,this.state.colorAnimation.currentPhaseIndex=0,this.animateColorPhase(this.state.colorAnimation.currentPhaseIndex))}},{key:"animateCustomPlan",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.stopAnimatingCustom(),this.animate.custom.plan=[];for(var n=0,i=t.length;n<i;n+=1)this.animate.custom.plan.push(t[n]);0<this.animate.custom.plan.length&&(e&&(this.animate.custom.callback=e),this.state.isAnimatingCustom=!0,this.state.customAnimation.currentPhaseIndex=0,this.animateCustomPhase(this.state.customAnimation.currentPhaseIndex))}},{key:"animatePhase",value:function(t){this.state.animation.currentPhase=this.animate.transform.plan[t],this.state.animation.currentPhase.start(this.transform._dup())}},{key:"animateColorPhase",value:function(t){this.state.colorAnimation.currentPhase=this.animate.color.plan[t],this.state.colorAnimation.currentPhase.start(this)}},{key:"animateCustomPhase",value:function(t){this.state.customAnimation.currentPhase=this.animate.custom.plan[t],this.state.customAnimation.currentPhase.start()}},{key:"stopAnimatingGeneric",value:function(t,e,n,i,o){var r=!1,a=!1,s=this.animate[i],l=s.plan,h=s.callback;if(0<l.length&&this.state[o]&&t&&(r=!0),t||(a=!0),this.state[o]=!1,this.animate[i].plan=[],this.animate[i].callback=null,r)for(var u=l.length-1,c=n;c<=u;c+=1){var f=l[c];f instanceof Jt?f.finish(t,e):f.finish(this,t,e)}if(a&&0<l.length){var d=l.slice(-1)[0];d instanceof Jt?d.finish(t,e):d.finish(this,t,e)}null!=h&&h(t)}},{key:"stopAnimating",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.stopAnimatingGeneric(t,e,this.state.animation.currentPhaseIndex,"transform","isAnimating")}},{key:"stopAnimatingColor",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.stopAnimatingGeneric(t,e,this.state.colorAnimation.currentPhaseIndex,"color","isAnimatingColor")}},{key:"stopAnimatingCustom",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.stopAnimatingGeneric(t,e,this.state.colorAnimation.currentPhaseIndex,"custom","isAnimatingCustom")}},{key:"animateTo",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:d;this.animateTransformToWithDelay(t,n,e,i,o,!0,r)}},{key:"animateFrom",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:d,r=this.transform._dup();this.animateTransformToWithDelay(r,0,e,n,i,!0,o)}},{key:"animateColorTo",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:f;this.animateColorToWithDelay(t,0,e,null,n,i,o)}},{key:"animateTransformToWithDelay",value:function(t){var e,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,a=!(5<arguments.length&&void 0!==arguments[5])||arguments[5],s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:d,l=!(7<arguments.length&&void 0!==arguments[7])||arguments[7],h=he(r);if(e=i instanceof rt?dt(this.transform,t,i,o):i,0===n&&0===e)return this.setTransform(t),void h(!1);var u=null,c=null,v=[],m=null,p=h;if(0===e&&(m=function(t){h(t)},p=null),0<n){var g=this.transform._dup();l&&0<this.animate.transform.plan.length&&(g=this.animate.transform.plan.slice(-1)[0].targetTransform._dup()),u=new Kt(g,g,n,o,m,a,f,this.animate.transform.translation.style,this.animate.transform.translation.options),v.push(u)}0<e&&(c=new Kt(null,t,i,o,p,a,s,this.animate.transform.translation.style,this.animate.transform.translation.options),v.push(c)),0<v.length&&(l&&this.state.isAnimating?this.animate.transform.plan=re(this.animate.transform.plan).concat(v):this.animatePlan(v))}},{key:"animateColorToWithDelay",value:function(t,e){var n=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,a=!(5<arguments.length&&void 0!==arguments[5])||arguments[5],s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:f,l=!(7<arguments.length&&void 0!==arguments[7])||arguments[7],h=he(r);if(0===e&&0===i)return this.setColor(t),void h(!1);var u=null,c=null,d=[],v=null,m=h;if(0===i&&(v=function(e){!e&&a&&n.setColor(t),h(e)},m=null),0<e){var p=this.color.slice();l&&0<this.animate.color.plan.length&&(p=this.animate.color.plan.slice(-1)[0].targetColor.slice());var g=null;"in"===o&&(p[3]=.01,g="in"),u=new $t(p,p,e,g,v,a,f),d.push(u)}0<i&&(c=new $t(null,t,i,o,m,a,s),d.push(c)),0<d.length&&(l&&this.state.isAnimatingColor?this.animate.color.plan=re(this.animate.color.plan).concat(d):this.animateColorPlan(d))}},{key:"disolveOutWithDelay",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.animateColorToWithDelay(this.color,t,e,"out",n)}},{key:"disolveInWithDelay",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.animateColorToWithDelay(this.color,t,e,"in",n)}},{key:"disolveWithDelay",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"in",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];this.animateColorToWithDelay(this.color,t,e,n,i,o)}},{key:"animateCustomTo",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:f;this.animateCustomToWithDelay(0,t,e,n,i,!0,o,!0)}},{key:"animateCustomToWithDelay",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=!(5<arguments.length&&void 0!==arguments[5])||arguments[5],a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:d,s=!(7<arguments.length&&void 0!==arguments[7])||arguments[7],l=he(o);if(0===t&&0===n)return e(1),void l(!1);var h=null,u=null,c=[],v=null,m=l;0===n&&(v=function(t){l(t)},m=null),0<t&&(h=new Jt(function(){},t,0,v,r,f),c.push(h)),0<n&&(u=new Jt(e,n,i,m,r,a),c.push(u)),0<c.length&&(s&&this.state.isAnimating?this.animate.custom.plan=re(this.animate.custom.plan).concat(c):this.animateCustomPlan(c))}},{key:"disolveIn",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.disolveInWithDelay(0,t,e)}},{key:"disolveOut",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.disolveOutWithDelay(0,t,e)}},{key:"animateTranslationTo",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:d,o=this.transform._dup();o.updateTranslation(t),this.animateTransformToWithDelay(o,0,e,0,n,!0,i)}},{key:"animateScaleTo",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:d,o=this.transform._dup();o.updateScale(t),this.animateTransformToWithDelay(o,0,e,0,n,!0,i)}},{key:"animateTranslationFrom",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:d,o=this.transform._dup();this.transform.updateTranslation(t),this.animateTransformToWithDelay(o,0,e,0,n,!0,i)}},{key:"animateTranslationToWithDelay",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:d,r=this.transform._dup();r.updateTranslation(t),this.animateTransformToWithDelay(r,e,n,0,i,!0,o)}},{key:"animateRotationTo",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:d,r=this.transform._dup();r.updateRotation(t),this.animateTransformToWithDelay(r,0,n,e,i,!0,o)}},{key:"animateTranslationAndRotationTo",value:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:d,a=this.transform._dup();a.updateRotation(e),a.updateTranslation(t._dup()),this.animateTransformToWithDelay(a,0,i,n,o,!0,r)}},{key:"animateTranslationAndScaleTo",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:d,r=this.transform._dup();"number"==typeof e?r.updateScale(e,e):r.updateScale(e._dup()),r.updateTranslation(t._dup()),this.animateTransformToWithDelay(r,0,n,0,i,!0,o)}},{key:"startBeingMoved",value:function(){this.stopAnimating(),this.stopMovingFreely(),this.state.movement.velocity=this.transform.zero(),this.state.movement.previousTransform=this.transform._dup(),this.state.movement.previousTime=Date.now()/1e3,this.state.isBeingMoved=!0}},{key:"moved",value:function(t){this.calcVelocity(t),this.setTransform(t._dup())}},{key:"stopBeingMoved",value:function(){var t=Date.now()/1e3;-1!==this.state.movement.previousTime&&.05<t-this.state.movement.previousTime&&(this.state.movement.velocity=this.transform.zero()),this.state.isBeingMoved=!1,this.state.movement.previousTime=-1}},{key:"calcVelocity",value:function(t){var e=Date.now()/1e3;if(this.state.movement.previousTime<0)this.state.movement.previousTime=e;else{var n=e-this.state.movement.previousTime;n<1e-4||(this.state.movement.velocity=t.velocity(this.transform,n,this.move.freely.zeroVelocityThreshold,this.move.maxVelocity),this.state.movement.previousTime=e)}}},{key:"startMovingFreely",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;this.stopAnimating(),this.stopBeingMoved(),t&&(this.animate.transform.callback=t),this.state.isMovingFreely=!0,this.state.movement.previousTime=-1,this.state.movement.velocity=this.state.movement.velocity.clipMag(this.move.freely.zeroVelocityThreshold,this.move.maxVelocity)}},{key:"stopMovingFreely",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.state.isMovingFreely=!1,this.state.movement.previousTime=-1,this.animate.transform.callback&&(this.animate.transform.callback(t),this.animate.transform.callback=null)}},{key:"transformWithPulse",value:function(t,e){var n=[];if(this.state.isPulsing){-1===this.state.pulse.startTime&&(this.state.pulse.startTime=t);var i=t-this.state.pulse.startTime;i>this.pulse.time&&0!==this.pulse.time&&(this.stopPulsing(!0),i=this.pulse.time);for(var o=0;o<this.pulse.num;o+=1){var r=this.pulse.style(i,this.pulse.frequency,this.pulse.A instanceof Array?this.pulse.A[o]:this.pulse.A,this.pulse.B instanceof Array?this.pulse.B[o]:this.pulse.B,this.pulse.C instanceof Array?this.pulse.C[o]:this.pulse.C),a=this.pulse.transformMethod(r);n.push(e.transform(a))}}else n.push(e._dup());return n}},{key:"pulseScaleNow",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;this.pulse.time=t,0===n&&0===t&&(this.pulse.frequency=1),0!==n&&(this.pulse.frequency=n),0!==t&&0===n&&(this.pulse.frequency=1/(2*t)),this.pulse.A=1,this.pulse.B=e-1,this.pulse.C=0,this.pulse.num=1,this.pulse.callback=i,this.pulseNow()}},{key:"pulseThickNow",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:3,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=[e];if(this.pulse.num=n,1<this.pulse.num){var r=Math.abs(1-e),a=r,s=(a- -r)/(this.pulse.num-1);o=[];for(var l=0;l<this.pulse.num;l+=1)o.push(a-l*s)}this.pulse.time=t,this.pulse.frequency=1/(2*t),this.pulse.A=1,this.pulse.B=o,this.pulse.C=0,this.pulse.callback=i,this.pulseNow()}},{key:"pulseNow",value:function(){this.state.isPulsing=!0,this.state.pulse.startTime=-1}},{key:"stopPulsing",value:function(t){if(this.state.isPulsing=!1,this.pulse.callback){var e=this.pulse.callback;this.pulse.callback=null,e(t)}}},{key:"stop",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.stopAnimating(t,e),this.stopAnimatingColor(t,e),this.stopAnimatingCustom(t,e),this.stopMovingFreely(t),this.stopBeingMoved(),this.stopPulsing(t)}},{key:"updateLimits",value:function(t){this.diagramLimits=t}},{key:"getGLBoundingRect",value:function(){return new H(0,0,1,1)}},{key:"getDiagramBoundingRect",value:function(){var t=this.getGLBoundingRect(),e=new N(this.diagramLimits.width/2,this.diagramLimits.height/2);return new H(t.left*e.x,t.bottom*e.y,t.width*e.x,t.height*e.y)}},{key:"getRelativeGLBoundingRect",value:function(){return new H(0,0,1,1)}},{key:"getRelativeDiagramBoundingRect",value:function(){var t=this.getRelativeGLBoundingRect(),e=new N(this.diagramLimits.width/2,this.diagramLimits.height/2);return new H(t.left*e.x,t.bottom*e.y,t.width*e.x,t.height*e.y)}},{key:"getCenterDiagramPosition",value:function(){var t=this.getDiagramBoundingRect();return new N(t.left+t.width/2,t.bottom+t.height/2)}},{key:"getPosition",value:function(){var t=this.transform.t(),e=new N(0,0);return null!=t&&(e=t._dup()),e}},{key:"getVertexSpaceDiagramPosition",value:function(t){var e=t.transformBy(this.lastDrawTransform.matrix()),n=at({x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}},{x:{bottomLeft:this.diagramLimits.left,width:this.diagramLimits.width},y:{bottomLeft:this.diagramLimits.bottom,height:this.diagramLimits.height}});return e.transformBy(n.matrix())}},{key:"getDiagramPosition",value:function(){return this.getVertexSpaceDiagramPosition(new N(0,0))}},{key:"setDiagramPosition",value:function(t){var e,n,i=at({x:{bottomLeft:this.diagramLimits.left,width:this.diagramLimits.width},y:{bottomLeft:this.diagramLimits.bottom,height:this.diagramLimits.height}},{x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}}),o=t.transformBy(i.matrix()),r=new rt(this.lastDrawTransform.order.slice(2)),a=o.transformBy((n=1/((e=r.matrix())[0]*(e[4]*e[8]-e[7]*e[5])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6])),[(e[4]*e[8]-e[7]*e[5])*n,(e[2]*e[7]-e[1]*e[8])*n,(e[1]*e[5]-e[2]*e[4])*n,(e[5]*e[6]-e[3]*e[8])*n,(e[0]*e[8]-e[2]*e[6])*n,(e[3]*e[2]-e[0]*e[5])*n,(e[3]*e[7]-e[6]*e[4])*n,(e[6]*e[1]-e[0]*e[7])*n,(e[0]*e[4]-e[3]*e[1])*n]));this.setPosition(a._dup())}},{key:"setDiagramPositionToElement",value:function(t){var e=t.getDiagramPosition();this.setDiagramPosition(e._dup())}},{key:"setPositionToElement",value:function(t){var e=t.transform.t();null!=e&&this.setPosition(e._dup())}},{key:"setMoveBoundaryToDiagram",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[this.diagramLimits.left,this.diagramLimits.top-this.diagramLimits.height,this.diagramLimits.left+this.diagramLimits.width,this.diagramLimits.top],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new N(1,1);if(this.isMovable&&this.move.limitToDiagram){var n=at({x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}},{x:{bottomLeft:this.diagramLimits.left,width:this.diagramLimits.width},y:{bottomLeft:this.diagramLimits.bottom,height:this.diagramLimits.height}}),i=this.getRelativeGLBoundingRect(),o=[n.matrix()[0],0,0,0,n.matrix()[4],0,0,0,1],r=new N(i.left,i.bottom).transformBy(o),a=new N(i.right,i.top).transformBy(o),s=new N(0,0),l=new N(0,0);s.x=t[0]-r.x*e.x,s.y=t[1]-r.y*e.y,l.x=t[2]-a.x*e.x,l.y=t[3]-a.y*e.y,this.move.maxTransform.updateTranslation(l.x,l.y),this.move.minTransform.updateTranslation(s.x,s.y)}}},{key:"show",value:function(){this.isShown=!0}},{key:"showAll",value:function(){this.show()}},{key:"hide",value:function(){this.isShown=!1}},{key:"hideAll",value:function(){this.hide()}},{key:"toggleShow",value:function(){this.isShown?this.hide():this.show()}},{key:"click",value:function(){null!==this.onClick&&void 0!==this.onClick&&this.onClick(this)}},{key:"setMovable",value:function(){(!(0<arguments.length&&void 0!==arguments[0])||arguments[0])&&(this.isTouchable=!0,this.isMovable=!0)}}]),t}(),ce=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new rt,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[.5,.5,.5,1],r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new H(-1,-1,2,2);return ae(this,e),(n=ee(this,ie(e).call(this,i,r))).drawingObject=t,n.color=o.slice(),n.pointsToDraw=-1,n.angleToDraw=-1,n.lengthToDraw=-1,n.cannotTouchHole=!1,n}return oe(e,ue),le(e,[{key:"isBeingTouched",value:function(t){if(!this.isTouchable)return!1;for(var e=this.drawingObject.getGLBoundaries(this.lastDrawTransform.matrix()),n=this.drawingObject.getGLBoundaryHoles(this.lastDrawTransform.matrix()),i=0;i<e.length;i+=1){var o=e[i];if(t.isInPolygon(o)){var r=!0;if(this.cannotTouchHole)for(var a=0;a<n.length;a+=1){var s=n[a];t.isInPolygon(s)&&(r=!1,a=n.length)}if(r)return!0}}return!1}},{key:"_dup",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=new e(this.drawingObject._dup());return _t(this,n),null!=t&&(n.transform=t._dup()),n}},{key:"setColor",value:function(t){this.color=t.slice(),this instanceof e&&(this.drawingObject instanceof Xt&&this.drawingObject.setColor(this.color),this.drawingObject instanceof Lt&&(this.drawingObject.element.style.color=function(t){return"rgba(".concat(Math.floor(255*t[0]),",").concat(Math.floor(255*t[1]),",").concat(Math.floor(255*t[2]),",").concat(t[3],")")}(this.color)))}},{key:"show",value:function(){ne(ie(e.prototype),"show",this).call(this),this.drawingObject instanceof Lt&&(this.drawingObject.show=!0,this.drawingObject.transformHtml(this.lastDrawTransform.matrix()))}},{key:"hide",value:function(){ne(ie(e.prototype),"hide",this).call(this),this.drawingObject instanceof Lt&&(this.drawingObject.show=!1,this.drawingObject.transformHtml(this.lastDrawTransform.matrix()))}},{key:"getTouched",value:function(t){return this.isTouchable&&this.isBeingTouched(t)?[this]:[]}},{key:"setFont",value:function(t){this.drawingObject instanceof Xt&&this.drawingObject.setFont(t)}},{key:"resizeHtmlObject",value:function(){this.drawingObject instanceof Lt&&this.drawingObject.transformHtml(this.lastDrawTransform.matrix())}},{key:"draw",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new rt,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(this.isShown){if(this.setNextTransform(n),this.setNextColor(n),!this.isShown)return;this.setNextCustomAnimation(n),this.lastDrawElementTransformPosition={parentCount:e.order.length,elementCount:this.transform.order.length};var i=e.transform(this.transform),o=this.transformWithPulse(n,i);this.lastDrawTransform=o[0];var r=-1;this.drawingObject instanceof Rt&&(r=this.drawingObject.numPoints,-1!==this.angleToDraw&&(r=this.drawingObject.getPointCountForAngle(this.angleToDraw)),-1!==this.lengthToDraw&&(r=this.drawingObject.getPointCountForLength(this.lengthToDraw)),-1!==this.pointsToDraw&&(r=this.pointsToDraw)),o.forEach(function(e){t.drawingObject.drawWithTransformMatrix(e.matrix(),t.color,r)})}}},{key:"setFirstTransform",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new rt;this.lastDrawElementTransformPosition={parentCount:t.order.length,elementCount:this.transform.order.length};var e=t.transform(this.transform);this.lastDrawTransform=e,this.drawingObject instanceof Lt&&this.drawingObject.transformHtml(e.matrix()),this.setMoveBoundaryToDiagram()}},{key:"isMoving",value:function(){return!!(this.state.isAnimating||this.state.isMovingFreely||this.state.isBeingMoved||this.state.isPulsing||this.state.isAnimatingColor||this.state.isAnimatingCustom)}},{key:"getGLBoundaries",value:function(){return this.drawingObject.getGLBoundaries(this.lastDrawTransform.matrix())}},{key:"getVertexSpaceBoundaries",value:function(){return this.drawingObject.border}},{key:"getGLBoundingRect",value:function(){return this.drawingObject.getGLBoundingRect(this.lastDrawTransform.matrix())}},{key:"getVertexSpaceBoundingRect",value:function(){return this.drawingObject.getVertexSpaceBoundingRect()}},{key:"getRelativeGLBoundingRect",value:function(){return this.drawingObject.getRelativeGLBoundingRect(this.lastDrawTransform.matrix())}},{key:"getRelativeVertexSpaceBoundingRect",value:function(){return this.drawingObject.getRelativeVertexSpaceBoundingRect()}}]),e}(),fe=function(t){function e(){var t,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new rt,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new H(-1,1,2,2);return ae(this,e),(t=ee(this,ie(e).call(this,n,i))).elements={},t.order=[],t.touchInBoundingRect=!1,t.eqns={},t}return oe(e,ue),le(e,[{key:"_dup",value:function(){var t=new e,n=this.order.map(function(t){return"_".concat(t)});_t(this,t,["elements","order"].concat(re(n)));for(var i=0;i<this.order.length;i+=1){var o=this.order[i];t.add(o,this.elements[o]._dup())}return t}},{key:"isMoving",value:function(){if(!1===this.isShown)return!1;if(this.state.isAnimating||this.state.isAnimatingCustom||this.state.isAnimatingColor||this.state.isMovingFreely||this.state.isBeingMoved||this.state.isPulsing)return!0;for(var t=0;t<this.order.length;t+=1){var n=this.elements[this.order[t]];if(n instanceof e){if(n.isMoving())return!0}else if(n.isShown&&0<n.color[3]&&n.isMoving())return!0}return!1}},{key:"add",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1;this.elements[t]=e,this.elements[t].name=t,this["_".concat(t)]=this.elements[t],-1!==n?this.order=re(this.order.slice(0,n)).concat([t],re(this.order.slice(n))):this.order.push(t)}},{key:"draw",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new rt,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(this.isShown){if(this.setNextTransform(e),this.setNextColor(e),!this.isShown)return;this.setNextCustomAnimation(e),this.lastDrawElementTransformPosition={parentCount:t.order.length,elementCount:this.transform.order.length};var n=t.transform(this.transform),i=this.transformWithPulse(e,n);this.lastDrawTransform=i[0];for(var o=0;o<i.length;o+=1)for(var r=0,a=this.order.length;r<a;r+=1)this.elements[this.order[r]].draw(i[o],e)}}},{key:"show",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];ne(ie(e.prototype),"show",this).call(this),t.forEach(function(t){t instanceof e?t.showAll():t.show()})}},{key:"hide",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];ne(ie(e.prototype),"hide",this).call(this),t.forEach(function(t){t instanceof e?t.hideAll():t.show()})}},{key:"showAll",value:function(){this.show();for(var t=0,e=this.order.length;t<e;t+=1){var n=this.elements[this.order[t]];n.show(),"function"==typeof n.hideAll&&n.showAll()}}},{key:"hideAll",value:function(){this.hide();for(var t=0,e=this.order.length;t<e;t+=1){var n=this.elements[this.order[t]];n.hide(),"function"==typeof n.hideAll&&n.hideAll()}}},{key:"showOnly",value:function(t){this.hideAll(),this.show();for(var e=0,n=t.length;e<n;e+=1){var i=t[e];if(!i)throw Error("Diagram Element Error: Element does not exist at position ".concat(e));i.show()}}},{key:"hideOnly",value:function(t){this.showAll();for(var e=0,n=t.length;e<n;e+=1)t[e].hide()}},{key:"isBeingTouched",value:function(t){if(!this.isTouchable)return!1;if(this.touchInBoundingRect){var e=this.getGLBoundingRect();if(t.x>=e.left&&t.x<=e.right&&t.y<=e.top&&t.y>=e.bottom)return!0}for(var n=0,i=this.order.length;n<i;n+=1){var o=this.elements[this.order[n]];if(!0===o.isShown&&o.isBeingTouched(t))return!0}return!1}},{key:"resizeHtmlObject",value:function(){for(var t=0;t<this.order.length;t+=1)this.elements[this.order[t]].resizeHtmlObject()}},{key:"setFirstTransform",value:function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:new rt).transform(this.transform);this.lastDrawTransform=t;for(var e=0;e<this.order.length;e+=1)this.elements[this.order[e]].setFirstTransform(t);this.setMoveBoundaryToDiagram()}},{key:"getGLBoundaries",value:function(){for(var t=[],e=0;e<this.order.length;e+=1){var n=this.elements[this.order[e]];if(n.isShown){var i=n.getGLBoundaries();t=t.concat(i)}}return t}},{key:"getVertexSpaceBoundaries",value:function(){for(var t=[],e=0;e<this.order.length;e+=1){var n=this.elements[this.order[e]];if(n.isShown){var i=n.getVertexSpaceBoundaries();t=t.concat(i)}}return t}},{key:"getGLBoundingRect",value:function(){return ut(this.getGLBoundaries())}},{key:"getVertexSpaceBoundingRect",value:function(){return ut(this.getVertexSpaceBoundaries())}},{key:"getRelativeGLBoundingRect",value:function(){var t=this.getGLBoundingRect(),e=new N(0,0).transformBy(this.lastDrawTransform.matrix());return new H(t.left-e.x,t.bottom-e.y,t.width,t.height)}},{key:"getRelativeVertexSpaceBoundingRect",value:function(){var t=this.getVertexSpaceBoundingRect(),e=new N(0,0);return new H(t.left-e.x,t.bottom-e.y,t.width,t.height)}},{key:"updateLimits",value:function(t){for(var e=0;e<this.order.length;e+=1)this.elements[this.order[e]].updateLimits(t);this.diagramLimits=t}},{key:"getTouched",value:function(t){if(!this.isTouchable&&!this.hasTouchableElements)return[];var e=[];(this.touchInBoundingRect||this.isTouchable)&&this.isBeingTouched(t)&&e.push(this);for(var n=this.order.length-1;0<=n;n-=1){var i=this.elements[this.order[n]];!0===i.isShown&&(e=e.concat(i.getTouched(t)))}return e}},{key:"stop",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];ne(ie(e.prototype),"stop",this).call(this,t,n);for(var i=0;i<this.order.length;i+=1)this.elements[this.order[i]].stop(t,n)}},{key:"setFont",value:function(t){for(var e=0;e<this.order.length;e+=1)this.elements[this.order[e]].setFont(t)}},{key:"setColor",value:function(t){for(var e=0;e<this.order.length;e+=1)this.elements[this.order[e]].setColor(t);this.color=t.slice()}},{key:"getElementTransforms",value:function(){for(var t={},e=0;e<this.order.length;e+=1){var n=this.elements[this.order[e]];t[n.name]=n.transform._dup()}return t}},{key:"setElementTransforms",value:function(t){for(var e=0;e<this.order.length;e+=1){var n=this.elements[this.order[e]];n.name in t&&(n.transform=t[n.name])}}},{key:"animateToTransforms",value:function(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:d,a=o,s=0,l=0;l<this.order.length;l+=1){var h=this.elements[this.order[l]];h.name in t&&(h.isShown?t[h.name].isEqualTo(h.transform)||(h.animateTo(t[h.name],e,n,i,a,r),a=null,s=e+n):h.transform=t[h.name]._dup())}return 0===s&&null!=a&&a(!0),s}},{key:"getAllPrimatives",value:function(){for(var t=[],n=0;n<this.order.length;n+=1){var i=this.elements[this.order[n]];i instanceof e?t=re(t).concat(re(i.getAllElements())):t.push(i)}return t}},{key:"getAllElements",value:function(){for(var t=[],e=0;e<this.order.length;e+=1){var n=this.elements[this.order[e]];t.push(n)}return t}},{key:"getAllCurrentlyInteractiveElements",value:function(){for(var t=[],n=0;n<this.order.length;n+=1){var i=this.elements[this.order[n]];i instanceof e&&(i.isTouchable||i.isMovable||!i.hasTouchableElements||i.isInteractive||(t=re(t).concat(re(i.getAllCurrentlyInteractiveElements())))),(i.isTouchable||i.isMovable||i.isInteractive)&&t.push(i)}return t}},{key:"goToStep",value:function(t){var e=document.getElementById("id__lesson_item_selector_0"),n=[];if(null!=e&&0<e.children.length)for(var i=0;i<e.children.length;i+=1)n.push(e.children[i]);n.forEach(function(e,n){n===t?e.classList.add("lesson__item_selector_selected"):e.classList.remove("lesson__item_selector_selected")})}},{key:"setMovable",value:function(){(!(0<arguments.length&&void 0!==arguments[0])||arguments[0])&&(this.hasTouchableElements=!0,this.isMovable=!0)}}]),e}();function de(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var ve=function(){function t(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),t.instance||(this.requestNextAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,(t.instance=this).drawQueue=[],this.nextDrawQueue=[]),t.instance}var e,n;return e=t,(n=[{key:"draw",value:function(t){this.drawQueue=this.nextDrawQueue,this.nextDrawQueue=[];for(var e=.001*t,n=0;n<this.drawQueue.length;n+=1)this.drawQueue[n](e);this.drawQueue=[]}},{key:"queueNextFrame",value:function(t){this.nextDrawQueue.push(t),1===this.nextDrawQueue.length&&this.animateNextFrame()}},{key:"animateNextFrame",value:function(){cancelAnimationFrame(this.animationId);var t=this.requestNextAnimationFrame.call(window,this.draw.bind(this));this.animationId=t}}])&&de(e.prototype,n),t}();function me(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var pe=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.diagram=e,this.addEvent("mousedown",this.mouseDownHandler,!1),this.addEvent("mouseup",this.mouseUpHandler,!1),this.addEvent("mousemove",this.mouseMoveHandler,!1),this.addEvent("touchstart",this.touchStartHandler,!1),this.addEvent("touchend",this.touchEndHandler,!1),this.addEvent("touchmove",this.touchMoveHandler,!1),this.enable=!0,this.start=this.diagram.touchDownHandler.bind(this.diagram),this.end=this.diagram.touchUpHandler.bind(this.diagram),this.move=this.diagram.touchMoveHandler.bind(this.diagram)}var e,n;return e=t,(n=[{key:"addEvent",value:function(t,e,n){this.diagram.htmlCanvas.addEventListener(t,e.bind(this),n)}},{key:"removeEvent",value:function(t,e,n){this.diagram.htmlCanvas.removeEventListener(t,e.bind(this),n)}},{key:"startHandler",value:function(t){return!!this.enable&&(this.mouseDown=!0,this.previousPoint=t,this.start(t))}},{key:"endHandler",value:function(){this.mouseDown=!1,this.end()}},{key:"moveHandler",value:function(t,e){this.enable&&this.mouseDown&&(this.move(this.previousPoint,e)&&t.preventDefault(),this.previousPoint=e),t.preventDefault()}},{key:"touchStartHandler",value:function(t){var e=t.touches[0];this.startHandler(new N(e.clientX,e.clientY))&&t.preventDefault()}},{key:"mouseDownHandler",value:function(t){this.startHandler(new N(t.clientX,t.clientY))}},{key:"touchMoveHandler",value:function(t){var e=t.touches[0];this.moveHandler(t,new N(e.clientX,e.clientY))}},{key:"mouseMoveHandler",value:function(t){this.moveHandler(t,new N(t.clientX,t.clientY))}},{key:"mouseUpHandler",value:function(){this.endHandler()}},{key:"touchEndHandler",value:function(){this.endHandler()}},{key:"destroy",value:function(){this.removeEvent("mousedown",this.mouseDownHandler,!1),this.removeEvent("mouseup",this.mouseUpHandler,!1),this.removeEvent("mousemove",this.mouseMoveHandler,!1),this.removeEvent("touchstart",this.touchStartHandler,!1),this.removeEvent("touchend",this.touchEndHandler,!1),this.removeEvent("touchmove",this.touchMoveHandler,!1)}}])&&me(e.prototype,n),t}();function ge(t){return(ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ye(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function we(t){return(we=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function be(t,e){return(be=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var xe=function(t){function e(t,n,i,o){var r,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"never";return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(r=function(t,e){return!e||"object"!==ge(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,we(e).call(this,t))).width=o,r.close=i,r.borderToPoint=a,r.setupPoints(n),r.setupBuffer(),r}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&be(t,e)}(e,Rt),n=e,(i=[{key:"change",value:function(t){this.setupPoints(t),this.resetBuffer()}},{key:"setupPoints",value:function(t){var e=function(t,e,n,i){var o=[],r=[],a=[];function s(e,o,s){var l=null==s?null:t[s],h=t[o],u=null==e?null:t[e],c=0,f=n/2,d=0,v=0;if(null!=u&&null!=l){var m=l.sub(h).toPolar(),p=u.sub(h).toPolar(),g=lt(1,m.angle),y=lt(1,p.angle);c=g.add(y).toPolar().angle||1e-5,v=U(g.toPolar().angle,y.toPolar().angle),f=Math.abs(n/2/Math.sin(c-m.angle)),d=Math.sin(m.angle-p.angle)}else if(null==u&&null!=l){var w=l.sub(h).toPolar();c=w.angle-Math.PI/2,f=Math.abs(n/2/Math.sin(c-w.angle)),d=1}else if(null==l&&null!=u){var b=u.sub(h).toPolar();c=b.angle-Math.PI/2+Math.PI,f=Math.abs(n/2/Math.sin(c-b.angle)),d=1}var x=Math.min(f,6*n),_=Math.min(f,2*n),k=x,T=_;if("alwaysOn"===i&&(k=x+_,T=0),"onSharpAnglesOnly"===i){k=x+_,T=0;var P=.9*Math.PI;if(Math.abs(v)>P){var S=Math.sin(Math.abs(v))/Math.sin(P);k=x+_*S,T=_*(1-S)}}var O=lt(k,c).add(h),M=lt(T,c+Math.PI).add(h);d<0&&(M=lt(k,c).add(h),O=lt(T,c+Math.PI).add(h)),r.push(O),a.push(M)}s(e?t.length-1:null,0,1);for(var l=1;l<t.length-1;l+=1)s(l-1,l,l+1);s(t.length-2,t.length-1,e?0:null);for(var h=function(t,e){o.push(r[t].x),o.push(r[t].y),o.push(a[t].x),o.push(a[t].y),o.push(a[e].x),o.push(a[e].y),o.push(r[t].x),o.push(r[t].y),o.push(a[e].x),o.push(a[e].y),o.push(r[e].x),o.push(r[e].y)},u=0;u<t.length-1;u+=1)h(u,u+1);e&&h(t.length-1,0);var c=[],f=[];if(e)f=r[0].isInPolygon(a)?(c=a,r):(c=r,a);else{c.push(r[0]);for(var d=0;d<a.length;d+=1)c.push(a[d]);for(var v=r.length-1;0<=v;v-=1)c.push(r[v])}return{points:o,border:c,holeBorder:f}}(t,this.close,this.width,this.borderToPoint);this.points=e.points,this.border[0]=e.border,this.holeBorder[0]=e.holeBorder}}])&&ye(n.prototype,i),e}();function _e(t,e,n,i){var o=new Z(t,e),r=new Z(n,i);return o.intersectsWith(r).intersect}var ke=function(t,e,n){var i,o,r,a,s=[],l=[],h=[],u=[],c=[],f=n/2;e&&t.push(t[0]);for(var d=1;d<t.length;d+=1){i=t[d-1],o=t[d];var v=Math.atan2(o.y-i.y,o.x-i.x),m=new N(f*Math.cos(v+Math.PI/2),f*Math.sin(v+Math.PI/2)),p=new N(f*Math.cos(v-Math.PI/2),f*Math.sin(v-Math.PI/2));u.push([i.add(m),o.add(m)]),c.push([i.add(p),o.add(p)])}o=e?(i=_e(u[0][0],u[0][1],u[u.length-1][0],u[u.length-1][1]),_e(c[0][0],c[0][1],c[u.length-1][0],c[c.length-1][1])):(i=u[0][0],c[0][0]),l.push(i._dup()),h.push(o._dup());for(var g=1;g<u.length;g+=1)s.push(i.x),s.push(i.y),s.push(o.x),s.push(o.y),i=_e(u[g-1][0],u[g-1][1],u[g][0],u[g][1]),o=_e(c[g-1][0],c[g-1][1],c[g][0],c[g][1]),l.push(i._dup()),h.push(o._dup()),s.push(o.x),s.push(o.y),s.push(s[s.length-6]),s.push(s[s.length-6]),s.push(o.x),s.push(o.y),s.push(i.x),s.push(i.y);a=e?(r=new N(s[0],s[1]),new N(s[2],s[3])):(r=u[u.length-1][1],c[c.length-1][1]),s.push(i.x),s.push(i.y),s.push(o.x),s.push(o.y),s.push(a.x),s.push(a.y),s.push(i.x),s.push(i.y),s.push(a.x),s.push(a.y),s.push(r.x),s.push(r.y),l.push(r._dup()),h.push(a._dup()),e&&t.pop();var y=[];if(e)y=l[0].isInPolygon(h)?h:l;else{y.push(l[0]);for(var w=0;w<h.length;w+=1)y.push(h[w]);for(var b=l.length-1;0<=b;b-=1)y.push(l[b])}return{points:s,border:y}};function Te(t){return(Te="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pe(t){return(Pe=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Se(t,e){return(Se=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Oe(t,e){for(var n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],i=t[1],o=[t[0],t[2]],r=[],a=0;a<2;a+=1){var s=o[a].sub(i),l=Math.atan2(s.y,s.x),h=Math.sqrt(s.x*s.x+s.y*s.y);(e<h||n)&&(h=e),r.push(new N(h*Math.cos(l)+i.x,h*Math.sin(l)+i.y))}return r.push(r[1]._dup()),r[1]=i._dup(),r}var Me=function(t){function e(t,n,i,o,r){var a;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),a=function(t,e){return!e||"object"!==Te(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Pe(e).call(this,t));var s=n.slice();i&&(s.push(n[0]),s.push(n[1]));for(var l=1,h=s.length-1;l<h;l+=1){for(var u=Oe([s[l-1],s[l],s[l+1]],o,!0),c=ke(u,!1,r),f=0,d=c.points.length;f<d;f+=1)a.points.push(c.points[f]);a.border[l-1]=[];for(var v=0,m=c.border.length;v<m;v+=1)a.border[l-1].push(c.border[v])}return a.setupBuffer(),a}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Se(t,e)}(e,Rt),e}();function Ee(t){return(Ee="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Le(t){return(Le=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ae(t,e){return(Ae=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ce=function(t){function e(t,n){var i;return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(i=function(t,e){return!e||"object"!==Ee(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Le(e).call(this,t))).glPrimative=t.gl.TRIANGLE_FAN,i.points=[],n.forEach(function(t){i.points.push(t.x),i.points.push(t.y),i.border[0].push(t)}),i.setupBuffer(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ae(t,e)}(e,Rt),e}();function je(t){return(je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Be(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Re(t){return(Re=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function De(t,e){return(De=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ie=function(t){function e(t,n,i,o){var r,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new N(0,0),l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:n,h=7<arguments.length&&void 0!==arguments[7]?arguments[7]:1;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(r=function(t,e){return!e||"object"!==je(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Re(e).call(this,t))).glPrimative=t.gl.TRIANGLE_STRIP;var u=n,c=Math.floor(l);u<3&&(u=3),c<0?c=0:u<c&&(c=u);var f,d=(r.radius=i)-o;r.center=s,r.dAngle=2*Math.PI/u;var v=0;for(f=0;f<=c;f+=1)r.points[v]=s.x+d*Math.cos(f*r.dAngle*h+a*h),r.points[v+1]=s.y+d*Math.sin(f*r.dAngle*h+a*h),r.points[v+2]=s.x+i*Math.cos(f*r.dAngle*h+a*h),r.points[v+3]=s.y+i*Math.sin(f*r.dAngle*h+a*h),v+=4;if(c<u){for(f=0;f<=c;f+=1)r.border[0].push(new N(s.x+i*Math.cos(f*r.dAngle*h+a*h),s.y+i*Math.sin(f*r.dAngle*h+a*h)));for(f=c;0<=f;f-=1)r.border[0].push(new N(s.x+d*Math.cos(f*r.dAngle*h+a*h),s.y+d*Math.sin(f*r.dAngle*h+a*h)));r.border[0].push(r.border[0][0]._dup())}else for(f=0;f<=c;f+=1)r.border[0].push(new N(s.x+i*Math.cos(f*r.dAngle*h+a*h),s.y+i*Math.sin(f*r.dAngle*h+a*h)));return r.setupBuffer(),r}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&De(t,e)}(e,Rt),n=e,(i=[{key:"drawToAngle",value:function(t,e,n,i,o){var r=2*Math.floor(i/this.dAngle)+2;i>=2*Math.PI&&(r=this.numPoints),this.draw(t,e,n,r,o)}},{key:"getPointCountForAngle",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2*Math.PI,e=2*Math.floor(t/this.dAngle)+2;return t>=2*Math.PI&&(e=this.numPoints),e}}])&&Be(n.prototype,i),e}();function Fe(t){return(Fe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function qe(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function He(t){return(He=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ne(t,e){return(Ne=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ge=function(t){function e(t,n,i){var o,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new N(0,0),s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:n,l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"",h=7<arguments.length&&void 0!==arguments[7]?arguments[7]:new H(0,0,1,1);!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(o=function(t,e){return!e||"object"!==Fe(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,He(e).call(this,t))).glPrimative=t.gl.TRIANGLE_FAN;var u,c=n,f=s;c<3&&(c=3),s<0?f=0:c<s&&(f=c),o.points=[a.x,a.y],o.dAngle=0,o.radius=i,o.center=a,o.dAngle=2*Math.PI/c;var d=2;for(f<c&&o.border[0].push(a._dup()),u=0;u<f+1;u+=1)o.points[d]=a.x+i*Math.cos(u*o.dAngle+r),o.points[d+1]=a.y+i*Math.sin(u*o.dAngle+r),o.border[0].push(new N(o.points[d],o.points[d+1])),d+=2;return f<c&&o.border[0].push(a._dup()),o.textureLocation=l,o.createTextureMap(1.01*-o.radius+a.x,1.01*o.radius+a.x,1.01*-o.radius+a.y,1.01*o.radius+a.y,h.left,h.right,h.bottom,h.top),o.setupBuffer(),o}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ne(t,e)}(e,Rt),n=e,(i=[{key:"drawToAngle",value:function(t,e,n,i,o){var r=2*Math.floor(i/this.dAngle)+2;i>=2*Math.PI&&(r=this.numPoints),this.draw(t,e,n,r,o)}},{key:"getPointCountForAngle",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2*Math.PI,e=Math.floor(t/this.dAngle)+1;return t>=2*Math.PI&&(e=this.numPoints),e}}])&&qe(n.prototype,i),e}();function ze(t){return(ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function We(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ve(t){return(Ve=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ue(t,e){return(Ue=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Xe=function(t){function e(t,n,i){var o,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new N(0,0),s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:n,l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:1,h=7<arguments.length&&void 0!==arguments[7]?arguments[7]:1;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(o=function(t,e){return!e||"object"!==ze(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Ve(e).call(this,t))).glPrimative=t.gl.LINES;var u=n,c=Math.floor(s);u<3&&(u=3),c<0?c=0:u<c&&(c=u),o.radius=i,o.center=a,o.dAngle=2*Math.PI/u;for(var f=[],d=[],v=1;v<h;v+=1)d.push([]);for(var m=0;m<=c;m+=1){var p=m*o.dAngle*l+r*l;f.push(lt(i,p));for(var g=1;g<h;g+=1)d[g-1].push(lt(i*(1-.003*g),p))}for(var y=1;y<=c;y+=1){o.points.push(f[y-1].x),o.points.push(f[y-1].y),o.points.push(f[y].x),o.points.push(f[y].y);for(var w=1;w<h;w+=1)o.points.push(d[w-1][y-1].x),o.points.push(d[w-1][y-1].y),o.points.push(d[w-1][y].x),o.points.push(d[w-1][y].y)}return o.border[0]=f,c<u&&o.border[0].push(a),o.setupBuffer(),o}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ue(t,e)}(e,Rt),n=e,(i=[{key:"drawToAngle",value:function(t,e,n,i,o){var r=2*Math.floor(i/this.dAngle)+2;i>=2*Math.PI&&(r=this.numPoints),this.draw(t,e,n,r,o)}},{key:"getPointCountForAngle",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2*Math.PI,e=2*Math.floor(t/this.dAngle)*2;return e>this.numPoints&&(e=this.numPoints),e}}])&&We(n.prototype,i),e}();function Ye(t){return(Ye="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qe(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ze(t){return(Ze=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ke(t,e){return(Ke=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var $e=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.05,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:Math.PI/4,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:2*Math.PI;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(n=function(t,e){return!e||"object"!==Ye(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Ze(e).call(this,t))).innerRadius=i,n.outerRadius=o,n.dAngle=a,n.maxAngle=s;for(var l=0,h=-1,u=-1,c=[i,-r/2,o,-r/2,o,r/2,i,-r/2,o,r/2,i,r/2];l<=s;){for(var f=0;f<6;f+=1){var d=new N(c[2*f],c[2*f+1]).rotate(l);n.points[h+=1]=d.x,n.points[h+=1]=d.y}var v=[new N(n.points[h-11],n.points[h-10]),new N(n.points[h-9],n.points[h-8]),new N(n.points[h-7],n.points[h-6]),new N(n.points[h-1],n.points[h-0]),new N(n.points[h-11],n.points[h-10])];n.border[u+=1]=v,l+=a}return n.setupBuffer(),n}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Ke(t,e)}(e,Rt),n=e,(i=[{key:"drawToAngle",value:function(t,e,n,i,o){var r=6*Math.floor(i/this.dAngle)+6;i>=this.maxAngle&&(r=this.numPoints),this.draw(t,e,n,r,o)}},{key:"getPointCountForAngle",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:2*Math.PI,e=6*Math.floor(t/this.dAngle)+6;return t>=2*Math.PI&&(e=this.numPoints),e}}])&&Qe(n.prototype,i),e}();function Je(t){return(Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tn(t){return(tn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function en(t,e){return(en=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var nn=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new N(0,0),o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this);var s=0-r/2,l=[];(n=function(t,e){return!e||"object"!==Je(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,tn(e).call(this,t))).glPrimative=n.gl.TRIANGLE_STRIP,l.push(new N(0,s)),l.push(new N(0,s+r)),l.push(new N(0+o,s)),l.push(new N(0+o,s+r));var h=(new rt).rotate(a).translate(i.x,i.y),u=l.map(function(t){return t.transformBy(h.matrix())});return u.forEach(function(t){n.points.push(t.x),n.points.push(t.y)}),n.border[0]=[u[0],u[1],u[u.length-1],u[u.length-2]],n.border[0].push(n.border[0][0]._dup()),n.setupBuffer(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&en(t,e)}(e,Rt),e}();function on(t){return(on="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function rn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function an(t){return(an=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function sn(t,e){return(sn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ln=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new N(0,0),o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:[1];!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(n=function(t,e){return!e||"object"!==on(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,an(e).call(this,t))).glPrimative=n.gl.TRIANGLES,n.dashCumLength=[],n.maxLength=o;for(var l,h,u,c,f,d,v=[],m=0,p=new N(0,0-r/2),g=!1;m<o;)for(var y=0;y<s.length&&m<o;y+=1){var w=s[y];o<w+m&&(w=o-m),g||(h=w,u=r,c=(l=p)._dup(),f=l.add(new N(0,u)),d=l.add(new N(h,u)),[c,f,d,c,d,l.add(new N(h,0))]).forEach(function(t){v.push(t)}),m+=w,p.x+=w,g=!g,n.dashCumLength.push(m)}var b=(new rt).rotate(a).translate(i.x,i.y),x=v.map(function(t){return t.transformBy(b.matrix())});return x.forEach(function(t){n.points.push(t.x),n.points.push(t.y)}),n.border[0]=[x[0],x[1],x[x.length-2],x[x.length-1]],n.border[0].push(n.border[0][0]._dup()),n.setupBuffer(),n}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&sn(t,e)}(e,Rt),n=e,(i=[{key:"getPointCountForLength",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.maxLength;if(t>=this.maxLength)return this.numPoints;if(t<this.dashCumLength[0])return 0;for(var e=0;e<this.dashCumLength.length;e+=1)if(t<this.dashCumLength[e])return 6*(Math.floor((e-1)/2)+1);return this.numPoints}}])&&rn(n.prototype,i),e}();function hn(t){return(hn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function un(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function cn(t){return(cn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function fn(t,e){return(fn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var dn=function(t){function e(t,n){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:20;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(i=function(t,e){return!e||"object"!==hn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,cn(e).call(this,t))).glPrimative=i.gl.TRIANGLE_FAN;var l=[];l.push(new N(0,0));var h=function(t,e,n,i){var o=[];if(0===t||e<=1)o.push(new N(0,0));else for(var r=Math.PI/2/e,a=0;a<e+1;a+=1)o.push(new N(t*Math.cos(a*r+n)+i.x,t*Math.sin(a*r+n)+i.y));return o},u=a,c=s;return l=un(l=un(l=un(l=un(l).concat(un(h(u,c,0,new N(o/2-u,r/2-u))))).concat(un(h(u,c,Math.PI/2,new N(-o/2+u,r/2-u))))).concat(un(h(u,c,Math.PI,new N(-o/2+u,-r/2+u))))).concat(un(h(u,c,Math.PI/2*3,new N(o/2-u,-r/2+u)))),"topLeft"===n&&(l=l.map(function(t){return t.add(new N(o/2,-r/2))})),l.forEach(function(t){i.points.push(t.x),i.points.push(t.y)}),i.points.push(i.points[2]),i.points.push(i.points[3]),i.border[0]=l.slice(1),i.setupBuffer(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&fn(t,e)}(e,Rt),e}();function vn(t){return(vn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mn(t){return(mn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function pn(t,e){return(pn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var gn=function(t){function e(t,n){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(i=function(t,e){return!e||"object"!==vn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,mn(e).call(this,t))).glPrimative=i.gl.LINES,i.points=[],n.forEach(function(t){for(var e=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(t,2),n=e[0],r=e[1],a=new Z(n,r).angle()+Math.PI/2,s=-.003*(o-1)/2,l=0;l<o;l+=1){var h=s+.003*l;i.points.push(n.x+h*Math.cos(a)),i.points.push(n.y+h*Math.sin(a)),i.points.push(r.x+h*Math.cos(a)),i.points.push(r.y+h*Math.sin(a))}}),i.border=[],i.setupBuffer(),i}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&pn(t,e)}(e,Rt),e}();function yn(t){return(yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wn(t){return(wn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function bn(t,e){return(bn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var xn=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.5,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new N(0,0),l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(n=function(t,e){return!e||"object"!==yn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,wn(e).call(this,t))).glPrimative=n.gl.TRIANGLE_FAN;var h=(n.height=r)-a,u=[];u.push(new N(0,0)),u.push(new N(-i/2,-h)),a&&(u.push(new N(-o/2,-h)),u.push(new N(-o/2,-r)),u.push(new N(+o/2,-r)),u.push(new N(+o/2,-h))),u.push(new N(+i/2,-h));var c=(new rt).rotate(l).translate(s);return u.map(function(t){return t.transformBy(c.matrix())}).forEach(function(t){n.points.push(t.x),n.points.push(t.y),n.border[0].push(t)}),n.border[0].push(n.border[0][0]._dup()),n.setupBuffer(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&bn(t,e)}(e,Rt),e}();function _n(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function kn(t){return(kn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Tn(t){return(Tn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Pn(t,e){return(Pn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Sn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var On=[.7,.7,.7,1],Mn=function t(){Sn(this,t),this.length=1,this.width=.01,this.color=On,this.mode="on",this.offset=0},En=function(t){function e(){var t;return Sn(this,e),(t=function(t,e){return!e||"object"!==kn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Tn(e).call(this))).start=0,t.step=.1,t.length=.05,t.width=.01,t.offset=0,t.labelOffset=new N(0,0),t.color=On,t.labels=[],t.labelMode="auto",t.labelsHAlign="center",t.labelsVAlign="middle",t.mode="on",t.fontFamily="Helvetica Neue",t.fontWeight="400",t.fontSize=.1,t.fontColor=On,t}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Pn(t,e)}(e,Mn),e}(),Ln=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;Sn(this,t),this.name=e,this.start=new N(0,0),this.length=1,this.width=.01,this.rotation=n,this.color=[.5,.5,.5,1],this.title="",this.titleOffset=new N(this.length/2,-.1),this.titleRotation=0,this.limits={min:0,max:1},this.logarithmic=!1,this.majorTicks=new En,this.minorTicks=new En,this.minorTicks.labelMode="off",this.majorGrid=new Mn,this.minorGrid=new Mn,this.titleFontFamily="Helvetica Neue",this.titleFontWeight="400",this.titleFontSize=.13,this.titleFontColor=On}var e,n;return e=t,(n=[{key:"getNum",value:function(t,e){return Math.floor((this.limits.max-t)/e)+1}},{key:"getMajorNum",value:function(){return this.getNum(this.majorTicks.start,this.majorTicks.step)}},{key:"getMinorNum",value:function(){return this.getNum(this.minorTicks.start,this.minorTicks.step)}},{key:"generateAuto",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10,e=(this.limits.max-this.limits.min)/t,n=s(Math.floor(Math.log10(e)),0);e=s(e,-n);var i=s(this.limits.min,-n);return i<this.limits.min&&(i+=Math.pow(10,n)),11<this.getNum(i,e)&&(e*=2),{start:i,step:e}}},{key:"generateAutoMajorTicks",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10,e=this.generateAuto(t),n=e.start,i=e.step;this.majorTicks.start=n,this.majorTicks.step=i}},{key:"generateAutoMinorTicks",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:50,e=this.generateAuto(t),n=e.start,i=e.step;this.minorTicks.start=n,this.minorTicks.step=i}},{key:"toClip",value:function(t){return t*(this.length/(this.limits.max-this.limits.min))}},{key:"valueToClip",value:function(t){return this.toClip(t-this.limits.min)+this.start.x}},{key:"getMajorLabels",value:function(){for(var t=[],e=0,n=this.getMajorNum();e<n;e+=1){var i=this.majorTicks.start+e*this.majorTicks.step;t.push(i.toString())}return t}},{key:"generateMajorLabels",value:function(){this.majorTicks.labels=this.getMajorLabels()}},{key:"getMinorLabels",value:function(){for(var t=[],e=0,n=this.getMinorNum();e<n;e+=1){var i=this.minorTicks.start+e*this.minorTicks.step;t.push(i.toString())}return t}},{key:"generateMinorLabels",value:function(){this.minorTicks.labels=this.getMinorLabels()}}])&&_n(e.prototype,n),t}(),An=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new N(0,0),e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=(new rt).rotate(i).translate(t.x,t.y),r=[new N(0,0-n/2),new N(0+e,0-n/2),new N(0+e,0+n/2),new N(0,0-n/2),new N(0+e,0+n/2),new N(0,0+n/2)],a=r.map(function(t){return t.transformBy(o.matrix())}),s=[];a.map(function(t){return s.push(t.x),s.push(t.y),!0});var l=[r[0],r[1],r[2],r[5]];return{points:s,border:l}};function Cn(t){return(Cn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jn(t){return(jn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Bn(t,e){return(Bn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Rn=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new Ln;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),n=function(t,e){return!e||"object"!==Cn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,jn(e).call(this,t));var o=i,r=(new rt).rotate(o.rotation).translate(o.start.x,o.start.y).matrix();if(0<o.width){var a=An(new N(0,0),o.length,o.width,0),s=a.points,l=a.border;n.points=s,n.border=[l]}return n.transform(r),n.setupBuffer(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Bn(t,e)}(e,Rt),e}(),Dn=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new N(0,0),i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.1,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.01,r=5<arguments.length&&void 0!==arguments[5]&&arguments[5],a=[],s=[],l=1;6<arguments.length&&void 0!==arguments[6]&&arguments[6]&&(l=-1);for(var h=n.y,u=0;u<t;u+=1){var c=void 0;c=r?n.x+e*Math.floor(u/10)+Math.log10(u%10)*e:n.x+e*u,c-=o/2,a.push(c,l*h),a.push(c+o,l*h),a.push(c+o,l*(h+i)),a.push(c,h),a.push(c+o,l*(h+i)),a.push(c,l*(h+i)),s.push([new N(c,l*h),new N(c+o,l*h),new N(c+o,l*(h+i)),new N(c,l*(h+i))])}return{points:a,border:s}};function In(t){return(In="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fn(t){return(Fn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function qn(t,e){return(qn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Hn=function(t){function e(t,n,i,o,r,a,s,l){var h;!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),h=function(t,e){return!e||"object"!==In(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Fn(e).call(this,t));var u=(new rt).rotate(i).translate(0,0).matrix(),c=Dn(o,r,new N(n.x,n.y+l),a,s,!1,!1),f=c.points,d=c.border;return h.points=f,h.border=d,h.transform(u),h.setupBuffer(),h}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&qn(t,e)}(e,Rt),e}();function Nn(t){return(Nn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Gn(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function zn(t){return(zn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Wn(t,e){return(Wn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Vn=function(t){function e(t,n){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new Ln,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new rt,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new H(-1,1,2,2);return function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(i=function(t,e){return!e||"object"!==Nn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,zn(e).call(this,r,a))).props=o,i.webgl=t,i.diagramLimits=a,i.drawContext2D=n,i.build(),i}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Wn(t,e)}(e,fe),n=e,(i=[{key:"rebuild",value:function(){this.order=[],this.build()}},{key:"build",value:function(){var t=this.props,e=t.minorTicks,n=t.majorTicks,i=t.minorGrid,o=t.majorGrid;"auto"===n.mode&&this.props.generateAutoMajorTicks(),"auto"===e.mode&&this.props.generateAutoMinorTicks();var r=2/this.diagramLimits.width,a=this.props.valueToClip(n.start),s=this.props.valueToClip(e.start),l=this.props.getMajorNum(),h=this.props.getMinorNum();this.addTicksOrGrid("minorGrid",this.webgl,i,h,e.step,s,r,this.diagramLimits),this.addTicksOrGrid("majorGrid",this.webgl,o,l,n.step,a,r,this.diagramLimits),this.addTicksOrGrid("minorTicks",this.webgl,e,h,e.step,s,r,this.diagramLimits),this.addTicksOrGrid("majorTicks",this.webgl,n,l,n.step,a,r,this.diagramLimits);var u=new Rn(this.webgl,this.props);this.add("line",new ce(u,new rt,this.props.color,this.diagramLimits));var c=new Vt(this.props.titleFontFamily,"normal",this.props.titleFontSize,this.props.titleFontWeight,"center","middle",this.props.titleFontColor),f=[new Ut(new N(0,0).transformBy((new rt).rotate(this.props.rotation).matrix()),this.props.title,c)],d=new Xt(this.drawContext2D,f);this.add("title",new ce(d,(new rt).rotate(this.props.rotation).translate(this.props.titleOffset.x,this.props.titleOffset.y),[.5,.5,.5,1],this.diagramLimits)),this.addTickLabels("major",this.drawContext2D,n,this.props.generateMajorLabels.bind(this.props),this.diagramLimits,this.props.majorTicks.labelOffset),this.addTickLabels("minor",this.drawContext2D,e,this.props.generateMinorLabels.bind(this.props),this.diagramLimits,this.props.minorTicks.labelOffset)}},{key:"toClip",value:function(t){return this.props.toClip(t)}},{key:"valueToClip",value:function(t){return this.props.valueToClip(t)}},{key:"addTicksOrGrid",value:function(t,e,n,i,o,r,a,s){if("off"!==n.mode){var l=new Hn(e,new N(r,this.props.start.y),this.props.rotation,i,this.toClip(o),n.length,n.width,n.offset);this.add(t,new ce(l,(new rt).scale(1,1).rotate(0).translate(0,0),n.color,s))}}},{key:"addTickLabels",value:function(t,e,n,i,o,r){"auto"===n.labelMode&&i();var a=new Vt(n.fontFamily,"normal",n.fontSize,n.fontWeight,n.labelsHAlign,n.labelsVAlign,n.fontColor);this.props.rotation>Math.PI/2*.95&&(a.alignV="middle",a.alignH="right");for(var s=[],l=0;l<n.labels.length;l+=1)s.push(new Ut(new N(this.valueToClip(n.start+l*n.step),0).transformBy((new rt).rotate(this.props.rotation).matrix()),n.labels[l],a));var h=new Xt(e,s);this.add("label_".concat(t),new ce(h,(new rt).scale(1,1).rotate(0).translate(r.x,r.y),[.5,.5,.5,1],o))}}])&&Gn(n.prototype,i),e}();function Un(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Xn=function(){function t(e,n,i,o){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.webgl=e,this.draw2D=n,this.htmlCanvas=i,this.limits=o}var e,n;return e=t,(n=[{key:"polyLine",value:function(t,e,n,i){var o,r,a,s,l,h,u,c,f,d,v=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"never",m=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new rt;return o=this.webgl,r=t,a=e,s=n,l=i,h=v,u=m,c=this.limits,f=new xe(o,r,a,s,h),d=new rt,d=u instanceof N?d.translate(u.x,u.y):u._dup(),new ce(f,d,l,c)}},{key:"fan",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=Object.assign.apply(Object,[{},{points:[],color:[1,0,0,1],transform:null,position:null}].concat(e)),o=i.transform;return null==o&&null!=i.position?o=new rt("fan").translate(i.position):null==o&&(o=new rt("fan")),function(t,e,n,i,o){var r=new Ce(t,e),a=new rt;return a=i instanceof N?a.translate(i.x,i.y):i._dup(),new ce(r,a,n,o)}(this.webgl,i.points,i.color,o,this.limits)}},{key:"text",value:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=new Vt("Times New Roman","italic",.2,"200","center","middle",n);null!==i&&(o=i);var r=new Ut(new N(0,0),t,o),a=new Xt(this.draw2D,[r]);return new ce(a,(new rt).scale(1,1).translate(e.x,e.y),n,this.limits)}},{key:"htmlElement",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"id__temp_".concat(Math.round(1e4*Math.random())),n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new N(0,0),o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"middle",r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"left",a=document.createElement("div");n&&a&&n.split(" ").forEach(function(t){return a.classList.add(t.trim())}),Array.isArray(t)?t.forEach(function(t){return a.appendChild(t)}):a.appendChild(t),a.style.position="absolute",a.setAttribute("id",e),this.htmlCanvas.appendChild(a);var s=new Lt(this.htmlCanvas,e,new N(0,0),o,r);return new ce(s,(new rt).scale(1,1).translate(i.x,i.y),[1,1,1,1],this.limits)}},{key:"htmlText",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:kt("id__html_text_"),n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new N(0,0),o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"middle",r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"left",a=document.createElement("div");return a.innerHTML=t,this.htmlElement(a,e,n,i,o,r)}},{key:"arrow",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.5,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.5,o=4<arguments.length?arguments[4]:void 0,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new rt,a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:new N(0,0),s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:0;return function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.5,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new N(0,0),a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:0,s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:[1,1,1,1],l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:new N(0,0),h=9<arguments.length&&void 0!==arguments[9]?arguments[9]:new H(-1,-1,2,2),u=new xn(t,e,n,i,o,r,a),c=new rt;return c=l instanceof N?c.translate(l.x,l.y):l._dup(),new ce(u,c,s,h)}(this.webgl,t,e,n,i,a,s,o,r,this.limits)}},{key:"lines",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length?arguments[2]:void 0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new rt;return function(t,e,n,i,o,r){var a=new gn(t,e,n),s=new rt;return s=o instanceof N?s.translate(o.x,o.y):o._dup(),new ce(a,s,i,r)}(this.webgl,t,e,n,i,this.limits)}},{key:"grid",value:function(t,e,n,i,o){var r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new rt,a=[];if(0!==e)for(var l=t.left;s(l,8)<=t.right;l+=e)a.push([new N(l,t.top),new N(l,t.bottom)]);if(0!==n)for(var h=t.bottom;s(h,8)<=t.top;h+=n)a.push([new N(t.left,h),new N(t.right,h)]);return this.lines(a,i,o,r)}},{key:"polyLineCorners",value:function(t,e,n,i,o){var r,a,s,l,h,u,c,f,d,v,m=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new rt;return r=this.webgl,a=t,s=e,l=n,h=i,u=o,c=m,f=this.limits,d=new Me(r,a,s,l,h),v=new rt,v=c instanceof N?v.translate(c.x,c.y):c._dup(),new ce(d,v,u,f)}},{key:"polygon",value:function(){for(var t={sides:4,radius:1,width:.01,rotation:0,clockwise:!1,sidesToDraw:null,color:[1,0,0,1],fill:!1,transform:null,point:null,textureLocation:"",textureCoords:new H(0,0,1,1)},e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var o=Object.assign.apply(Object,[{},t].concat(n)),r=o.transform;null==r&&null!=o.point?r=new rt("polygon").translate(o.point):null==r&&(r=new rt("polygon")),null==o.sidesToDraw&&(o.sidesToDraw=o.sides);var a,s,l,h,u,c,f,d,v,m,p,g,y=1;return o.clockwise&&(y=-1),o.fill?function(t,e,n,i,o,r,a,s){var l=8<arguments.length&&void 0!==arguments[8]?arguments[8]:"",h=9<arguments.length&&void 0!==arguments[9]?arguments[9]:new H(0,0,1,1),u=new Ge(t,e,n,i,new N(0,0),o,l,h),c=new rt;return c=a instanceof N?c.translate(a.x,a.y):a._dup(),new ce(u,c,r,s)}(this.webgl,o.sides,o.radius,o.rotation,o.sidesToDraw,o.color,r,this.limits,o.textureLocation,o.textureCoords):(a=this.webgl,s=o.sides,l=o.radius,h=o.width,u=o.rotation,c=y,f=o.sidesToDraw,d=o.color,v=r,m=this.limits,p=new Ie(a,s,l,h,u,new N(0,0),f,c),g=new rt,g=v instanceof N?g.translate(v.x,v.y):v._dup(),new ce(p,g,d,m))}},{key:"polygonLine",value:function(t,e,n,i,o,r,a){var s,l,h,u,c,f,d,v,m,p,g,y,w=7<arguments.length&&void 0!==arguments[7]?arguments[7]:new rt;return s=this.webgl,l=t,h=e,u=n,c=i,f=o,d=r,v=a,m=w,p=this.limits,g=new Xe(s,l,h,u,new N(0,0),f,c,d),y=new rt,y=m instanceof N?y.translate(m.x,m.y):m._dup(),new ce(g,y,v,p)}},{key:"horizontalLine",value:function(t,e,n,i,o){var r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new rt;return function(t,e,n,i,o,r,a,s){var l=new nn(t,e,n,i,o),h=new rt;return h=a instanceof N?h.translate(a.x,a.y):a._dup(),new ce(l,h,r,s)}(this.webgl,t,e,n,i,o,r,this.limits)}},{key:"dashedLine",value:function(t,e,n,i,o,r){var a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:new rt;return function(t,e,n,i,o,r,a,s,l){var h=new ln(t,e,n,i,o,r),u=new rt;return u=s instanceof N?u.translate(s.x,s.y):s._dup(),new ce(h,u,a,l)}(this.webgl,t,e,n,i,o,r,a,this.limits)}},{key:"rectangleFilled",value:function(t,e,n,i,o,r){var a,s,l,h,u,c,f,d,v,m,p,g=6<arguments.length&&void 0!==arguments[6]?arguments[6]:new rt;return a=this.webgl,s=t,l=e,h=n,u=i,c=o,f=r,d=g,v=this.limits,m=new dn(a,s,l,h,u,c),p=new rt,p=d instanceof N?p.translate(d.x,d.y):d._dup(),new ce(m,p,f,v)}},{key:"radialLines",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.05,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:Math.PI/4,o=4<arguments.length?arguments[4]:void 0,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new rt;return function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.05,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:Math.PI/4,r=5<arguments.length?arguments[5]:void 0,a=6<arguments.length?arguments[6]:void 0,s=7<arguments.length?arguments[7]:void 0,l=new $e(t,e,n,i,o,2*Math.PI),h=new rt;return h=a instanceof N?h.translate(a.x,a.y):a._dup(),new ce(l,h,r,s)}(this.webgl,t,e,n,i,o,r,this.limits)}},{key:"collection",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new rt,e=new rt;return e=t instanceof N?e.translate(t.x,t.y):t._dup(),new fe(e,this.limits)}},{key:"repeatPattern",value:function(t,e,n,i,o){var r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new rt,a=this.collection(r),s=t.transform.t(),l=t.transform._dup();if(null===s&&(s=new N(0,0),l=l.translate(0,0)),s)for(var h=0;h<e;h+=1)for(var u=0;u<n;u+=1){var c=t._dup();c.transform=l._dup(),c.transform.updateTranslation(s.x+i*h,s.y+o*u),a.add("xy".concat(h).concat(u),c)}return a}},{key:"repeatPatternVertex",value:function(t,e,n,i,o){var r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:new rt,a=t._dup(),s=t.drawingObject;if(s instanceof Rt){a.transform=r._dup();for(var l=[],h=s.points,u=0;u<e;u+=1)for(var c=0;c<n;c+=1)for(var f=0;f<h.length;f+=2)l.push(new N(h[f]+u*i,h[f+1]+c*o));a.drawingObject.changeVertices(l)}return a}},{key:"axes",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new H(-1,-1,2,2),i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:.1,a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:.1,l=7<arguments.length&&void 0!==arguments[7]?arguments[7]:.13,h=!(8<arguments.length&&void 0!==arguments[8])||arguments[8],u=9<arguments.length&&void 0!==arguments[9]?arguments[9]:[1,1,1,0],c=10<arguments.length&&void 0!==arguments[10]?arguments[10]:[1,1,1,0],f=11<arguments.length&&void 0!==arguments[11]?arguments[11]:new rt,d=12<arguments.length&&void 0!==arguments[12]?arguments[12]:1,v=new Ln("x",0);v.minorTicks.mode="off",v.minorGrid.mode="off",v.majorGrid.mode="off",v.length=t,v.width=.01,v.limits={min:n.left,max:n.right},v.color=u.slice(),v.title="",v.majorTicks.start=n.left,v.majorTicks.step=r,v.majorTicks.length=.05,v.majorTicks.offset=-v.majorTicks.length/2,v.majorTicks.width=.02,v.majorTicks.labelMode="off",v.majorTicks.labels=g(v.limits.min,v.limits.max,r).map(function(t){return t.toFixed(d)}).map(function(t){return t===i.toString()&&i===o?"".concat(t,"     "):t}),v.majorTicks.labelOffset=new N(0,v.majorTicks.offset-.1*l),v.majorTicks.labelsHAlign="center",v.majorTicks.labelsVAlign="top",v.majorTicks.fontColor=u.slice(),v.majorTicks.fontSize=l,v.majorTicks.fontWeight="400";var m=new Vn(this.webgl,this.draw2D,v,(new rt).scale(1,1).rotate(0).translate(0,o-n.bottom*e/2),this.limits),p=new Ln("x",0);p.minorTicks.mode="off",p.minorGrid.mode="off",p.majorGrid.mode="off",p.length=e,p.width=v.width,p.limits={min:n.bottom,max:n.top},p.color=v.color,p.title="",p.rotation=Math.PI/2,p.majorTicks.step=a,p.majorTicks.start=n.bottom,p.majorTicks.length=v.majorTicks.length,p.majorTicks.offset=-p.majorTicks.length/2,p.majorTicks.width=v.majorTicks.width,p.majorTicks.labelMode="off",p.majorTicks.labels=g(p.limits.min,p.limits.max,a).map(function(t){return t.toFixed(d)}).map(function(t){return t===o.toString()&&i===o?"":t}),p.majorTicks.labelOffset=new N(p.majorTicks.offset-.2*l,0),p.majorTicks.labelsHAlign="right",p.majorTicks.labelsVAlign="middle",p.majorTicks.fontColor=v.majorTicks.fontColor,p.majorTicks.fontSize=l,p.majorTicks.fontWeight=v.majorTicks.fontWeight;var y=new Vn(this.webgl,this.draw2D,p,(new rt).scale(1,1).rotate(0).translate(i-n.left*t/2,0),this.limits),w=new rt;w=f instanceof N?w.translate(f.x,f.y):f._dup();var b=this.collection(w);if(h){var x=this.grid(new H(0,0,t,e),s(r*t/n.width,8),s(a*e/n.height,8),1,c,(new rt).scale(1,1).rotate(0).translate(0,0));b.add("grid",x)}return b.add("y",y),b.add("x",m),b}}])&&Un(e.prototype,n),t}();function Yn(t){return(Yn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qn(t){return(Qn=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Zn(t,e){return(Zn=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Kn=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,o=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(n=function(t,e){return!e||"object"!==Yn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Qn(e).call(this,t))).glPrimative=n.gl.TRIANGLE_STRIP;var r=.3;i<5&&(r=1-Math.log(i)/2);var a=.003*r,s=.01*r,l=function(t,e,n){for(var i=[],o=-.18;o<=.185;o+=.01)i.push(o);return i}(),h=l.map(function(t){return 1/(1+Math.exp(-20*t))}),u=l.map(function(t){return a/Math.sqrt(2*Math.PI*Math.pow(.07,2))*Math.exp(-Math.pow(t,2)/(2*Math.pow(.07,2)))}),c=l.map(function(t,e){return t-u[e]-s}),f=l.map(function(t,e){return t+u[e]+s}),d=.03*r,v=c.length,m=new N(c[v-1],h[v-1]),p=20*h[v-1]*(1-h[v-1]),g=Math.atan(p),y=Math.PI/2-g,w=m.add(new N(d*Math.cos(y),-d*Math.sin(y))),b=2*Math.PI/29,x=Math.PI/2+g,_=new N(-w.x,1-w.y),k=-y;if(o){n.border.push([]),n.border.push([]);for(var T=0;T<30;T+=1){n.points.push(_.x),n.points.push(_.y);var P=k+b*T,S=new N(_.x+d*Math.cos(P),_.y+d*Math.sin(P));n.points.push(S.x),n.points.push(S.y),n.border[1].push(S)}}var O=[],M=[];if(h.map(function(t,e){var i=new N(c[e],t),o=new N(f[e],t);n.points.push(o.x),n.points.push(o.y),n.points.push(i.x),n.points.push(i.y),O.push(i._dup()),M.push(o._dup())}),o)for(var E=0;E<30;E+=1){n.points.push(w.x),n.points.push(w.y);var L=x+b*E,A=new N(w.x+d*Math.cos(L),w.y+d*Math.sin(L));n.points.push(A.x),n.points.push(A.y),n.border[2].push(A)}n.border[0]=O.concat(M.reverse()),n.border[0].push(n.border[0][0]._dup());for(var C=n.getGLBoundingRect((new rt).matrix()),j=(new rt).translate(-C.left,-C.bottom).scale(1/C.height,1/C.height),B=0;B<n.border.length;B+=1)for(var R=n.border[B],D=0;D<R.length;D+=1)n.border[B][D]=n.border[B][D].transformBy(j.matrix());for(var I=0;I<n.points.length;I+=2){var F=new N(n.points[I],n.points[I+1]).transformBy(j.matrix());n.points[I]=F.x,n.points[I+1]=F.y}return n.setupBuffer(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Zn(t,e)}(e,Rt),e}();function $n(t,e,n,i,o){var r=new Kn(t,n,!0),a=new rt;return a=i instanceof N?a.translate(i.x,i.y):i._dup(),new ce(r,a,e,o)}function Jn(t){return(Jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ti(t){return(ti=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ei(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function ni(t,e){return(ni=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var ii=function(t){var e,n;function i(t,e){var n,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;!function(t,e){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this),(n=function(t,e){return!e||"object"!==Jn(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,ti(i).call(this,t))).glPrimative=n.gl.TRIANGLE_STRIP,n.numLines=o,n.mainHeight=1;var r,a,s=n.getPoints(),l=s.leftPoints,h=s.rightPoints,u=s.maxX,c=[];a="right"===e?(new rt).scale(-1,1).translate(u,0):"top"===e?(new rt).translate(0,-n.mainHeight/2).rotate(-Math.PI/2).translate(n.mainHeight/2,u):"bottom"===e?(new rt).translate(0,-n.mainHeight/2).rotate(Math.PI/2).translate(n.mainHeight/2,-u):new rt,c=l.map(function(t){return t.transformBy(a.m())}),r=h.map(function(t){return t.transformBy(a.m())}),n.points=[],c.forEach(function(t,e){var i=r[e];n.points.push(t.x),n.points.push(t.y),n.points.push(i.x),n.points.push(i.y)}),n.border[0]=[],c.forEach(function(t){n.border[0].push(t)});for(var f=r.length-1;0<=f;f-=1)n.border[0].push(r[f]);return n.setupBuffer(),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&ni(t,e)}(i,Rt),e=i,(n=[{key:"getPoints",value:function(){for(var t=1/this.numLines/16,e=16*t*this.numLines,n=e*(1.4-.4*(1-1/this.numLines)),i=this.mainHeight,o=new N(e,i/2),r=new N(n+t,i/2),a=Math.asin(i/2/e),s=Math.asin(i/2/n),l=10*this.numLines,h=2*a/l,u=2*s/l,c=[],f=[],d=0;d<=l;d+=1)c.push(lt(e,Math.PI-a+d*h).add(o)),f.push(lt(n,Math.PI-s+d*u).add(r));return{leftPoints:c,rightPoints:f,maxX:lt(n,Math.PI-s).add(r).x}}}])&&ei(e.prototype,n),i}();function oi(t,e,n,i,o,r){var a=new ii(t,n,i),s=new rt;return s=o instanceof N?s.translate(o.x,o.y):o._dup(),new ce(a,s,e,r)}function ri(t){return(ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ai(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function si(t){return(si=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function li(t,e){return(li=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var hi=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){return!e||"object"!==ri(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,si(e).apply(this,arguments))}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&li(t,e)}(e,ii),n=e,(i=[{key:"getPoints",value:function(){var t=1/30;return 1<this.numLines&&(t/=this.numLines),{leftPoints:[new N(0,0),new N(0,this.mainHeight)],rightPoints:[new N(t,0),new N(t,this.mainHeight)],maxX:t}}}])&&ai(n.prototype,i),e}();function ui(t,e,n,i,o,r){var a=new hi(t,n,i),s=new rt;return s=o instanceof N?s.translate(o.x,o.y):o._dup(),new ce(a,s,e,r)}function ci(t){return(ci="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function fi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function di(t){return(di=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function vi(t,e){return(vi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var mi=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){return!e||"object"!==ci(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,di(e).apply(this,arguments))}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&vi(t,e)}(e,ii),n=e,(i=[{key:"getPoints",value:function(){var t=1/30;1<this.numLines&&(t/=this.numLines);var e=4*t;return{leftPoints:[new N(e,0),new N(0,0),new N(0,this.mainHeight),new N(e,this.mainHeight)],rightPoints:[new N(e,t),new N(t,t),new N(t,this.mainHeight-t),new N(e,this.mainHeight-t)],maxX:e}}}])&&fi(n.prototype,i),e}();function pi(t,e,n,i,o,r){var a=new mi(t,n,i),s=new rt;return s=o instanceof N?s.translate(o.x,o.y):o._dup(),new ce(a,s,e,r)}function gi(t){return(gi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function yi(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function wi(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function bi(t){return(bi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function xi(t,e){return(xi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var _i=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){return!e||"object"!==gi(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,bi(e).apply(this,arguments))}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&xi(t,e)}(e,ii),n=e,(i=[{key:"getPoints",value:function(){var t=.05;1<this.numLines&&(t/=this.numLines);for(var e=3*t,n=1.3*e,i=new N(e,0),o=new N(t+n+t/4,0),r=Math.PI/2*.8,a=e*Math.sin(r),s=Math.asin(a/n),l=r/5,h=s/5,u=[],c=[],f=0;f<=5;f+=1)u.push(lt(e,Math.PI-f*l).add(i)),c.push(lt(n,Math.PI-f*h).add(o));var d=lt(n,Math.PI-s).add(o).x,v=a,m=(new rt).translate(d-t,this.mainHeight-v),p=(new rt).scale(1,-1).translate(d-t,v),g=(new rt).scale(-1,1).translate(d,this.mainHeight/2-1*v),y=(new rt).scale(-1,-1).translate(d,this.mainHeight/2+1*v);return{leftPoints:yi(u.map(function(t){return t.transformBy(p.m())}).reverse()).concat(yi(c.map(function(t){return t.transformBy(g.m())})),yi(c.map(function(t){return t.transformBy(y.m())}).reverse()),yi(u.map(function(t){return t.transformBy(m.m())}))),rightPoints:yi(c.map(function(t){return t.transformBy(p.m())}).reverse()).concat(yi(u.map(function(t){return t.transformBy(g.m())})),yi(u.map(function(t){return t.transformBy(y.m())}).reverse()),yi(c.map(function(t){return t.transformBy(m.m())}))),maxX:2*d-t}}}])&&wi(n.prototype,i),e}();function ki(t,e,n,i,o,r){var a=new _i(t,n,i),s=new rt;return s=o instanceof N?s.translate(o.x,o.y):o._dup(),new ce(a,s,e,r)}function Ti(t){return(Ti="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pi(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Si(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Oi(t){return(Oi=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Mi(t,e){return(Mi=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var Ei=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),function(t,e){return!e||"object"!==Ti(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}(this,Oi(e).apply(this,arguments))}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Mi(t,e)}(e,ii),n=e,(i=[{key:"getPoints",value:function(){var t=.05;1<this.numLines&&(t/=this.numLines);for(var e=3*t,n=1.3*e,i=new N(e,0),o=new N(t+n+t/4,0),r=Math.PI/2*.8,a=e*Math.sin(r),s=Math.asin(a/n),l=r/5,h=s/5,u=[],c=[],f=0;f<=5;f+=1)u.push(lt(e,Math.PI-f*l).add(i)),c.push(lt(n,Math.PI-f*h).add(o));var d=lt(n,Math.PI-s).add(o).x,v=a,m=(new rt).translate(0,this.mainHeight-v),p=(new rt).scale(1,-1).translate(0,v);return{leftPoints:Pi(u.map(function(t){return t.transformBy(p.m())}).reverse()).concat(Pi(u.map(function(t){return t.transformBy(m.m())}))),rightPoints:Pi(c.map(function(t){return t.transformBy(p.m())}).reverse()).concat(Pi(c.map(function(t){return t.transformBy(m.m())}))),maxX:d}}}])&&Si(n.prototype,i),e}();function Li(t,e,n,i,o,r){var a=new Ei(t,n,i),s=new rt;return s=o instanceof N?s.translate(o.x,o.y):o._dup(),new ce(a,s,e,r)}function Ai(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"highlight_word",i=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o=t;Object.keys(e).forEach(function(t){var n,i,r,a,s,l=e[t];n=o,i=t,r=l,a=new RegExp("\\|".concat(i,"\\|"),"gi"),s="string"==typeof r.replacementText?r.replacementText:r.replacementText(i).replacementText,o=n.replace(a,s)});var r=RegExp(/\|([^|]*)\|/,"gi");if(o=o.replace(r,'<span class="'.concat(n,'">$1</span>')),i){var a=RegExp(/style="color:rgba\([^)]*\);"/,"gi");o=o.replace(a,"");var s=RegExp(/highlight_word/,"gi");o=o.replace(s,"");var l=RegExp(/interactive_word/,"gi");o=o.replace(l,"");var h=RegExp(/id="[^"]*"/,"gi");o=o.replace(h,"")}return o}function Ci(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";Object.keys(t).forEach(function(n){var i=t[n];"actionMethod"in i&&function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",o=document.getElementById(t);o&&(o.classList.add("action_word_enabled"),i.split(" ").forEach(function(t){t&&o.classList.add(t)}),1===n.length&&(o.onclick=e.bind(n[0])),2===n.length&&(o.onclick=e.bind(n[0],n[1])),3===n.length&&(o.onclick=e.bind(n[0],n[1],n[2])),4===n.length&&(o.onclick=e.bind(n[0],n[1],n[2],n[3])),5===n.length&&(o.onclick=e.bind(n[0],n[1],n[2],n[3],n[4])),6===n.length&&(o.onclick=e.bind(n[0],n[1],n[2],n[3],n[4],n[5])),7===n.length&&(o.onclick=e.bind(n[0],n[1],n[2],n[3],n[4],n[5],n[6])),8===n.length&&(o.onclick=e.bind(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7])),9===n.length&&(o.onclick=e.bind(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8])))}(i.id(n),i.actionMethod,i.bind,e)})}function ji(t,e,n){return(ji="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ii(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function Bi(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=[],i=!0,o=!1,r=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!e||n.length!==e);i=!0);}catch(t){o=!0,r=t}finally{try{i||null==s.return||s.return()}finally{if(o)throw r}}return n}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function Ri(t){return(Ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Di(t,e){return!e||"object"!==Ri(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Ii(t){return(Ii=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Fi(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}function qi(t){return function(t){if(Array.isArray(t)){for(var e=0,n=new Array(t.length);e<t.length;e++)n[e]=t[e];return n}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function Hi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ni(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Gi(t,e,n){return e&&Ni(t.prototype,e),n&&Ni(t,n),t}var zi=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:.03,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;Hi(this,t),this.width=e,this.ascent=n,this.descent=i,this.height=this.ascent+this.descent}return Gi(t,[{key:"_dup",value:function(){return new t(this.width,this.ascent,this.descent)}}]),t}(),Wi=function(){function t(e){Hi(this,t),this.content=e,this.ascent=0,this.descent=0,this.width=0,this.location=new N(0,0),this.height=0}return Gi(t,[{key:"calcSize",value:function(t,e){var n=this.content;if(n instanceof zi&&(this.width=n.width*e,this.height=n.height*e,this.ascent=n.ascent*e,this.descent=n.descent*e,this.location=t._dup(),this.scale=e),n instanceof fe||n instanceof ce){n.transform.updateTranslation(t.x,t.y),n.transform.updateScale(e,e),n.updateLastDrawTransform();var i=n.getRelativeVertexSpaceBoundingRect();this.location=t._dup(),this.scale=e,this.ascent=i.top*e,this.descent=-i.bottom*e,this.height=i.height*e,this.width=i.width*e}}},{key:"_dup",value:function(e){var n;return(n=this.content instanceof zi?new t(this.content):new t(e?e[this.content.name]:this.content)).ascent=this.ascent,n.descent=this.descent,n.width=this.width,n.location=this.location._dup(),n.height=this.height,n.scale=this.scale,n}},{key:"getAllElements",value:function(){return this.content instanceof zi?[]:[this.content]}},{key:"setPositions",value:function(){var t=this.content;(t instanceof fe||t instanceof ce)&&(t.transform.updateTranslation(this.location.x,this.location.y),t.transform.updateScale(this.scale,this.scale),t.updateLastDrawTransform())}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new N(0,0);this.location=this.location.add(t)}}]),t}(),Vi=function(){function t(e){Hi(this,t);var n=[];e.forEach(function(t){null!==t&&n.push(t)}),this.content=n,this.ascent=0,this.descent=0,this.width=0,this.location=new N(0,0),this.height=0}return Gi(t,[{key:"_dup",value:function(e){var n=[];this.content.forEach(function(t){return n.push(t._dup(e))});var i=new t(n);return _t(this,i,["content"]),i}},{key:"calcSize",value:function(t,e){var n=0,i=0,o=t._dup();this.content.forEach(function(t){t.calcSize(o,e),o.x+=t.width,t.descent>n&&(n=t.descent),t.ascent>i&&(i=t.ascent)}),this.width=o.x-t.x,this.ascent=i,this.descent=n,this.location=t._dup(),this.height=this.descent+this.ascent}},{key:"getAllElements",value:function(){var t=[];return this.content.forEach(function(e){t=qi(t).concat(qi(e.getAllElements()))}),t}},{key:"setPositions",value:function(){this.content.forEach(function(t){t.setPositions()})}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new N(0,0);this.location=this.location.add(t),this.content.forEach(function(e){e.offsetLocation(t)})}}]),t}(),Ui=function(t){function e(t,n,i){var o;return Hi(this,e),(o=Di(this,i?Ii(e).call(this,[t,n,new Wi(i)]):Ii(e).call(this,[t,n]))).vinculum=i,o.numerator=t,o.denominator=n,o.vSpaceNum=0,o.vSpaceDenom=0,o.lineVAboveBaseline=0,o.lineWidth=0,o.scaleModifier=1,o.vinculumPosition=new N(0,0),o.vinculumScale=new N(1,.01),Di(o)}return Fi(e,Vi),Gi(e,[{key:"_dup",value:function(t){var n=this.vinculum;null!=this.vinculum&&t&&(n=t[this.vinculum.name]);var i=new e(this.numerator._dup(t),this.denominator._dup(t),n);return _t(this,i,["numerator","denominator","vinculum","content"]),i}},{key:"calcSize",value:function(t,e){var n=e*this.scaleModifier;this.location=t._dup(),this.numerator.calcSize(t,n),this.denominator.calcSize(t,n),this.width=1.3*Math.max(this.numerator.width,this.denominator.width);var i=(this.width-this.numerator.width)/2,o=(this.width-this.denominator.width)/2;this.vSpaceNum=.05*n,this.vSpaceDenom=.05*n,this.lineVAboveBaseline=.07*n/this.scaleModifier,this.lineWidth=Math.max(.01*n,.008);var r=this.numerator.descent+this.vSpaceNum+this.lineVAboveBaseline,a=this.denominator.ascent+this.vSpaceDenom-this.lineVAboveBaseline,s=this.location;this.numerator.calcSize(new N(s.x+i,s.y+1*r),n),this.denominator.calcSize(new N(s.x+o,s.y-1*a),n),this.descent=this.vSpaceNum+this.lineWidth/2-this.lineVAboveBaseline+this.denominator.ascent+this.denominator.descent,this.ascent=this.vSpaceNum+this.lineWidth/2+this.lineVAboveBaseline+this.numerator.ascent+this.numerator.descent,this.height=this.descent+this.ascent;var l=this.vinculum;l&&(this.vinculumPosition=new N(this.location.x,this.location.y+this.lineVAboveBaseline),this.vinculumScale=new N(this.width,this.lineWidth),l.transform.updateScale(this.vinculumScale),l.transform.updateTranslation(this.vinculumPosition),l.show())}},{key:"getAllElements",value:function(){var t=[];return this.numerator&&(t=qi(t).concat(qi(this.numerator.getAllElements()))),this.denominator&&(t=qi(t).concat(qi(this.denominator.getAllElements()))),this.vinculum&&(t=qi(t).concat([this.vinculum])),t}},{key:"setPositions",value:function(){this.numerator.setPositions(),this.denominator.setPositions();var t=this.vinculum;t&&(t.transform.updateScale(this.vinculumScale),t.transform.updateTranslation(this.vinculumPosition))}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new N(0,0);this.location=this.location.add(t),this.numerator.offsetLocation(t),this.denominator.offsetLocation(t),this.vinculumPosition=this.vinculumPosition.add(t)}}]),e}(),Xi=function(t){function e(t,n){var i,o=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return Hi(this,e),(i=Di(this,n?Ii(e).call(this,[t,new Wi(n)]):Ii(e).call(this,[t]))).strike=n,i.scaleModifier=1,i.lineWidth=.1,i.mainContent=t,i.strikeInSize=o,Di(i)}return Fi(e,Vi),Gi(e,[{key:"_dup",value:function(t){var n;n=null!=this.strike&&t?t[this.strike.name]:this.strike;var i=new e(this.mainContent._dup(t),n);return _t(this,i,["strike","mainContent"]),i}},{key:"calcSize",value:function(t,e){var n=e*this.scaleModifier;this.location=t._dup(),this.mainContent.calcSize(t,n),this.lineWidth=.02*n;var i=1*this.lineWidth,o=new N(t.x,t.y-this.mainContent.descent),r=new N(t.x+this.mainContent.width,t.y+.8*this.mainContent.ascent),a=new Z(o,r),s=new Z(o,i,a.angle()+Math.PI).getPoint(2),l=a.length()+2*i;if(this.strikeInSize){var h=new Z(r,i,a.angle()).getPoint(2);this.width=h.x-s.x,this.ascent=Math.max(this.mainContent.ascent,h.y-t.y),this.descent=Math.max(this.mainContent.descent,t.y-s.y);var u=this.mainContent.location.x-s.x;this.mainContent.offsetLocation(new N(u,0)),s.x+=u}else this.width=this.mainContent.width,this.ascent=this.mainContent.ascent,this.descent=this.mainContent.descent;this.height=this.descent+this.ascent;var c=this.strike;if(c)if(c instanceof fe){this.strikePosition=s._dup(),this.strikeScale=new N(l,.8*this.lineWidth),this.strikeRotation=a.angle();var f=this.strikeScale.x*Math.cos(this.strikeRotation);c._s1.transform.updateScale(this.strikeScale),c._s1.transform.updateTranslation(this.strikePosition),c._s1.transform.updateRotation(this.strikeRotation),c._s2.transform.updateScale(this.strikeScale),c._s2.transform.updateTranslation(this.strikePosition.add(f,0)),c._s2.transform.updateRotation(Math.PI-this.strikeRotation),c.showAll()}else this.strikePosition=s._dup(),this.strikeScale=new N(l,this.lineWidth),this.strikeRotation=a.angle(),c.transform.updateScale(this.strikeScale),c.transform.updateTranslation(this.strikePosition),c.transform.updateRotation(this.strikeRotation),c.show()}},{key:"getAllElements",value:function(){var t=[];return this.mainContent&&(t=qi(t).concat(qi(this.mainContent.getAllElements()))),this.strike&&(t=qi(t).concat([this.strike])),t}},{key:"setPositions",value:function(){this.mainContent.setPositions();var t=this.strike;if(t)if(t instanceof fe){var e=this.strikeScale.x*Math.cos(this.strikeRotation);t._s1.transform.updateScale(this.strikeScale),t._s1.transform.updateTranslation(this.strikePosition),t._s1.transform.updateRotation(this.strikeRotation),t._s2.transform.updateScale(this.strikeScale),t._s2.transform.updateTranslation(this.strikePosition.add(e,0)),t._s2.transform.updateRotation(Math.PI-this.strikeRotation)}else t.transform.updateScale(this.strikeScale),t.transform.updateTranslation(this.strikePosition),t.transform.updateRotation(this.strikeRotation)}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new N(0,0);this.location=this.location.add(t),this.mainContent.offsetLocation(t),this.strikePosition=this.strikePosition.add(t)}}]),e}(),Yi=function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"right",i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"top",o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"left",r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"bottom",a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:.5;Hi(this,t),this.content=e,this.xPosition=n,this.yPosition=i,this.xAlign=o,this.yAlign=r,this.annotationScale=a},Qi=function(t){function e(t,n){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"right",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"top",a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"left",s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"bottom",l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:.5,h=7<arguments.length&&void 0!==arguments[7]&&arguments[7];if(Hi(this,e),Array.isArray(n)){var u=[t];n.forEach(function(t){u.push(t.content)}),i=Di(this,Ii(e).call(this,u))}else i=Di(this,Ii(e).call(this,[t,n]));if(i.mainContent=t,i.annotations=[],Array.isArray(n))i.annotations=n,i.annotationInSize="boolean"==typeof o&&o;else{var c="right";"boolean"!=typeof o&&(c=o),i.annotations=[new Yi(n,c,r,a,s,l)],i.annotationInSize=h}return Di(i)}return Fi(e,Vi),Gi(e,[{key:"_dup",value:function(t){var n=this.annotations.map(function(e){return new Yi(e.content._dup(t),e.xPosition,e.yPosition,e.xAlign,e.yAlign,e.annotationScale)}),i=new e(this.mainContent._dup(t),n,this.annotationInSize);return _t(this,i,["mainContent","annotations"]),i}},{key:"calcSize",value:function(t,e){var n=this;this.location=t._dup(),this.mainContent.calcSize(t,e);var i=this.mainContent.location.x,o=this.mainContent.location.y-this.mainContent.descent,r=this.mainContent.location.x+this.mainContent.width,a=this.mainContent.location.y+this.mainContent.ascent;if(this.annotations.forEach(function(s){var l=s.content,h=s.xPosition,u=s.yPosition,c=s.xAlign,f=s.yAlign,d=s.annotationScale;l.calcSize(t,e*d);var v=n.location._dup(),m=0,p=n.mainContent.descent/n.mainContent.height;"right"===h?m=1:"center"===h?m=.5:"number"==typeof h&&(m=h),v.x+=n.mainContent.width*m,"bottom"===u?p=0:"top"===u?p=1:"middle"===u?p=.5:"number"==typeof u&&(p=u),v.y+=-n.mainContent.descent+n.mainContent.height*p;var g=0,y=l.descent/l.height;"right"===c?g=1:"center"===c?g=.5:"number"==typeof c&&(g=c),"bottom"===f?y=0:"top"===f?y=1:"middle"===f?y=.5:"number"==typeof f&&(y=f);var w=new N(-g*l.width,l.descent-y*l.height);l.calcSize(v,e*d),l.offsetLocation(w);var b=l.location.x+l.width,x=l.location.y+l.ascent,_=l.location.x,k=l.location.y-l.descent;r=r<b?b:r,a=a<x?x:a,i=_<i?_:i,o=k<o?k:o}),this.annotationInSize){var s=new N(i,o),l=new N(r,a);this.width=l.x-s.x,this.ascent=l.y-this.mainContent.location.y,this.descent=this.mainContent.location.y-s.y;var h=this.mainContent.location.x-s;h&&(this.mainContent.offsetLocation(new N(h,0)),this.annotations=this.annotations.map(function(t){return t.content.offsetLocation(new N(h,0))}))}else this.width=this.mainContent.width,this.ascent=this.mainContent.ascent,this.descent=this.mainContent.descent;this.height=this.descent+this.ascent}},{key:"getAllElements",value:function(){var t=[];return this.mainContent&&(t=qi(t).concat(qi(this.mainContent.getAllElements()))),this.annotations.forEach(function(e){t=qi(t).concat(qi(e.content.getAllElements()))}),t}},{key:"setPositions",value:function(){this.mainContent.setPositions(),this.annotations.forEach(function(t){t.content.setPositions()})}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new N(0,0);this.location=this.location.add(t),this.mainContent.offsetLocation(t),this.annotations.forEach(function(e){e.content.offsetLocation(t)})}}]),e}(),Zi=function(t){function e(t,n,i){var o,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0;return Hi(this,e),(o=Di(this,Ii(e).call(this,[t,n,i]))).superscript=n,o.subscript=i,o.subscriptXBias=a,o.mainContent=t,o.xBias=r,o}return Fi(e,Vi),Gi(e,[{key:"_dup",value:function(t){var n=null==this.superscript?null:this.superscript._dup(t),i=null==this.subscript?null:this.subscript._dup(t),o=new e(this.mainContent._dup(t),n,i,this.xBias,this.subscriptXBias);return _t(this,o,["mainContent","superscript","subscript","content"]),o}},{key:"calcSize",value:function(t,e){this.location=t._dup();var n=t._dup();this.mainContent.calcSize(n,e);var i=this.mainContent.width,o=this.mainContent.ascent,r=this.mainContent.descent,a=this.superscript;if(null!==a){var s=new N(this.location.x+this.mainContent.width+this.xBias,this.location.y+.7*this.mainContent.ascent);a.calcSize(s,e/2),i=Math.max(i,s.x-this.location.x+a.width),o=Math.max(o,a.ascent+s.y-this.location.y),r=Math.max(r,this.location.y-(s.y-a.descent))}var l=this.subscript;if(null!==l){var h=new N(this.location.x+this.mainContent.width-this.subscriptXBias+this.xBias,this.location.y-.5*this.mainContent.height);l.calcSize(h,e/2),i=Math.max(i,h.x-this.location.x+l.width),o=Math.max(o,l.ascent+h.y-this.location.y),r=Math.max(r,l.descent+(this.location.y-h.y))}this.width=i,this.ascent=o,this.descent=r,this.height=this.descent+this.ascent}},{key:"getAllElements",value:function(){var t=[];return this.superscript&&(t=qi(t).concat(qi(this.superscript.getAllElements()))),this.subscript&&(t=qi(t).concat(qi(this.subscript.getAllElements()))),this.mainContent&&(t=qi(t).concat(qi(this.mainContent.getAllElements()))),t}},{key:"setPositions",value:function(){this.mainContent.setPositions(),this.superscript&&this.superscript.setPositions(),this.subscript&&this.subscript.setPositions()}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new N(0,0);this.location=this.location.add(t),this.mainContent.offsetLocation(t),this.superscript&&this.superscript.offsetLocation(t),this.subscript&&this.subscript.offsetLocation(t)}}]),e}(),Ki=function t(){Hi(this,t),this.width=0,this.height=0,this.ascent=0,this.descent=0},$i=function(t){function e(t,n,i,o){var r;Hi(this,e);var a=null!==o?new Wi(o):null;return(r=Di(this,Ii(e).call(this,[a,t,n,i]))).limitMin=t,r.limitMax=n,r.mainContent=i,r.integralGlyph=o,r.glyphLocation=new N(0,0),r.glyphScale=1,r}return Fi(e,Vi),Gi(e,[{key:"_dup",value:function(t){var n=new e(null==this.limitMin?null:this.limitMin._dup(t),null==this.limitMax?null:this.limitMax._dup(t),null==this.mainContent?null:this.mainContent._dup(t),null!=this.integralGlyph&&t?t[this.integralGlyph.name]:this.integralGlyph);return _t(this,n,["limitMin","limitMax","content","integralGlyph","content"]),n}},{key:"getAllElements",value:function(){var t=[];return this.limitMin&&(t=qi(t).concat(qi(this.limitMin.getAllElements()))),this.limitMax&&(t=qi(t).concat(qi(this.limitMax.getAllElements()))),this.mainContent&&(t=qi(t).concat(qi(this.mainContent.getAllElements()))),this.integralGlyph&&(t=qi(t).concat([this.integralGlyph])),t}},{key:"setPositions",value:function(){var t=this.integralGlyph;null!=t&&(t.transform.updateScale(this.glyphScale,this.glyphScale),t.transform.updateTranslation(this.glyphLocation.x,this.glyphLocation.y)),this.limitMin&&this.limitMin.setPositions(),this.limitMax&&this.limitMax.setPositions(),this.mainContent&&this.mainContent.setPositions()}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new N(0,0);this.location=this.location.add(t),null!=this.integralGlyph&&(this.glyphLocation=this.glyphLocation.add(t)),this.mainContent&&this.mainContent.offsetLocation(t),this.limitMax&&this.limitMax.offsetLocation(t),this.limitMin&&this.limitMin.offsetLocation(t)}},{key:"calcSize",value:function(t,e){this.location=t._dup();var n=t._dup(),i=new Ki,o=new Ki,r=new Ki,a=new Ki,l=this.mainContent;l instanceof Vi&&(l.calcSize(n._dup(),e),i.width=l.width,i.height=l.ascent+l.descent,i.ascent=l.ascent,i.descent=l.descent);var h=this.limitMax;h instanceof Vi&&(h.calcSize(n._dup(),e/2),r.width=h.width,r.height=h.ascent+h.descent,r.ascent=h.ascent,r.descent=h.descent);var u=this.limitMin;u instanceof Vi&&(u.calcSize(n._dup(),e/2),o.width=u.width,o.height=u.ascent+u.descent,o.ascent=u.ascent,o.descent=u.descent);var c=i.ascent+i.descent+o.height+r.height,f=s(c/e,0)*e*1.2,d=new N(n.x,n.y-f/2+.45*e),v=this.integralGlyph;if(v instanceof ce){v.show(),v.transform.updateScale(f,f),v.transform.updateTranslation(d.x,d.y),this.glyphLocation=d,this.glyphScale=f;var m=v.drawingObject.getRelativeVertexSpaceBoundingRect();a.width=m.width*f,a.height=(-m.bottom+m.top)*f,a.ascent=m.top*f,a.descent=-m.bottom*f}var p=new N(this.location.x+.5*a.width,d.y),g=new N(this.location.x+1.2*a.width,d.y+a.height-r.height/2),y=new N(this.location.x+.8*a.width,this.location.y);l instanceof Vi&&l.calcSize(y,e),u instanceof Vi&&u.calcSize(p,e/2),h instanceof Vi&&h.calcSize(g,e/2),this.width=Math.max(a.width,o.width+p.x-this.location.x,r.width+g.x-this.location.x,i.width+y.x-this.location.x),this.ascent=Math.max(a.ascent,r.ascent+g.y-this.location.y,i.ascent+y.y-this.location.y),this.descent=Math.max(a.descent,o.descent+this.location.y-p.y,i.ascent+this.location.y-y.y),this.height=this.descent+this.ascent}}]),e}(),Ji=function(t){function e(t,n,i){var o,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.03;Hi(this,e);var a=null!==n?new Wi(n):null,s=null!==i?new Wi(i):null;return(o=Di(this,Ii(e).call(this,[a,t,s]))).glyph=n,o.rightGlyph=i,o.mainContent=t,o.glyphLocation=new N(0,0),o.rightGlyphLocation=new N(0,0),o.glyphScale=1,o.space=r,o}return Fi(e,Vi),Gi(e,[{key:"_dup",value:function(t){var n=null==this.mainContent?null:this.mainContent._dup(t),i=this.glyph;null!=this.glyph&&t&&(i=t[this.glyph.name]);var o=this.rightGlyph;null!=this.rightGlyph&&t&&(o=t[this.rightGlyph.name]);var r=new e(n,i,o,this.space);return _t(this,r,["content","glyph","rightGlyph"]),r}},{key:"getAllElements",value:function(){var t=[];return this.mainContent&&(t=qi(t).concat(qi(this.mainContent.getAllElements()))),this.glyph&&(t=qi(t).concat([this.glyph])),this.rightGlyph&&(t=qi(t).concat([this.rightGlyph])),t}},{key:"setPositions",value:function(){var t=this.glyph,e=this.rightGlyph;null!=t&&(t.transform.updateScale(this.glyphScale,this.glyphScale),t.transform.updateTranslation(this.glyphLocation.x,this.glyphLocation.y)),null!=e&&(e.transform.updateScale(this.glyphScale,this.glyphScale),e.transform.updateTranslation(this.rightGlyphLocation.x,this.rightGlyphLocation.y)),this.mainContent&&this.mainContent.setPositions()}},{key:"offsetLocation",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:new N(0,0);this.location=this.location.add(t);var e=this.glyph,n=this.rightGlyph;null!=e&&(this.glyphLocation=this.glyphLocation.add(t)),null!=n&&(this.rightGlyphLocation=this.rightGlyphLocation.add(t)),this.mainContent&&this.mainContent.offsetLocation(t)}},{key:"calcSize",value:function(t,e){this.location=t._dup();var n=t._dup(),i=new Ki,o=new Ki,r=new Ki,a=this.mainContent;a instanceof Vi&&(a.calcSize(n._dup(),e),i.width=a.width,i.height=a.ascent+a.descent,i.ascent=a.ascent,i.descent=a.descent);var s=1.4*i.height,l=i.descent+i.height*(1.4-1)/1.8,h=new N(n.x+this.space*e,n.y-l),u=this.glyph;if(u instanceof ce){u.show(),u.transform.updateScale(s,s),u.transform.updateTranslation(h.x,h.y),this.glyphLocation=h,this.glyphScale=s;var c=u.drawingObject.getRelativeVertexSpaceBoundingRect();o.width=c.width*s,o.height=(-c.bottom+c.top)*s,o.ascent=c.top*s,o.descent=-c.bottom*s}var f=new N(n.x+i.width+o.width+3*this.space*e,h.y),d=this.rightGlyph;if(d instanceof ce){d.show(),d.transform.updateScale(s,s),d.transform.updateTranslation(f.x,f.y),this.rightGlyphLocation=f;var v=d.drawingObject.getRelativeVertexSpaceBoundingRect();r.width=v.width*s,r.height=(-v.bottom+v.top)*s,r.ascent=v.top*s,r.descent=-v.bottom*s}var m=new N(this.location.x+o.width+this.space*e*2,this.location.y);a instanceof Vi&&a.offsetLocation(m.sub(a.location)),this.width=o.width+i.width+r.width+this.space*e*4,this.ascent=o.height-l,this.descent=l,this.height=this.descent+this.ascent}}]),e}(),to=function(t){function e(t,n){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.03,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.03,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"top";return Hi(this,e),(i=Di(this,Ii(e).call(this,t,n,null,o))).barPosition=a,i.outsideSpace=r,i}return Fi(e,Ji),Gi(e,[{key:"calcSize",value:function(t,e){this.location=t._dup();var n=t._dup(),i=new Ki,o=new Ki,r=this.mainContent;r instanceof Vi&&(r.calcSize(n._dup(),e),i.width=r.width,i.height=r.ascent+r.descent,i.ascent=r.ascent,i.descent=r.descent);var a=1*i.width,s=a,l=new N(n.x-0*a/2,n.y+i.ascent+this.space*e);"bottom"===this.barPosition&&(l.y=n.y-i.descent-this.space*e);var h=this.glyph;if(h instanceof ce){h.show(),h.transform.updateScale(s,s),h.transform.updateTranslation(l.x,l.y),this.glyphLocation=l,this.glyphScale=s;var u=h.drawingObject.getRelativeVertexSpaceBoundingRect();o.width=u.width*s,o.height=(-u.bottom+u.top)*s,o.ascent=u.top*s,o.descent=-u.bottom*s}this.width=i.width,"top"===this.barPosition?(this.ascent=i.ascent+o.height+this.space*e+this.outsideSpace*e,this.descent=i.descent):(this.ascent=i.ascent,this.descent=i.descent+o.height+this.space*e+this.outsideSpace*e),this.height=this.descent+this.ascent}},{key:"_dup",value:function(t){var n=null==this.mainContent?null:this.mainContent._dup(t),i=this.glyph;null!=this.glyph&&t&&(i=t[this.glyph.name]);var o=new e(n,i,this.space,this.outsideSpace,this.barPosition);return _t(this,o,["content","glyph"]),o}}]),e}();function eo(t,e){return"string"==typeof e?t&&"_".concat(e)in t?t["_".concat(e)]:null:e}function no(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new H(-1,-1,2,2),o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:new rt,r=[1,1,1,1];Array.isArray(n)&&(r=n.slice());var a=new Vt("Times New Roman","normal",.2,"200","left","alphabetic",r),s=new Vt("Times New Roman","italic",.2,"200","left","alphabetic",r);n instanceof Vt&&((a=n._dup()).style="normal",(s=n._dup()).style="italic",null!=a.color&&(r=function(t){var e=t.replace(/.*\(/i,"").replace(/\)/i,"").split(",").map(function(t,e){return e<3?parseInt(t,10)/255:parseFloat(t)});return 3===e.length&&e.push(1),e}(a.color)));var l=new fe(new rt("Equation Elements Collection").scale(1,1).rotate(0).translate(0,0),i),h=function(t,n){var o=a;n instanceof Vt?o=n:"italic"===n?o=s:"normal"===n?o=a:t.match(/[A-Z,a-z]/)&&(o=s);var l=new Ut(new N(0,0),t,o),h=new Xt(e,[l]);return new ce(h,new rt("Equation Element").scale(1,1).translate(0,0),r,i)};return Object.keys(t).forEach(function(e){if("string"==typeof t[e]&&(e.startsWith("space")||l.add(e,h(t[e],null))),t[e]instanceof ce&&l.add(e,t[e]),t[e]instanceof fe&&l.add(e,t[e]),Array.isArray(t[e])){var n=Bi(t[e],7),i=n[0],o=n[1],r=n[2],a=n[3],s=n[4],u=n[5],c=n[6],f=h(i,c);o&&f.setColor(o),r&&(f.isTouchable=r),a&&(f.onClick=a),s&&(f.animate.transform.translation.style="curved",f.animate.transform.translation.options.direction=s),u&&(f.animate.transform.translation.style="curved",f.animate.transform.translation.options.magnitude=u),l.add(e,f)}}),l.setFirstTransform(o),l}function io(t,e){if(e instanceof Vi)return e._dup();var n=[];if("string"==typeof e)if(e.startsWith("space")){var i=parseFloat(e.replace(/space[_]*/,""))||.03;n.push(new Wi(new zi(i)))}else{var o=eo(t,e);o&&n.push(new Wi(o))}else Array.isArray(e)?e.forEach(function(e){if("string"==typeof e)if(e.startsWith("space")){var i=parseFloat(e.replace(/space[_]*/,""))||.03;n.push(new Wi(new zi(i)))}else{var o=eo(t,e);o&&n.push(new Wi(o))}else null!==e&&n.push(e)}):null!==e&&n.push(e);return new Vi(n)}var oo=function(t){function e(t){var n;return Hi(this,e),(n=Di(this,Ii(e).call(this,[]))).collection=t,n.description=null,n.modifiers={},n.elementMods={},n.time=null,n}return Fi(e,Vi),Gi(e,[{key:"getNamedElements",value:function(){var t={};return this.collection.getAllElements().forEach(function(e){t[e.name]=e}),t}},{key:"_dup",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.collection,n=new e(t),i={};t.getAllElements().forEach(function(t){i[t.name]=t});var o=[];return this.content.forEach(function(t){o.push(t._dup(i))}),n.content=o,_t(this,n,["content","collection","form"]),n}},{key:"createEq",value:function(t){var e=this,n=[];t.forEach(function(t){if("string"==typeof t)if(t.startsWith("space")){var i=parseFloat(t.replace(/space[_]*/,""))||.03;n.push(new Wi(new zi(i)))}else{var o=eo(e.collection,t);o&&n.push(new Wi(o))}else n.push(t._dup());e.content=n})}},{key:"arrange",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"left",i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"baseline",o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new N(0,0),r=this.collection.getAllElements().filter(function(t){return t.isShown});this.collection.hideAll(),this.collection.show(),ji(Ii(e.prototype),"calcSize",this).call(this,new N(0,0),t);var a=new N(0,0);if(o instanceof ce||o instanceof fe){var s=o.transform.t();null!=s&&(a=s._dup())}else a=o._dup();var l=this.width,h=this.height,u=this.ascent,c=this.descent,f=this.location._dup();if(o instanceof ce||o instanceof fe){var d=o.transform.t();if(null!=d){var v=o.getVertexSpaceBoundingRect();l=v.width,h=v.height,u=v.top-d.y,c=d.y-v.bottom,f=d._dup()}}"right"===n?a.x+=l:"center"===n&&(a.x+=l/2),"top"===i?a.y+=f.y+u:"bottom"===i?a.y+=f.y-c:"middle"===i&&(a.y+=f.y-c+h/2);var m=new N(0,0).sub(a);0===m.x&&0===m.y||(this.offsetLocation(m),this.setPositions()),this.collection.showOnly(r)}},{key:"dissolveElements",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"in",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.01,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;if(0===t.length&&o)o(!1);else{var r=t.length,a=0,s=function(t){(a+=1)===r&&o&&o(t)};t.forEach(function(t){t.disolveWithDelay(n,i,e,s)})}}},{key:"getElementsToShowAndHide",value:function(){var t=this.collection.getAllElements().filter(function(t){return t.isShown}),e=this.getAllElements(),n=t.filter(function(t){return-1===e.indexOf(t)});return{show:e.filter(function(e){return-1===t.indexOf(e)}),hide:n}}},{key:"render",value:function(){this.hideShow(),this.setPositions()}},{key:"showHide",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.collection.stop(),this.collection.show();var i=this.getElementsToShowAndHide(),o=i.show,r=i.hide;0===t?o.forEach(function(t){t.showAll()}):this.dissolveElements(o,"in",.01,t,null),0===e?r.forEach(function(t){return t.hide()}):this.dissolveElements(r,"out",t,e,n)}},{key:"hideShow",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;this.collection.stop(),this.collection.show();var i=this.getElementsToShowAndHide(),o=i.show,r=i.hide;0===e?r.forEach(function(t){return t.hide()}):this.dissolveElements(r,"out",.01,e,null),0===t?(o.forEach(function(t){t.showAll()}),null!=n&&n()):this.dissolveElements(o,"in",e,t,n)}},{key:"allHideShow",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.5,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.5,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.5,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null;this.collection.stop();var a=this.collection.getAllElements().filter(function(t){return t.isShown}),s=this.getAllElements(),l=s.filter(function(t){return!t.isShown}),h=s.filter(function(t){return t.isShown}),u=e;if(0!==s.length||0!==a.length||null==r){var c=function(){t.setPositions()};0===s.length&&(c=function(e){t.setPositions(),null!=r&&r(e)}),0<a.length?(this.dissolveElements(a,"out",e,n,c),u+=n):this.setPositions();var f=s.length,d=0,v=function(t){(d+=1)===f-1&&r&&r(t)};l.forEach(function(t){t.disolveWithDelay(u+i,o,"in",v)}),h.forEach(function(t){t.disolveWithDelay(i,o,"in",v)})}else r(!1)}},{key:"animatePositionsTo",value:function(t,e,n,i){var o=this,r=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,a=this.collection.getAllElements();this.collection.stop();var s=a.filter(function(t){return t.isShown}),l=this.getAllElements(),h=s.filter(function(t){return-1===l.indexOf(t)}),u=l.filter(function(t){return-1===s.indexOf(t)}),c=this.collection.getElementTransforms();this.setPositions();var f,d=this.collection.getElementTransforms(),v=[],m=[],p=[];Object.keys(d).forEach(function(t){var e=c[t],n=d[t];e.isEqualTo(n)||(v.push(t),m.push(e),p.push(n))}),f=null===n?vt(m,p,0,new N(.35,.35),2*Math.PI/6,new N(.4,.4)):n,this.collection.setElementTransforms(c);var g=t,y=null,w=null,b=null;0===v.length&&0===u.length?b=r:0===u.length?y=r:w=r,0<h.length&&(this.dissolveElements(h,"out",t,e,b),g+=e),Object.keys(this.elementMods).forEach(function(t){var e=o.elementMods[t],n=e.element,i=e.color,r=e.style,a=e.direction,s=e.mag;null!=n&&(null!=i&&n.animateColorToWithDelay(i,g,f),null!=r&&(n.animate.transform.translation.style=r),null!=a&&(n.animate.transform.translation.options.direction=a),null!=s&&(n.animate.transform.translation.options.magnitude=s))});var x=this.collection.animateToTransforms(d,f,g,0,y);return 0<x&&(g=x),0<u.length&&(this.dissolveElements(u,"in",g,i,w),g+=i+.001),g}},{key:"animateTo",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new N(0,0),i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"left",r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"baseline",a=this.collection.getAllElements();this.collection.stop();var s=a.filter(function(t){return t.isShown}),l=this.getAllElements(),h=s.filter(function(t){return-1===l.indexOf(t)}),u=l.filter(function(t){return-1===s.indexOf(t)}),c=this.collection.getElementTransforms();this.arrange(t,o,r,n);var f=this.collection.getElementTransforms();this.collection.setElementTransforms(c),this.dissolveElements(h,"out",.001,.01,null),this.collection.animateToTransforms(f,e,0),this.dissolveElements(u,"in",e,.5,i)}},{key:"sfrac",value:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,o=this.frac(t,e,n);return o.scaleModifier=i,o}},{key:"frac",value:function(t,e,n){return new Ui(io(this.collection,t),io(this.collection,e),eo(this.collection,n))}},{key:"sub",value:function(t,e){return new Zi(io(this.collection,t),null,io(this.collection,e))}},{key:"sup",value:function(t,e){return new Zi(io(this.collection,t),io(this.collection,e),null)}},{key:"supsub",value:function(t,e,n){return new Zi(io(this.collection,t),io(this.collection,e),io(this.collection,n))}},{key:"int",value:function(t,e,n,i){return new $i(io(this.collection,t),io(this.collection,e),io(this.collection,n),eo(this.collection,i))}}]),e}(),ro=function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new H(-1,-1,2,2),i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new rt("Equation").scale(1,1).rotate(0).translate(0,0);Hi(this,t),this.drawContext2D=e,this.diagramLimits=n,this.firstTransform=i,this.form={},this.formAlignment={vAlign:"baseline",hAlign:"left",fixTo:new N(0,0),scale:1},this.currentForm="",this.currentFormType="",this.formTypeOrder=["base"],this.descriptionPosition=new N(0,0),this.isAnimating=!1}return Gi(t,[{key:"_dup",value:function(){var e=this,n=new t(this.drawContext2D,this.diagramLimits._dup(),this.firstTransform._dup());_t(this,n,["collection","form","drawContext2D","formAlignment"]);var i=this.collection._dup();n.collection=i;var o={};Object.keys(this.form).forEach(function(t){t in o||(o[t]={}),Object.keys(e.form[t]).forEach(function(n){o[t][n]="name"!==n?e.form[t][n]._dup(i):e.form[t][n]})}),n.form=o,_t(this.formAlignment,n.formAlignment,["fixTo"]);var r=this.formAlignment.fixTo;return r instanceof N?n.formAlignment.fixTo=this.formAlignment.fixTo._dup():Object.keys(i.elements).forEach(function(t){i.elements[t].name===r.name&&(n.formAlignment.fixTo=i.elements[t])}),n}},{key:"createElements",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:new N(0,0);this.collection=no(t,this.drawContext2D,e,this.diagramLimits,this.firstTransform),this.addDescriptionElement(n,i)}},{key:"addDescriptionElement",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new N(0,0);this.descriptionElement=t,this.descriptionPosition=e,this.descriptionElement&&this.descriptionElement.setPosition(this.collection.getDiagramPosition().add(e))}},{key:"setPosition",value:function(t){this.collection.setPosition(t),this.descriptionElement&&this.descriptionElement.setPosition(t.add(this.descriptionPosition))}},{key:"stop",value:function(){this.collection.stop()}},{key:"setElem",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.5,r=t;"string"==typeof r&&(r=eo(this.collection,t)),(r instanceof fe||r instanceof ce)&&(null!=e&&r.setColor(e),(r.isTouchable=n)&&(this.collection.hasTouchableElements=!0),r.animate.transform.translation.style="curved",r.animate.transform.translation.options.direction=i,r.animate.transform.translation.options.magnitude=o)}},{key:"addForm",value:function(t,e){var n=this,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};t in this.form||(this.form[t]={});var o={formType:"base",addToSeries:!0,elementMods:{},animationTime:null,description:"",modifiers:{}},r=o;i&&(r=Object.assign({},o,i));var a=r,s=a.formType,l=a.description,h=a.modifiers,u=a.animationTime,c=a.elementMods,f=a.addToSeries,d=u;this.form[t][s]=new oo(this.collection),this.form[t].name=t,this.form[t][s].name=t,this.form[t][s].description=l,this.form[t][s].modifiers=h,this.form[t][s].type=s,this.form[t][s].elementMods={},this.form[t][s].time="number"==typeof d?{fromPrev:d,fromNext:d,fromAny:d}:d,Object.keys(c).forEach(function(e){var i=eo(n.collection,e);if(i){var o,r,a,l;if(Array.isArray(c[e])){var h=Bi(c[e],4);o=h[0],r=h[1],a=h[2],l=h[3]}else{var u=c[e];o=u.color,r=u.style,a=u.direction,l=u.mag}n.form[t][s].elementMods[e]={element:i,color:o,style:r,direction:a,mag:l}}});var v=this.form[t][s];if(v.createEq(e),v.type=s,v.arrange(this.formAlignment.scale,this.formAlignment.hAlign,this.formAlignment.vAlign,this.formAlignment.fixTo),f&&(null==this.formSeries&&(this.formSeries=[]),this.formSeries.push(this.form[t])),void 0===this.form[t].base){var m=Object.assign({},i);m.formType="base",this.addForm(t,e,m)}}},{key:"getCurrentForm",value:function(){return null==this.form[this.currentForm]?null:null==this.form[this.currentForm][this.currentFormType]?null:this.form[this.currentForm][this.currentFormType]}},{key:"reArrangeCurrentForm",value:function(){var t=this.getCurrentForm();null!=t&&t.arrange(this.formAlignment.scale,this.formAlignment.hAlign,this.formAlignment.vAlign,this.formAlignment.fixTo)}},{key:"scaleForm",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"base";t in this.form&&n in this.form[t]&&this.form[t][n].arrange(e,this.formAlignment.hAlign,this.formAlignment.vAlign,this.formAlignment.fixTo)}},{key:"scale",value:function(t){var e=this;Object.keys(this.form).forEach(function(n){Object.keys(e.form[n]).forEach(function(i){"name"!==i&&e.scaleForm(n,t,i)})})}},{key:"setFormSeries",value:function(t){var e=this;this.formSeries=[],t.forEach(function(t){"string"==typeof t?e.formSeries.push(e.form[t]):e.formSeries.push(t)})}},{key:"getFormIndex",value:function(t){var e=this.getForm(t),n=-1;return null!=e&&(n=this.formSeries.indexOf(this.form[e.name])),n}},{key:"prevForm",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=this.getCurrentForm();if(null!=n){var i=this.getFormIndex(n);-1<i&&((i-=1)<0&&(i=this.formSeries.length-1),this.goToForm(i,t,e,"fromNext"))}}},{key:"nextForm",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=!0,i=this.getCurrentForm();if(null!=i){var o=this.getFormIndex(i);-1<o&&((o+=1)>this.formSeries.length-1&&(o=0,n=!1),this.goToForm(o,t,e,"fromPrev",n))}}},{key:"replayCurrentForm",value:function(t){if(this.isAnimating){this.collection.stop(!0,!0),this.collection.stop(!0,!0),this.isAnimating=!1;var e=this.getCurrentForm();null!=e&&this.showForm(e)}else this.collection.stop(),this.collection.stop(),this.isAnimating=!1,this.prevForm(0),this.nextForm(t,.5)}},{key:"goToForm",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"fromAny",r=!(4<arguments.length&&void 0!==arguments[4])||arguments[4];if(this.isAnimating){this.collection.stop(!0,!0),this.collection.stop(!0,!0),this.isAnimating=!1;var a=this.getCurrentForm();null!=a&&this.showForm(a)}else{this.collection.stop(),this.collection.stop(),this.isAnimating=!1;var s=0;if(null==e){var l=0,h=this.getCurrentForm();null!=h&&(l=this.formSeries.indexOf(this.form[h.name]))<0&&(l=0),(s=l+1)===this.formSeries.length&&(s=0)}else"number"==typeof e?s=e:this.formSeries.forEach(function(t,n){t.name===e&&(s=n)});var u=null,c=null,f=this.formTypeOrder.filter(function(e){return e in t.formSeries[s]});if(f.length&&(c=f[0]),null!=c){if(u=this.formSeries[s][c],0===n)this.showForm(u);else{this.isAnimating=!0;var d=function(){t.isAnimating=!1};if(r){var v=null;null!=u.time&&null!=u.time[o]&&(v=u.time[o]),u.animatePositionsTo(i,.4,v,.4,d)}else u.allHideShow(i,.5,.2,.5,d);this.setCurrentForm(u)}this.updateDescription()}}}},{key:"changeDescription",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"base",o=this.getForm(t,i);null!=o&&(o.description="".concat(e),o.modifiers=n)}},{key:"updateDescription",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"base",n=this.descriptionElement;if(null!=n&&!1!==n.isShown){var i;if(null!=(i=null==t?this.getCurrentForm():"string"==typeof t?this.getForm(t,e):t)&&null!=i.description){var o=n.drawingObject;o instanceof Lt&&(o.change(Ai(i.description,i.modifiers),n.lastDrawTransform.m()),Ci(i.modifiers))}}}},{key:"render",value:function(){var t=this.getCurrentForm();null!=t&&(t.showHide(),this.collection.show(),t.setPositions(),this.updateDescription())}},{key:"setCurrentForm",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"base";"string"==typeof t?(this.currentForm="",this.currentFormType="",t in this.form&&(this.currentForm=t,e in this.form[t]&&(this.currentFormType=e))):(this.currentForm=t.name,this.currentFormType=t.type)}},{key:"setUnits",value:function(t){"deg"===t&&(this.formTypeOrder=["deg","base"]),"rad"===t&&(this.formTypeOrder=["rad","base"]),this.collection.isShown&&this.showForm(this.currentForm)}},{key:"showForm",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.collection.show();var n=t;"string"==typeof t&&(n=this.getForm(t,e)),n&&(this.setCurrentForm(n),this.render())}},{key:"getForm",value:function(t,e){var n=this;if(t instanceof oo)return t;if(t in this.form){var i=e;if(null==i){var o=this.formTypeOrder.filter(function(e){return e in n.form[t]});o.length&&(i=o[0])}if(null!=i)return this.form[t][i]}return null}},{key:"phrase",value:function(t){return new Vi([io(this.collection,t)])}},{key:"frac",value:function(t,e,n){return new Ui(io(this.collection,t),io(this.collection,e),eo(this.collection,n))}},{key:"strike",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return new Xi(io(this.collection,t),eo(this.collection,e),n)}},{key:"annotation",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return new Qi(io(this.collection,t),e,n)}},{key:"ann",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"right",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"top",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"left",o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"bottom",r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:.5;return new Yi(io(this.collection,t),e,n,i,o,r)}},{key:"sfrac",value:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:1,o=this.frac(t,e,n);return o.scaleModifier=i,o}},{key:"sub",value:function(t,e){return new Zi(io(this.collection,t),null,io(this.collection,e))}},{key:"sup",value:function(t,e){return new Zi(io(this.collection,t),io(this.collection,e),null)}},{key:"supsub",value:function(t,e,n){return new Zi(io(this.collection,t),io(this.collection,e),io(this.collection,n))}},{key:"brac",value:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.03;return new Ji(io(this.collection,t),eo(this.collection,e),eo(this.collection,n),i)}},{key:"topBar",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.03,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.03;return new to(io(this.collection,t),eo(this.collection,e),n,i,"top")}},{key:"bottomBar",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.03,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.03;return new to(io(this.collection,t),eo(this.collection,e),n,i,"bottom")}},{key:"topComment",value:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:.03,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.03;return this.annotation(this.topBar(t,n,i,o),[this.ann(e,"center","top","center","bottom")])}},{key:"bottomComment",value:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:.03;return this.annotation(this.bottomBar(t,n,i,o),[this.ann(e,"center","bottom","center","top")])}}]),t}();function ao(t){return(ao="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function so(t,e){return!e||"object"!==ao(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function lo(t,e,n){return(lo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ho(t)););return t}(t,e);if(i){var o=Object.getOwnPropertyDescriptor(i,e);return o.get?o.get.call(n):o.value}})(t,e,n||t)}function ho(t){return(ho=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function uo(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}function co(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fo(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function vo(t,e,n){return e&&fo(t.prototype,e),n&&fo(t,n),t}var mo=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";co(this,t),this.id=e,Array.isArray(n)?this.classes=n:0<n.length?this.classes=n.split(" "):this.classes=[]}return vo(t,[{key:"render",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0,o=" ".repeat(i),r=t?' id="'.concat(t,'"'):"",a=e?" ".concat(e.join(" ")):"",s="".concat(o,"<div").concat(r,' class="equation_element').concat(a,'">\n');return(s+="".concat(n,"\n"))+"".concat(o,"</div>")}(this.id,this.classes,e,t)}}]),t}(),po=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return co(this,e),(n=so(this,ho(e).call(this,i,o))).classes.push("equation_text"),n.text=t,n}return uo(e,mo),vo(e,[{key:"render",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return lo(ho(e.prototype),"render",this).call(this,t,"".concat(" ".repeat(t+2)).concat(this.text))}}]),e}(),go=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];co(this,e),n=so(this,ho(e).call(this,i,o));var r=[];return t.forEach(function(t){null!==t&&r.push(t)}),n.content=r,n}return uo(e,mo),vo(e,[{key:"render",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return lo(ho(e.prototype),"render",this).call(this,t,this.content.map(function(e){return e.render(t+2)}).join("\n"))}}]),e}(),yo=function(t){function e(t,n){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[];return co(this,e),(i=so(this,ho(e).call(this,o,r))).classes.push("fraction"),i.numerator=t,i.denominator=n,i}return uo(e,mo),vo(e,[{key:"render",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=" ".repeat(t+2),i="";return i+="".concat(n,'<div class="numerator">\n'),i+=this.numerator.render(t+4),i+="\n".concat(n,"</div>\n"),i+="".concat(n,'<div class="fraction_line"> </div>\n'),i+="".concat(n,'<div class="denominator">\n'),i+=this.denominator.render(t+4),i+="\n".concat(n,"</div>"),lo(ho(e.prototype),"render",this).call(this,t,i)}}]),e}(),wo=function(t){function e(t,n,i){var o,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"";return co(this,e),(o=so(this,ho(e).call(this,r,a))).classes.push("supersub"),o.superscript=n,o.subscript=i,o.content=t,o}return uo(e,mo),vo(e,[{key:"render",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=" ".repeat(t+2),i="";return i+="".concat(n,'<div class="supsub_content element">\n'),i+=this.content.render(t+2),i+="\n".concat(n,"</div>\n"),i+="".concat(n,'<div class="super_sub element">\n'),i+="".concat(n,'<div class="super_sub_super superscript_text element">\n'),null!==this.superscript&&(i+=this.superscript.render(t+4)),i+="\n".concat(n,"</div>\n"),i+="".concat(n,'<div class="super_sub_sub subscript_text element">\n'),null!==this.subscript&&(i+=this.subscript.render(t+4)),i+="\n".concat(n,"</div>"),i+="\n".concat(n,"</div>\n"),lo(ho(e.prototype),"render",this).call(this,t,i)}}]),e}(),bo=function(t){function e(t,n){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";co(this,e);var a=(i=so(this,ho(e).call(this,t,null,n,o,r))).classes.indexOf("supersub");return-1<a&&i.classes.splice(a,1),i.classes.push("subscript"),i}return uo(e,wo),e}(),xo=function(t){function e(t,n){var i,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";co(this,e);var a=(i=so(this,ho(e).call(this,t,n,null,o,r))).classes.indexOf("supersub");return-1<a&&i.classes.splice(a,1),i.classes.push("superscript"),i}return uo(e,wo),e}(),_o=function(t){function e(t){var n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return co(this,e),(n=so(this,ho(e).call(this,i,o))).content=t,n}return uo(e,mo),vo(e,[{key:"render",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n=" ".repeat(t+2),i="";return i+="".concat(n,'<div class="square_root element">\n'),i+="".concat(n,'  <div class="equation_element radical element">\n'),i+="".concat(n,"    &radic;\n"),i+="".concat(n,"  </div>\n"),i+=this.content.render(t+4),i+="\n".concat(n,"</div>"),lo(ho(e.prototype),"render",this).call(this,t,i)}}]),e}();function ko(t){if(t instanceof go)return t;if(t instanceof po||t instanceof mo)return new go([t]);if("string"==typeof t)return new go([new po(t)]);var e=[];return t.forEach(function(t){"string"==typeof t?e.push(new po(t)):e.push(t)}),new go(e)}var To=function(t){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return co(this,e),so(this,ho(e).call(this,[],t,n))}return uo(e,go),vo(e,[{key:"createEq",value:function(t){var e=this,n=[];t.forEach(function(t){"string"==typeof t?n.push(new po(t)):n.push(t),e.content=n})}},{key:"htmlElement",value:function(){var t=document.createElement("div");return t.setAttribute("id",this.id),t.innerHTML=this.render(),this.classes.forEach(function(e){e&&t.classList.add(e)}),t}},{key:"el",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return new po(t,e,n)}},{key:"supsub",value:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:[];return new wo(ko(t),ko(e),ko(n),i,o)}},{key:"sub",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[];return new bo(ko(t),ko(e),n,i)}},{key:"sup",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[];return new xo(ko(t),ko(e),n,i)}},{key:"frac",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[];return new yo(ko(t),ko(e),n,i)}},{key:"sqrt",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[];return new _o(ko(t),e,n)}}]),e}();function Po(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var So=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.webgl=e.webgl,this.draw2D=e.draw2D,this.limits=e.limits,this.shapes=e}var e,n;return e=t,(n=[{key:"elements",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:new rt("elements");return no(t,this.draw2D,e,this.limits,n)}},{key:"vinculum",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[1,1,1,1];return this.shapes.horizontalLine(new N(0,0),1,1,0,t,new rt("vinculum").scale(1,1).translate(0,0))}},{key:"strike",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[1,1,1,1];return this.shapes.horizontalLine(new N(0,0),1,1,0,t,new rt("strike").scale(1,1).rotate(0).translate(0,0))}},{key:"xStrike",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[1,1,1,1],e=this.shapes.collection(new rt("strike").scale(1,1).rotate(0).translate(0,0));e.color=t;var n=this.shapes.horizontalLine(new N(0,0),1,1,0,t,new rt("strike").scale(1,1).rotate(0).translate(0,0)),i=n._dup();return e.add("s1",n),e.add("s2",i),e}},{key:"integral",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[1,1,1,1];return new $n(this.webgl,e,t,new rt("integral").scale(1,1).translate(0,0),this.limits)}},{key:"bracket",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[1,1,1,1];return new oi(this.webgl,n,t,e,new rt("bracket").scale(1,1).translate(0,0),this.limits)}},{key:"bar",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[1,1,1,1];return new ui(this.webgl,n,t,e,new rt("bar").scale(1,1).translate(0,0),this.limits)}},{key:"squareBracket",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[1,1,1,1];return new pi(this.webgl,n,t,e,new rt("bar").scale(1,1).translate(0,0),this.limits)}},{key:"brace",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[1,1,1,1];return new ki(this.webgl,n,t,e,new rt("bar").scale(1,1).translate(0,0),this.limits)}},{key:"roundedSquareBracket",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[1,1,1,1];return new Li(this.webgl,n,t,e,new rt("bar").scale(1,1).translate(0,0),this.limits)}},{key:"make",value:function(t){return new oo(t)}},{key:"makeHTML",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return new To(t,e)}},{key:"makeEqn",value:function(){return new ro(this.draw2D,this.limits)}},{key:"makeDescription",value:function(t){return this.shapes.htmlElement(document.createElement("div"),t,"lesson__equation_description",new N(0,0),"middle","left")}}])&&Po(e.prototype,n),t}();function Oo(t){return(Oo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Mo(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Eo(t){return(Eo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Lo(t,e){return(Lo=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function Ao(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Co(t,e,n,i){var o,r=4<arguments.length&&void 0!==arguments[4]&&arguments[4],a=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"";if(null!=n&&(null!=(o=t.formSeries[i][e])&&null!=o.description)){var s=!r;n&&(r?(n.innerHTML=Ai("".concat(a).concat(o.description),o.modifiers),Ci(o.modifiers)):n.innerHTML=Ai("".concat(a).concat(o.description),o.modifiers,"",s))}}function jo(t){t&&t.classList.remove("lesson__eqn_nav__not_touchable")}function Bo(t){t&&t.classList.add("lesson__eqn_nav__not_touchable")}function Ro(t){var e="",n="";1<arguments.length&&void 0!==arguments[1]&&arguments[1]&&(e="NEXT: ",n="PREV: ");var i=t.eqn.getCurrentForm();if(null!=i){var o=t.eqn.getFormIndex(i);0===o?(Bo(t.refresh),Bo(t.prev),Bo(t.prevDescription),Bo(t.description)):(jo(t.refresh),jo(t.prev),jo(t.prevDescription),jo(t.description)),1<t.eqn.formSeries.length?(jo(t.next),jo(t.nextDescription)):(Bo(t.next),Bo(t.nextDescription));var r=o+1;r>t.eqn.formSeries.length-1?t.nextDescription&&(t.nextDescription.innerHTML="RESTART from begining"):Co(t.eqn,i.type,t.nextDescription,r,!1,e),Co(t.eqn,i.type,t.description,o,!0);var a=o-1;0<=a?Co(t.eqn,i.type,t.prevDescription,a,!1,n):t.prevDescription&&(t.prevDescription.innerHTML="")}}var Do=function(t){function e(t,n,i,o){var r,a,s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"threeLine",l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"",h=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"left",u=7<arguments.length&&void 0!==arguments[7]?arguments[7]:"middle",c=8<arguments.length&&void 0!==arguments[8]?arguments[8]:kt("id_lesson__equation_navigator_");!function(t,n){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),(r=!(a=Eo(e).call(this,new rt("Eqn Nav").scale(1,1).translate(0,0),t.limits))||"object"!==Oo(a)&&"function"!=typeof a?Ao(this):a).shapes=t,r.setEquation(i),r.prev=null,r.next=null,r.refresh=null,r.description=null,r.nextDescription=null,r.prevDescription=null,r.table=null,r.prevGroup=null,r.currentGroup=null,r.nextGroup=null,r.animateNextFrame=n,r.navType=s;var f,d,v,m,p=null;"threeLine"===r.navType&&(p=function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],o=document.createElement("table"),r=document.createElement("tr"),a=document.createElement("tr"),s=document.createElement("tr"),l=document.createElement("td"),h=document.createElement("td"),u=document.createElement("td"),c=document.createElement("td"),f=document.createElement("td"),d=document.createElement("td");r.appendChild(l),r.appendChild(c),s.appendChild(u),s.appendChild(d),a.appendChild(h),a.appendChild(f),o.appendChild(r),o.appendChild(a),o.appendChild(s),o.classList.add("lesson__eqn_nav__table"),r.classList.add("lesson__eqn_nav__3line__prevRow"),a.classList.add("lesson__eqn_nav__3line__currentRow"),s.classList.add("lesson__eqn_nav__3line__nextRow"),l.classList.add("lesson__eqn_nav__3line__prevRow__button"),h.classList.add("lesson__eqn_nav__3line__currentRow__button"),u.classList.add("lesson__eqn_nav__3line__nextRow__button"),c.classList.add("lesson__eqn_nav__3line__prevRow__description"),f.classList.add("lesson__eqn_nav__3line__currentRow__description"),f.classList.add("lesson__eqn_nav__description"),d.classList.add("lesson__eqn_nav__3line__nextRow__description");var v=i;return Array.isArray(i)||(v=[i]),-1<v.indexOf("twoLines")&&(r.classList.add("lesson__eqn_nav__3line__prev_twoLines"),a.classList.add("lesson__eqn_nav__3line__current_twoLines"),s.classList.add("lesson__eqn_nav__3line__next_twoLines")),r.onclick=t,a.onclick=e,s.onclick=n,u.innerHTML="Next",l.innerHTML="Prev",h.innerHTML="Refresh",{table:o,prevGroup:r,currentGroup:a,nextGroup:s,prev:l,refresh:h,next:u,prevDescription:c,description:f,nextDescription:d}}(r.clickPrev.bind(Ao(Ao(r))),r.clickRefresh.bind(Ao(Ao(r))),r.clickNext.bind(Ao(Ao(r))),l)),"descriptionOnly"===r.navType&&(f=r.clickNext.bind(Ao(Ao(r))),d=document.createElement("table"),v=document.createElement("tr"),m=document.createElement("td"),v.appendChild(m),d.appendChild(v),d.classList.add("lesson__eqn_nav__table"),v.classList.add("lesson__eqn_nav__description_only__currentRow"),m.classList.add("lesson__eqn_nav__description_only__currentRow__description"),m.classList.add("lesson__eqn_nav__description"),v.onclick=f,p={table:d,currentGroup:v,description:m}),"oneLine"===r.navType&&(p=function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],o=document.createElement("table"),r=document.createElement("tr"),a=document.createElement("td"),s=document.createElement("td"),l=document.createElement("td");r.appendChild(a),r.appendChild(l),r.appendChild(s),o.appendChild(r),o.classList.add("lesson__eqn_nav__table"),r.classList.add("lesson__eqn_nav__1line__currentRow"),a.classList.add("lesson__eqn_nav__1line__prev__button"),s.classList.add("lesson__eqn_nav__1line__next__button"),l.classList.add("lesson__eqn_nav__1line__currentRow__description"),l.classList.add("lesson__eqn_nav__description");var h=i;if(Array.isArray(i)||(h=[i]),-1<h.indexOf("twoLines")&&r.classList.add("lesson__eqn_nav__1line__current_twoLines"),a.onclick=t,l.onclick=e,s.onclick=n,-1<h.indexOf("arrows")){var u=document.createElement("div");u.classList.add("lesson__eqn_nav__arrow_right"),s.appendChild(u);var c=document.createElement("div");c.classList.add("lesson__eqn_nav__arrow_left"),a.appendChild(c)}else s.innerHTML="Next",a.innerHTML="Prev";return{table:o,currentGroup:r,prev:a,next:s,description:l}}(r.clickPrev.bind(Ao(Ao(r))),r.clickRefresh.bind(Ao(Ao(r))),r.clickNext.bind(Ao(Ao(r))),l)),"twoLine"===r.navType&&(p=function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:[],o=document.createElement("table"),r=document.createElement("tr"),a=document.createElement("tr"),s=document.createElement("tr"),l=document.createElement("td"),h=document.createElement("td"),u=document.createElement("tr"),c=document.createElement("td"),f=document.createElement("td");s.appendChild(c),u.appendChild(f),a.appendChild(s),a.appendChild(u),r.appendChild(l),r.appendChild(a),r.appendChild(h),o.appendChild(r),o.classList.add("lesson__eqn_nav__table"),s.classList.add("lesson__eqn_nav__2lines__currentRow"),u.classList.add("lesson__eqn_nav__2lines__nextRow"),l.classList.add("lesson__eqn_nav__2lines__prev__button"),h.classList.add("lesson__eqn_nav__2lines__next__button"),c.classList.add("lesson__eqn_nav__2lines__currentRow__description"),c.classList.add("lesson__eqn_nav__description"),f.classList.add("lesson__eqn_nav__2lines__nextRow__description");var d=i;if(Array.isArray(i)||(d=[i]),-1<d.indexOf("twoLines")&&s.classList.add("lesson__eqn_nav__2lines__current_twoLines"),l.onclick=t,c.onclick=e,h.onclick=n,f.onclick=n,-1<d.indexOf("arrows")){var v=document.createElement("div");v.classList.add("lesson__eqn_nav__arrow_right"),h.appendChild(v);var m=document.createElement("div");m.classList.add("lesson__eqn_nav__arrow_left"),l.appendChild(m)}else h.innerHTML="Next",l.innerHTML="Prev";return{table:o,currentGroup:s,nextGroup:u,prev:l,next:h,nextDescription:f,description:c}}(r.clickPrev.bind(Ao(Ao(r))),r.clickRefresh.bind(Ao(Ao(r))),r.clickNext.bind(Ao(Ao(r))),l));var g=r.eqn.collection.getPosition();if(null!=p){Object.assign(Ao(Ao(r)),p);var y=r.shapes.htmlElement(p.table,"".concat(c,"_table"),"",g.add(o),u,h);r.add("table",y)}return r.eqn.collection.onClick=r.clickNext.bind(Ao(Ao(r))),r.hasTouchableElements=!0,r.eqn.collection.isTouchable=!0,r.eqn.collection.touchInBoundingRect=!0,r}var n,i;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&Lo(t,e)}(e,fe),n=e,(i=[{key:"setEquation",value:function(t){this.eqn=t,this.add("eqn",t.collection)}},{key:"clickNext",value:function(){this.eqn.nextForm(1.5),this.updateButtons(),this.animateNextFrame()}},{key:"clickPrev",value:function(){this.eqn.prevForm(1.5),this.updateButtons(),this.animateNextFrame()}},{key:"clickRefresh",value:function(){var t=this.eqn.getCurrentForm();null!=t&&0<this.eqn.getFormIndex(t)&&(this.eqn.replayCurrentForm(1.5),this.animateNextFrame()),this.updateButtons()}},{key:"updateButtons",value:function(){"equationOnly"!==this.navType&&("descriptionOnly"===this.navType?function(t){var e=t.eqn.getCurrentForm();if(null!=e){var n=t.eqn.getFormIndex(e);jo(t.description),Co(t.eqn,e.type,t.description,n,!0)}}(this):"twoLine"===this.navType?Ro(this,!0):Ro(this))}},{key:"showForm",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;this.show(),this.eqn.showForm(t,e),this._table&&(this._table.show(),this.updateButtons())}}])&&Mo(n.prototype,i),e}();function Io(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Fo=function(){function t(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this);var i,o={label:"",color:[0,0,1,1],scale:.7,position:new N(0,0),form:"0",formType:"base",vAlign:"middle",hAlign:"center"},r=Object.assign({},o,n),a=r.label,s=r.color,l=r.scale,h=r.position,u=r.form,c=r.formType,f=r.vAlign,d=r.hAlign;if("string"==typeof a)(i=e.makeEqn()).createElements({base:a},s),i.collection.transform=(new rt).scale(1,1).rotate(0).translate(h),i.formAlignment.fixTo=new N(0,0),i.formAlignment.hAlign=d,i.formAlignment.vAlign=f,i.formAlignment.scale=l,i.addForm("base",["base"]),i.setCurrentForm("base");else if(a instanceof ro)i=a;else{i=e.makeEqn();var v={};a.forEach(function(t,e){v["_".concat(e)]=t}),i.createElements(v,s),i.collection.transform=(new rt).scale(1,1).rotate(0).translate(h),i.formAlignment.fixTo=new N(0,0),i.formAlignment.hAlign=d,i.formAlignment.vAlign=f,i.formAlignment.scale=l,a.forEach(function(t,e){i.addForm("".concat(e),["_".concat(e)])}),i.setCurrentForm(u,c)}this.eqn=i}var e,n;return e=t,(n=[{key:"setText",value:function(t){var e=this.eqn.getCurrentForm();if(null!=e){var n=Object.keys(e.collection.elements)[0],i=e.collection.elements[n].drawingObject;null!=i&&i.setText(t),e.arrange(this.eqn.formAlignment.scale,this.eqn.formAlignment.hAlign,this.eqn.formAlignment.vAlign,this.eqn.formAlignment.fixTo)}}},{key:"getText",value:function(){var t="",e=this.eqn.getCurrentForm();if(null!=e){var n=Object.keys(e.collection.elements)[0],i=e.collection.elements[n].drawingObject;null!=i&&(t=i.text[0].text)}return t}},{key:"updateRotation",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:0;if(0!==n){var o=0,r=0,a=this.eqn.getCurrentForm();null!=a&&(o=a.width/2+.04,r=a.height/2+.04);var s=o+n,l=r+n,h=s*l/Math.sqrt(Math.pow(l*Math.cos(t-i),2)+Math.pow(s*Math.sin(t-i),2));this.eqn.collection.setPosition(e.add(lt(h,i)))}else this.eqn.collection.setPosition(e);this.eqn.collection.transform.updateRotation(t)}}])&&Io(e.prototype,n),t}();function qo(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Ho(t,e,n){return e&&qo(t.prototype,e),n&&qo(t,n),t}function No(t){return(No="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Go(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function zo(t,e){return!e||"object"!==No(e)&&"function"!=typeof e?function(t){if(void 0!==t)return t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(t):e}function Wo(t){return(Wo=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Vo(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&function(t,e){(Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}(t,e)}var Uo=function(t){function e(t,n,i,o){var r,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"top",s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"left",l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"horizontal",h=7<arguments.length&&void 0!==arguments[7]?arguments[7]:.5;return Go(this,e),(r=zo(this,Wo(e).call(this,t,{label:n,color:i}))).offset=o,r.location=a,r.subLocation=s,r.orientation=l,r.linePosition=h,r}return Vo(e,Fo),e}();function Xo(t,e,n,i,o,r,a,s){var l=t.horizontalLine(i,e,n,0,o,(new rt).scale(1,1).translate(0,0));if(r&&(l=t.dashedLine(i,r.maxLength,n,0,r.style,o,(new rt).scale(1,1).translate(0,0))),a){var h=s?16:8;!function(t){for(var e=0;e<t.drawingObject.border[0].length;e+=1)t.drawingObject.border[0][e].y*=h}(l)}return l}var Yo=function(t){function e(t,n,i,o){var r,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};Go(this,e);var s={position:new N(0,0),length:1,angle:0,width:.01,vertexSpaceStart:"start",color:[0,0,1,1],showLine:!0,largerTouchBorder:!0,offset:0,dashStyle:null},l=Object.assign({},s,a),h=l.dashStyle;if(h){var u=l.length;null!=l.p1&&null!=l.p2&&(u=W(l.p1,l.p2)),h=Object.assign({},{maxLength:u,dashStyle:[.1]},a.dashStyle)}if((r=zo(this,Wo(e).call(this,new rt("Line").scale(1,1).rotate(0).translate(0,0),t.limits))).setColor(l.color),r.shapes=t,r.equation=n,r.largerTouchBorder=l.largerTouchBorder,r.isTouchDevice=i,r.animateNextFrame=o,r.dashStyle=h,r.offset=l.offset,r.width=l.width,r.position=l.position,r.length=l.length,r.angle=l.angle,r.transform.updateTranslation(r.position),r.transform.updateRotation(r.angle),r.vertexSpaceLength=1,r.vertexSpaceStart=new N(0,0),"end"===l.vertexSpaceStart?r.vertexSpaceStart=new N(-1,0):"center"===l.vertexSpaceStart?r.vertexSpaceStart=new N(-.5,0):"number"==typeof l.vertexSpaceStart?r.vertexSpaceStart=new N(-l.vertexSpaceStart,0):l.vertexSpaceStart instanceof N&&(r.vertexSpaceStart=l.vertexSpaceStart),r.multiMove={vertexSpaceMidLength:0,bounds:new H(-1,-1,2,2)},r._midLine=null,r._line=null,l.showLine){var c=Xo(r.shapes,r.vertexSpaceLength,r.width,r.vertexSpaceStart,l.color,r.dashStyle,l.largerTouchBorder,i);r.add("line",c)}r.arrow1=null,r.arrow2=null,r._arrow1=null,r._arrow2=null,r.label=null,r.showRealLength=!1,r._label=null,r.setLength(r.length),null!=l.p1&&null!=l.p2&&r.setEndPoints(l.p1,l.p2);var f={width:4*r.width,height:4*r.width};if(l.arrowStart){var d=Object.assign({},f,l.arrowStart);r.addArrowStart(d.height,d.width)}if(l.arrowEnd){var v=Object.assign({},f,l.arrowEnd);r.addArrowEnd(v.height,v.width)}if(l.arrows){var m={};"object"===No(l.arrows)&&(m=l.arrows);var p=Object.assign({},f,m);r.addArrows(p.height,p.width)}if(l.label){var g=Object.assign({},{text:"",offset:0,location:"top",subLocation:"left",orientation:"horizontal",linePosition:.5},l.label);r.addLabel(g.text,g.offset,g.location,g.subLocation,g.orientation,g.linePosition)}return r}return Vo(e,fe),Ho(e,[{key:"calculateFromP1LengthAngle",value:function(t,e,n){var i=(new rt).scale(e,1).rotate(n),o=this.vertexSpaceStart.transformBy(i.matrix());return{length:e,angle:n,position:t.sub(o)}}},{key:"calculateFromP1P2",value:function(t,e){var n=new Z(t,e),i=n.length(),o=n.angle(),r=(new rt).scale(i,1).rotate(o),a=this.vertexSpaceStart.transformBy(r.matrix());return{length:i,angle:o,position:t.sub(a)}}}]),Ho(e,[{key:"pulseWidth",value:function(){var t=this._line;if(null!=t){t.stopPulsing();var e=t.pulse.transformMethod,n=t.pulse.callback;t.pulse.callback=function(){t.pulse.transformMethod=e,t.pulse.callback=n},t.pulse.transformMethod=function(t){return(new rt).scale(1,t)},t.pulseScaleNow(1,3)}var i=this._arrow1,o=this._arrow2;null!=i&&i.pulseScaleNow(1,2),null!=o&&o.pulseScaleNow(1,2);var r=this._label;null!=r&&r.pulseScaleNow(1,1.5),this.animateNextFrame()}},{key:"addArrow",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:4*this.width,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:e,i=Math.PI/2;2===t&&(i=Math.PI/2*3);var o=this.shapes.arrow(n,0,e,0,this.color,(new rt).translate(this.vertexSpaceStart.x,0),new N(0,0),i);this["arrow".concat(t)]={height:e},this.add("arrow".concat(t),o),this.setLength(this.currentLength)}},{key:"addArrows",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:4*this.width,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t;this.addArrow1(t,e),this.addArrow2(t,e)}},{key:"addArrow1",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:4*this.width,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t;this.addArrow(1,t,e)}},{key:"addArrow2",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:4*this.width,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t;this.addArrow(2,t,e)}},{key:"addArrowStart",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:4*this.width,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t;this.addArrow1(t,e)}},{key:"addArrowEnd",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:4*this.width,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:t;this.addArrow2(t,e)}},{key:"setMovable",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.move.type,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:.333,i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:this.diagramLimits;t?"translation"===e||"rotation"===e||"scale"===e||"scaleX"===e||"scaleY"===e?(this.move.type=e,this.isTouchable=!0,this.isMovable=!0,this.hasTouchableElements=!0,null!=this._line&&(this._line.isTouchable=!0,this._line.isMovable=!1),this._midLine&&(this._midLine.isMovable=!1),this.multiMove.bounds=i):this.setMultiMovable(n,i):this.isMovable=!1}},{key:"setMultiMovable",value:function(t,e){this.multiMove.vertexSpaceMidLength=t*this.vertexSpaceLength;var n=new N(this.vertexSpaceStart.x+this.vertexSpaceLength/2-this.multiMove.vertexSpaceMidLength/2,0),i=Xo(this.shapes,this.multiMove.vertexSpaceMidLength,this.width,n,this.color,null,this.largerTouchBorder,this.isTouchDevice);i.isTouchable=!0,i.move.type="translation",i.move.element=this,i.isMovable=!0,i.move.canBeMovedAfterLoosingTouch=!0,this.add("midLine",i),this._line&&(this._line.isTouchable=!0,this._line.move.type="rotation",(this._line.move.element=this)._line.isMovable=!0,this._line.move.canBeMovedAfterLoosingTouch=!0),this.hasTouchableElements=!0,this.isTouchable=!1,this.isMovable=!1,this.multiMove.bounds=e,this.setLength(this.currentLength)}},{key:"updateMoveTransform",value:function(t){var e=t.r(),n=this.multiMove.bounds;if(null!=e){var i=Math.abs(this.currentLength/2*Math.cos(e)),o=Math.abs(this.currentLength/2*Math.sin(e));this.move.maxTransform.updateTranslation(n.right-i,n.top-o),this.move.minTransform.updateTranslation(n.left+i,n.bottom+o),e>2*Math.PI&&this.transform.updateRotation(e-2*Math.PI),e<0&&this.transform.updateRotation(e+2*Math.PI)}}},{key:"addLabel",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"top",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"left",o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"horizontal",r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:.5;this.label=new Uo(this.equation,t,this.color,e,n,i,o,r),null!=this.label&&this.add("label",this.label.eqn.collection),this.updateLabel()}},{key:"updateLabel",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=this.label;if(null!=e){var n=X(this.transform.r()||0),i=0;this.showRealLength&&this._label&&(this._label._base.drawingObject.setText(s(this.currentLength,2).toString()),e.eqn.reArrangeCurrentForm());var o=new N(this.vertexSpaceStart.x*this.currentLength+e.linePosition*this.currentLength,0),r=Math.PI/2,a=e.offset;if("end1"===e.location||"end2"===e.location)"end1"===e.location&&(o.x=this.vertexSpaceStart.x*this.currentLength-e.offset,r=-Math.PI),"end2"===e.location&&(o.x=this.vertexSpaceStart.x*this.currentLength+this.currentLength+e.offset,r=0);else{var l=Math.cos(n)<0?-Math.PI/2:Math.PI/2,h=-l,u=0<Math.sin(n)?Math.PI/2:-Math.PI/2,c=-u;"top"===e.location&&(r=l),"bottom"===e.location&&(r=h),"right"===e.location&&(r=c),"left"===e.location&&(r=u),0!==s(Math.sin(n),4)||"left"!==e.location&&"right"!==e.location||("top"===e.subLocation&&(r=l),"bottom"===e.subLocation&&(r=h)),0!==s(Math.cos(n),4)||"top"!==e.location&&"bottom"!==e.location||("right"===e.subLocation&&(r=c),"left"===e.subLocation&&(r=u)),"inside"===e.location&&(r=-Math.PI/2),"outside"===e.location&&(r=Math.PI/2)}"horizontal"===e.orientation&&(i=-n),"baseToLine"===e.orientation&&o.y<0&&(i=Math.PI),"baseAway"===e.orientation&&0<o.y&&(i=Math.PI),"baseUpright"===e.orientation&&Math.cos(n)<0&&(i=Math.PI),e.updateRotation(i-t,o,a,r)}}},{key:"setLength",value:function(t){var e=this.vertexSpaceStart.x*t,n=t,i=n,o=0;this.arrow1&&this._arrow1&&(i-=this.arrow1.height,o=this.arrow1.height,this._arrow1.setPosition(e)),this.arrow2&&this._arrow2&&(i-=this.arrow2.height,this._arrow2.setPosition(e+n,0));var r=this._line;if(r)if(this.dashStyle)r.lengthToDraw=i,r.setPosition(e+o-this.vertexSpaceStart.x,0);else{r.transform.updateScale(i,1);var a=e+o-this.vertexSpaceStart.x*i;r.setPosition(a,0)}var s=this._midLine;s&&s.transform.updateScale(t,1),this.length=t,this.updateLineGeometry(),this.currentLength=t,this.updateLabel()}},{key:"updateLineGeometry",value:function(){var t=this.transform.t(),e=this.transform.r();if(null!=t&&null!=e){this.position=t,this.angle=e;var n=this.vertexSpaceStart.transformBy((new rt).scale(this.length).rotate(this.angle).translate(this.position).m()),i=new Z(n,this.length,this.angle);this.p1=i.getPoint(1),this.p2=i.getPoint(2),this.line=i}}},{key:"setLineDimensions",value:function(){var t=lt(this.offset,this.angle+Math.PI/2);this.transform.updateTranslation(this.position.add(t)),this.transform.updateRotation(this.angle),this.setLength(this.length),this.updateLabel()}},{key:"setEndPoints",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.offset;this.offset=n;var i=this.calculateFromP1P2(t,e),o=i.length,r=i.angle,a=i.position;this.angle=r,this.length=o,this.position=a,this.setLineDimensions()}},{key:"animateLengthTo",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;this.stop();var r=this.currentLength,a=e-this.currentLength;this.animateCustomTo(function(e){t.setLength(r+a*e)},n,0,function(){i&&t.setLength(r+a),"function"==typeof o&&o&&o()})}},{key:"grow",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1,n=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;this.stop();var o=this.currentLength;this.setLength(t),this.animateLengthTo(o,e,n,i)}},{key:"showLineOnly",value:function(){this.show(),this._line&&this._line.show(),this._arrow1&&this._arrow1.show(),this._arrow2&&this._arrow2.show(),this._label&&this._label.hideAll()}}]),e}();function Qo(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var Zo=function(){function t(e,n,i,o){!function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.webgl=e.webgl,this.draw2D=e.draw2D,this.limits=e.limits,this.shapes=e,this.isTouchDevice=i,this.animateNextFrame=o,this.equation=n}var e,n;return e=t,(n=[{key:"equationNavigator",value:function(t,e){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"threeLine",i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",o=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"left",r=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"middle",a=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"id_lesson__equation_navigator_".concat(Math.floor(1e4*Math.random()));return new Do(this.shapes,this.animateNextFrame,t,e,n,i,o,r,a)}},{key:"line",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=Object.assign.apply(Object,[{}].concat(e));return new Yo(this.shapes,this.equation,this.isTouchDevice,this.animateNextFrame,i)}},{key:"label",value:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=Object.assign.apply(Object,[{}].concat(e));return new Fo(this.equation,i)}}])&&Qo(e.prototype,n),t}();function Ko(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}var $o=function(){function t(){var e,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"DiagramContainer",i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:new H(-1,-1,2,2),o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:-1,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:2,a=4<arguments.length&&void 0!==arguments[4]?arguments[4]:2,s=5<arguments.length&&void 0!==arguments[5]?arguments[5]:[1,1,1,1],l=6<arguments.length&&void 0!==arguments[6]?arguments[6]:{},h=7<arguments.length&&void 0!==arguments[7]?arguments[7]:"simple",u=8<arguments.length&&void 0!==arguments[8]?arguments[8]:"simple";if(function(e,n){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),this.layout=l,"string"==typeof n){var c=document.getElementById(n);if(c instanceof HTMLElement){for(var f=c.children,d=0;d<f.length;d+=1){var v=f[d];v instanceof HTMLCanvasElement&&v.classList.contains("diagram__gl")&&("id_diagram__gl__low"===v.id&&(this.canvasLow=v),"id_diagram__gl__high"===v.id&&(this.canvasHigh=v)),v instanceof HTMLCanvasElement&&v.classList.contains("diagram__text")&&("id_diagram__text__low"===v.id&&(this.textCanvasLow=v),"id_diagram__text__high"===v.id&&(this.textCanvasHigh=v)),v.classList.contains("diagram__html")&&(this.htmlCanvas=v)}this.backgroundColor=s;var m=bt(h,u),p=new gt(this.canvasLow,m.vertexSource,m.fragmentSource,m.varNames,this.backgroundColor),g=new gt(this.canvasHigh,m.vertexSource,m.fragmentSource,m.varNames,this.backgroundColor);this.webglLow=p,this.webglHigh=g,this.draw2DLow=new It(this.textCanvasLow),this.draw2DHigh=new It(this.textCanvasHigh)}}if(n instanceof gt&&(this.webglLow=n),this instanceof t&&(this.gesture=new pe(this)),this.fontScale=1,i instanceof H){var y=i;e=new H(y.left,y.bottom,y.width,y.height)}else e=new H(i,o,r,a);this.updateLimits(e),this.drawQueued=!1,this.inTransition=!1,this.beingMovedElements=[],this.beingTouchedElements=[],this.moveTopElementOnly=!0,this.globalAnimation=new ve,this.shapesLow=this.getShapes(!1),this.shapesHigh=this.getShapes(!0),this.shapes=this.shapesLow,this.equationLow=this.getEquations(!1),this.equationHigh=this.getEquations(!0),this.equation=this.equationLow,this.objectsLow=this.getObjects(!1),this.objectsHigh=this.getObjects(!0),this.objects=this.objectsLow,this.createDiagramElements(),""===this.elements.name&&(this.elements.name="diagramRoot"),window.addEventListener("resize",this.resize.bind(this)),this.sizeHtmlText(),this.initialize(),this.isTouchDevice=function(){var t,e=" -webkit- -moz- -o- -ms- ".split(" ");return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)||(t=["(",e.join("touch-enabled),("),"heartz",")"].join(""),window.matchMedia(t).matches)}(),this.animateNextFrame()}var e,n;return e=t,(n=[{key:"getShapes",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=this.webglLow,n=this.draw2DLow;return t&&(e=this.webglHigh,n=this.draw2DHigh),new Xn(e,n,this.htmlCanvas,this.limits)}},{key:"getEquations",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=this.shapesLow;return t&&(e=this.shapesHigh),new So(e)}},{key:"getObjects",value:function(){var t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=this.shapesLow,n=this.equationLow;return t&&(e=this.shapesHigh,n=this.equationHigh),new Zo(e,n,this.isTouchDevice,this.animateNextFrame.bind(this))}},{key:"sizeHtmlText",value:function(){var t=1*this.fontScale/35,e=this.htmlCanvas.offsetWidth*t-1;if(this.htmlCanvas.style.fontSize="".concat(e,"px"),window.getComputedStyle(document.documentElement)){var n=document.documentElement;n&&n.style.setProperty("--lesson__diagram-font-size","".concat(e,"px"))}}},{key:"destroy",value:function(){this.gesture.destroy(),this.webglLow.gl.getExtension("WEBGL_lose_context").loseContext(),this.webglHigh.gl.getExtension("WEBGL_lose_context").loseContext()}},{key:"setSpaceTransforms",value:function(){var t={x:{bottomLeft:-1,width:2},y:{bottomLeft:-1,height:2}},e={x:{bottomLeft:this.limits.left,width:this.limits.width},y:{bottomLeft:this.limits.bottom,height:this.limits.height}},n=this.canvasLow.getBoundingClientRect(),i={x:{bottomLeft:0,width:n.width},y:{bottomLeft:n.height,height:-n.height}};this.diagramToGLSpaceTransform=at(e,t,"Diagram"),this.glToDiagramSpaceTransform=at(t,e),this.pixelToDiagramSpaceTransform=at(i,e),this.diagramToPixelSpaceTransform=at(e,i),this.pixelToGLSpaceTransform=at(i,t),this.glToPixelSpaceTransform=at(t,i),this.diagramToCSSPercentSpaceTransform=at(e,{x:{bottomLeft:0,width:1},y:{bottomLeft:1,height:-1}})}},{key:"initialize",value:function(){this.elements.setFirstTransform(this.diagramToGLSpaceTransform)}},{key:"updateLimits",value:function(t){this.limits=t._dup(),this.setSpaceTransforms()}},{key:"resize",value:function(){this.webglLow.resize(),this.webglHigh.resize(),this.draw2DLow.resize(),this.draw2DHigh.resize(),this.setSpaceTransforms(),this.sizeHtmlText(),this.elements.resizeHtmlObject(),this.animateNextFrame()}},{key:"touchDownHandler",value:function(t){if(this.inTransition)return!1;var e=this.clientToPixel(t).transformBy(this.pixelToGLSpaceTransform.matrix());this.beingTouchedElements=this.elements.getTouched(e),this.moveTopElementOnly?0<this.beingTouchedElements.length&&this.beingTouchedElements[0].click():this.beingTouchedElements.forEach(function(t){return t.click()}),this.beingMovedElements=[];for(var n=0;n<this.beingTouchedElements.length;n+=1){var i=this.beingTouchedElements[n];i.isMovable&&(this.beingMovedElements.push(i),i.startBeingMoved())}return 0<this.beingMovedElements.length&&this.animateNextFrame(),0<this.beingTouchedElements.length}},{key:"touchUpHandler",value:function(){for(var t=0;t<this.beingMovedElements.length;t+=1){var e=this.beingMovedElements[t];e.state.isBeingMoved&&(e.stopBeingMoved(),e.startMovingFreely())}this.beingMovedElements=[],this.beingTouchedElements=[]}},{key:"rotateElement",value:function(t,e,n){var i=t.getDiagramPosition();null==i&&(i=new N(0,0));var o=this.clientToPixel(e),r=this.clientToPixel(n),a=o.transformBy(this.pixelToDiagramSpaceTransform.matrix()),s=r.transformBy(this.pixelToDiagramSpaceTransform.matrix()),l=Math.atan2(s.y-i.y,s.x-i.x),h=U(Math.atan2(a.y-i.y,a.x-i.x),l),u=t.transform._dup(),c=u.r();null==c&&(c=0);var f=c-h;u.updateRotation(f),t.moved(u._dup())}},{key:"translateElement",value:function(t,e,n){var i=this.clientToPixel(e),o=this.clientToPixel(n),r=i.transformBy(this.pixelToDiagramSpaceTransform.matrix()),a=o.transformBy(this.pixelToDiagramSpaceTransform.matrix()).sub(r),s=t.transform._dup(),l=s.t();if(null!=l){var h=l.add(a);s.updateTranslation(h),t.moved(s)}}},{key:"scaleElement",value:function(t,e,n){var i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"",o=this.clientToPixel(e),r=this.clientToPixel(n),a=o.transformBy(this.pixelToDiagramSpaceTransform.matrix()),s=r.transformBy(this.pixelToDiagramSpaceTransform.matrix()),l=t.getDiagramPosition(),h=a.sub(l).distance(),u=s.sub(l).distance(),c=t.transform.s();if(null!=c){var f=t.transform._dup(),d=c.x*u/h,v=c.y*u/h;"x"===i?f.updateScale(d,1):"y"===i?f.updateScale(1,v):f.updateScale(d,v),t.moved(f)}}},{key:"touchMoveHandler",value:function(t,e){if(this.inTransition)return!1;if(0===this.beingMovedElements.length)return!1;for(var n=this.clientToPixel(t).transformBy(this.pixelToGLSpaceTransform.matrix()),i=0;i<this.beingMovedElements.length;i+=1){var o=this.beingMovedElements[i];if(o!==this.elements&&(o.isBeingTouched(n)||o.move.canBeMovedAfterLoosingTouch)){var r=null==o.move.element?o:o.move.element;!1===r.state.isBeingMoved&&r.startBeingMoved(),-1===this.beingMovedElements.indexOf(r)&&this.beingMovedElements.push(r),"rotation"===o.move.type?this.rotateElement(r,t,e):"scale"===o.move.type?this.scaleElement(r,t,e):"scaleX"===o.move.type?this.scaleElement(r,t,e,"x"):"scaleY"===o.move.type?this.scaleElement(r,t,e,"y"):this.translateElement(r,t,e)}this.moveTopElementOnly&&(i=this.beingMovedElements.length)}return this.animateNextFrame(),!0}},{key:"stop",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.elements.stop(t,e)}},{key:"createDiagramElements",value:function(){this.elements=new fe,this.elements.diagramLimits=this.limits}},{key:"add",value:function(t,e){this.elements.add(t,e)}},{key:"clearContext",value:function(){this.webglLow.gl.clearColor(0,0,0,0),this.webglLow.gl.clear(this.webglLow.gl.COLOR_BUFFER_BIT),this.webglHigh.gl.clearColor(0,0,0,0),this.webglHigh.gl.clear(this.webglHigh.gl.COLOR_BUFFER_BIT),this.draw2DLow&&this.draw2DLow.ctx.clearRect(0,0,this.draw2DLow.ctx.canvas.width,this.draw2DLow.ctx.canvas.height),this.draw2DHigh&&this.draw2DHigh.ctx.clearRect(0,0,this.draw2DHigh.ctx.canvas.width,this.draw2DHigh.ctx.canvas.height)}},{key:"draw",value:function(t){this.drawQueued=!1,this.clearContext(),this.elements.draw(this.diagramToGLSpaceTransform,t),this.elements.isMoving()&&this.animateNextFrame()}},{key:"animateNextFrame",value:function(){this.drawQueued||(this.drawQueued=!0,this.globalAnimation.queueNextFrame(this.draw.bind(this)))}},{key:"isAnimating",value:function(){return this.elements.state.isAnimating}},{key:"clientToPixel",value:function(t){var e=this.canvasLow.getBoundingClientRect();return new N(t.x-e.left,t.y-e.top)}}])&&Ko(e.prototype,n),t}(),Jo={tools:{math:i,d2:o},diagram:a,element:r};e.default=Jo}])});